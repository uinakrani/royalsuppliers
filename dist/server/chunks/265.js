"use strict";exports.id=265,exports.ids=[265],exports.modules={92484:(e,t,a)=>{a.d(t,{Z:()=>FilterPopup});var r=a(30784),n=a(9885);a(88908);var s=a(56206);function FilterPopup({isOpen:e,onClose:t,title:a="Filters",children:i}){let[l,o]=(0,n.useState)(!1),[d,c]=(0,n.useState)(!1),[m,u]=(0,n.useState)(!1),p=(0,n.useRef)(null);(0,n.useRef)(null),(0,n.useEffect)(()=>{let checkStandalone=()=>{let e=window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||document.documentElement.classList.contains("standalone");u(e)};checkStandalone();let e=new MutationObserver(checkStandalone);return e.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[]),(0,n.useEffect)(()=>(e?(o(!1),c(!1),document.body.style.overflow="hidden",requestAnimationFrame(()=>{c(!0)})):(c(!1),document.body.style.overflow=""),()=>{document.body.style.overflow=""}),[e]);let handleClose=()=>{o(!0),c(!1),setTimeout(()=>{t(),o(!1)},250)};return e&&(r.Fragment,s.Z),null}},97684:(e,t,a)=>{a.d(t,{Z:()=>OrderForm});var r=a(30784),n=a(9885);a(88908);var s=a(517),i=a(93680),l=a(87094),o=a(37004),d=a(76313),c=a(66908),m=a(13303),u=a(45894),p=a(1264),g=a(90391),y=a(26303),h=a(22385),x=a(51910),f=a(56206),N=a(4780),b=a(59233),w=a(81766),v=a(93188),j=a(32737),S=a(89342),C=a(28571);let k=["Bodeli","Panetha","Nareshware","Kali","Chikhli Kapchi VSI","Chikhli Kapchi","Areth"];var T=a(64782),P=a(83643);let Z=["date","partyName","siteName","material","weight","rate","truckOwner","truckNo","supplier","originalWeight","originalRate","additionalCost","payment","review"];function OrderFormWizard({order:e,onClose:t,onSave:a}){let I=!!e?.id,A=I?Z.length-1:0,[E,O]=(0,n.useState)(A),[R,W]=(0,n.useState)(!1),[F,$]=(0,n.useState)(!1),[M,z]=(0,n.useState)(!1),[L,D]=(0,n.useState)({date:(e=>{if(!e)return new Date().toISOString().split("T")[0];if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;if(e.includes("T"))return e.split("T")[0];try{return new Date(e).toISOString().split("T")[0]}catch{return new Date().toISOString().split("T")[0]}})(e?.date),partyName:e?.partyName||"",siteName:e?.siteName||"",material:Array.isArray(e?.material)?e.material:e?.material?[e.material]:[],weight:e?.weight||0,rate:e?.rate||0,truckOwner:e?.truckOwner||"",truckNo:e?.truckNo||"",supplier:e?.supplier||"",originalWeight:e?.originalWeight||0,originalRate:e?.originalRate||0,additionalCost:e?.additionalCost||0,partialPayments:e?.partialPayments||[]}),[q,H]=(0,n.useState)([]),[K,V]=(0,n.useState)([]),[U,X]=(0,n.useState)([]),[B,Y]=(0,n.useState)([]),G=(0,n.useRef)(null);(0,n.useEffect)(()=>(document.body.style.overflow="hidden",requestAnimationFrame(()=>{$(!0)}),loadOptions(),()=>{document.body.style.overflow=""}),[I]);let loadOptions=async()=>{try{let[e,t,a,r]=await Promise.all([b.XK.getUniquePartyNames(),b.XK.getUniqueSiteNames(),b.XK.getUniqueTruckOwners(),b.XK.getUniqueSuppliers()]);H(e),V(t),X(a),Y(r)}catch(e){console.error("Error loading options:",e)}},handleNext=()=>{E<Z.length-1&&O(E+1)},handleAfterEdit=()=>{I?O(Z.length-1):handleNext()},handleStepClick=e=>{e!==E&&O(e)},getStepLabel=e=>({date:"Date",partyName:"Party Name",siteName:"Site Name",material:"Material",weight:"Weight",rate:"Rate",truckOwner:"Truck Owner",truckNo:"Truck Number",supplier:"Supplier",originalWeight:"Original Weight",originalRate:"Original Rate",additionalCost:"Additional Cost",payment:"Payment",review:"Review"})[e],getStepIcon=e=>{let t={date:s.Z,partyName:i.Z,siteName:l.Z,material:o.Z,weight:d.Z,rate:c.Z,truckOwner:m.Z,truckNo:m.Z,supplier:u.Z,originalWeight:d.Z,originalRate:c.Z,additionalCost:c.Z,payment:c.Z,review:p.Z};return t[e]},isStepComplete=e=>{switch(e){case"date":return!!L.date;case"partyName":return!!L.partyName;case"siteName":return!!L.siteName;case"material":return Array.isArray(L.material)&&L.material.length>0;case"weight":return L.weight>0;case"rate":return L.rate>0;case"truckOwner":return!!L.truckOwner;case"truckNo":return!!L.truckNo;case"supplier":return!!L.supplier;case"originalWeight":return L.originalWeight>0;case"originalRate":return L.originalRate>0;case"additionalCost":case"payment":case"review":return!0;default:return!1}},canProceed=()=>{let e=Z[E];return isStepComplete(e)},renderPaymentStep=()=>{let e=L.originalWeight*L.originalRate,t=L.partialPayments||[],a=t.reduce((e,t)=>e+Number(t.amount||0),0),n=e-a,handleAddPayment=async()=>{if(n<=0){(0,P.showToast)("Order is already fully paid","error");return}try{let e=await T.h.prompt({title:"Add Payment",message:`Remaining amount: ${(0,w.formatIndianCurrency)(n)}`,inputLabel:"Payment Amount",inputPlaceholder:"Enter amount",inputType:"text",formatCurrencyInr:!0,confirmText:"Add Payment",cancelText:"Cancel"});if(!e)return;let a=Math.abs(parseFloat(String(e).replace(/,/g,"")));if(!a||Number.isNaN(a)||a<=0){(0,P.showToast)("Invalid amount","error");return}if(a>n){(0,P.showToast)(`Payment amount cannot exceed remaining amount (${(0,w.formatIndianCurrency)(n)})`,"error");return}let r=await T.h.prompt({title:"Add Note (optional)",inputLabel:"Note",inputPlaceholder:"e.g. Cash payment / Bank transfer",inputType:"text",required:!1,confirmText:"Save",cancelText:"Skip"}),s=new Date().toISOString(),i={id:Date.now().toString()+Math.random().toString(36).substr(2,9),amount:a,date:s,createdAt:s,note:r||void 0};D({...L,partialPayments:[...t,i]}),(0,P.showToast)("Payment added successfully!","success")}catch(e){e?.message&&!e.message.includes("SweetAlert")&&(0,P.showToast)(e.message||"Failed to add payment","error")}},handleEditPayment=async a=>{let r=t.find(e=>e.id===a);if(!r)return;let n=t.filter(e=>e.id!==a).reduce((e,t)=>e+Number(t.amount||0),0),s=e-n,i=!!r.ledgerEntryId;try{let e=await T.h.prompt({title:"Edit Payment",message:`Max amount: ${(0,w.formatIndianCurrency)(s)}`,inputLabel:"Payment Amount",inputPlaceholder:"Enter amount",inputType:"text",formatCurrencyInr:!0,inputValue:r.amount.toString(),confirmText:"Save",cancelText:"Cancel"});if(!e)return;let n=Math.abs(parseFloat(String(e).replace(/,/g,"")));if(!n||Number.isNaN(n)||n<=0){(0,P.showToast)("Invalid amount","error");return}if(n>s){(0,P.showToast)(`Payment amount cannot exceed ${(0,w.formatIndianCurrency)(s)}`,"error");return}let l=await T.h.prompt({title:"Edit Note (optional)",inputLabel:"Note",inputPlaceholder:"e.g. Cash payment / Bank transfer",inputType:"text",required:!1,inputValue:r.note||"",confirmText:"Save",cancelText:"Skip"}),o={...r,amount:n,note:l||void 0,...i&&{ledgerEntryId:r.ledgerEntryId}},d=!!i&&!!r&&Math.abs(Number(n)-Number(r.amount))>.01;D({...L,partialPayments:t.map(e=>e.id===a?o:e)}),i&&d?(0,P.showToast)("Payment amount updated. Ledger entry will be redistributed after saving.","success"):i?(0,P.showToast)("Payment updated successfully! (Date/note only - no redistribution needed)","success"):(0,P.showToast)("Payment updated successfully!","success")}catch(e){e?.message&&!e.message.includes("SweetAlert")&&(0,P.showToast)(e.message||"Failed to update payment","error")}},handleRemovePayment=async e=>{let a=t.find(t=>t.id===e);if(!a)return;let r=!!a.ledgerEntryId;try{let n=await T.h.confirm({title:"Remove Payment?",message:`Are you sure you want to remove payment of ${(0,w.formatIndianCurrency)(a.amount)}?`,icon:"warning",confirmText:"Remove",cancelText:"Cancel"});if(!n)return;D({...L,partialPayments:t.filter(t=>t.id!==e)}),r?(0,P.showToast)("Payment removed. Ledger entry will be redistributed after saving.","success"):(0,P.showToast)("Payment removed successfully!","success")}catch(e){e?.message&&e.message.includes("SweetAlert")}};return(0,r.jsxs)("div",{className:"py-6",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[r.jsx(c.Z,{size:48,className:"mx-auto mb-3 text-primary-600"}),r.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"Partial Payment"}),r.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Add payments for raw materials (Optional)"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Original Total:"}),r.jsx("span",{className:"font-bold text-gray-900",children:(0,w.formatIndianCurrency)(e)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Total Paid:"}),r.jsx("span",{className:"font-bold text-green-600",children:(0,w.formatIndianCurrency)(a)})]}),(0,r.jsxs)("div",{className:"pt-2 border-t border-blue-200 flex justify-between",children:[r.jsx("span",{className:"text-base font-semibold text-gray-700",children:"Remaining:"}),r.jsx("span",{className:`text-base font-bold ${n>0?"text-red-600":"text-green-600"}`,children:(0,w.formatIndianCurrency)(Math.abs(n))})]})]})}),t.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-700",children:"Payment History"}),t.map(e=>{let t=e.date?new Date(e.date):new Date;return(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[r.jsx("span",{className:"font-semibold text-gray-900",children:(0,w.formatIndianCurrency)(e.amount)}),r.jsx("span",{className:"text-xs text-gray-500",children:(0,v.ZP)(t,"dd MMM yyyy")})]}),e.note&&(0,r.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:["• ",e.note]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 ml-3",children:[r.jsx("button",{onClick:()=>handleEditPayment(e.id),className:"p-1.5 bg-blue-50 text-blue-600 rounded active:bg-blue-100 transition-colors",style:{WebkitTapHighlightColor:"transparent"},title:e.ledgerEntryId?"Edit payment (from ledger)":"Edit payment",children:r.jsx(g.Z,{size:14})}),r.jsx("button",{onClick:()=>handleRemovePayment(e.id),className:"p-1.5 bg-red-50 text-red-600 rounded active:bg-red-100 transition-colors",style:{WebkitTapHighlightColor:"transparent"},title:e.ledgerEntryId?"Remove payment (from ledger)":"Remove payment",children:r.jsx(y.Z,{size:14})}),e.ledgerEntryId&&r.jsx("span",{className:"text-[10px] bg-purple-100 text-purple-700 px-2 py-1 rounded font-medium",children:"From Ledger"})]})]},e.id)})]}),n>0&&(0,r.jsxs)("button",{onClick:handleAddPayment,className:"w-full py-3 bg-primary-600 text-white rounded-xl font-semibold active:bg-primary-700 transition-colors flex items-center justify-center gap-2 active:scale-[0.98] shadow-lg shadow-primary-600/30",style:{WebkitTapHighlightColor:"transparent"},children:[r.jsx(h.Z,{size:20}),"Add Payment"]}),0===t.length&&r.jsx("div",{className:"text-center py-8 text-gray-500 text-sm",children:"No payments added yet. You can skip this step or add payments later."})]})]})},renderReviewStep=()=>{let e=L.weight*L.rate,t=L.originalWeight*L.originalRate,a=e-(t+L.additionalCost);return(0,r.jsxs)("div",{className:"py-6",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[r.jsx(p.Z,{size:64,className:"mx-auto mb-4 text-primary-600"}),r.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:I?"Edit Order":"Review Order"}),r.jsx("p",{className:"text-gray-600",children:I?"Click on any field to edit, then save your changes":"Review all details before saving"})]}),r.jsx("div",{className:"space-y-3",children:Z.slice(0,-1).map((e,t)=>{let a=getStepIcon(e),n=getStepValue(e);return r.jsx("button",{onClick:()=>handleStepClick(t),className:"w-full text-left bg-white border border-gray-200 rounded-xl p-4 active:bg-gray-50 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"p-2 bg-primary-50 rounded-lg",children:r.jsx(a,{size:20,className:"text-primary-600"})}),(0,r.jsxs)("div",{children:[r.jsx("div",{className:"text-xs text-gray-500 mb-0.5",children:getStepLabel(e)}),r.jsx("div",{className:"text-sm font-semibold text-gray-900",children:n})]})]}),r.jsx(g.Z,{size:18,className:"text-gray-400"})]})},e)})}),r.jsx("div",{className:"mt-6 bg-gradient-to-br from-primary-50 to-primary-100 rounded-xl p-4 border border-primary-200",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Total:"}),r.jsx("span",{className:"font-bold text-gray-900",children:(0,w.formatIndianCurrency)(e)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Original Total:"}),r.jsx("span",{className:"font-bold text-gray-900",children:(0,w.formatIndianCurrency)(t)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Additional Cost:"}),r.jsx("span",{className:"font-bold text-gray-900",children:(0,w.formatIndianCurrency)(L.additionalCost)})]}),(()=>{let e=L.partialPayments||[],a=e.reduce((e,t)=>e+Number(t.amount||0),0),n=t-a;return e.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Payments:"}),r.jsx("span",{className:"font-bold text-green-600",children:(0,w.formatIndianCurrency)(a)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[r.jsx("span",{className:"text-gray-600",children:"Remaining:"}),r.jsx("span",{className:`font-bold ${n>0?"text-red-600":"text-green-600"}`,children:(0,w.formatIndianCurrency)(Math.abs(n))})]})]}):null})(),(0,r.jsxs)("div",{className:"pt-2 border-t border-primary-200 flex justify-between",children:[r.jsx("span",{className:"text-base font-semibold text-gray-700",children:"Profit:"}),r.jsx("span",{className:`text-base font-bold ${a>=0?"text-green-600":"text-red-600"}`,children:(0,w.formatIndianCurrency)(a)})]})]})})]})},getStepValue=e=>{switch(e){case"date":return L.date?(0,v.ZP)(new Date(L.date),"dd MMM yyyy"):"Not set";case"partyName":return L.partyName||"Not set";case"siteName":return L.siteName||"Not set";case"material":return L.material.length>0?L.material.join(", "):"Not set";case"weight":return L.weight>0?`${L.weight} tons`:"Not set";case"rate":return L.rate>0?(0,w.formatIndianCurrency)(L.rate):"Not set";case"truckOwner":return L.truckOwner||"Not set";case"truckNo":return L.truckNo||"Not set";case"supplier":return L.supplier||"Not set";case"originalWeight":return L.originalWeight>0?`${L.originalWeight} tons`:"Not set";case"originalRate":return L.originalRate>0?(0,w.formatIndianCurrency)(L.originalRate):"Not set";case"additionalCost":return L.additionalCost>0?(0,w.formatIndianCurrency)(L.additionalCost):"₹0";case"payment":let t=L.partialPayments||[],a=t.reduce((e,t)=>e+Number(t.amount||0),0);return t.length>0?`${t.length} payment(s) - ${(0,w.formatIndianCurrency)(a)}`:"No payments";default:return""}};return E>0&&(()=>{E>0&&O(E-1)},x.Z),I&&"review"===Z[E]||Z.length,getStepLabel(Z[E]),f.Z,Z.map((e,t)=>{let a=isStepComplete(e),n=t===E;return r.jsx("button",{onClick:()=>handleStepClick(t),className:`flex-1 h-1.5 rounded-full transition-all duration-200 ease-out ${a?"bg-green-500":n?"bg-primary-600":"bg-gray-300"}`,style:{WebkitTapHighlightColor:"transparent",transform:n?"scaleY(1.2)":"scaleY(1)"},title:getStepLabel(e)},e)}),"review"!==Z[E]&&(()=>{let e=Z.filter(e=>"review"!==e),t=e.filter((e,t)=>{let a=getStepValue(e);return"Not set"!==a&&"₹0"!==a&&""!==a&&"No payments"!==a});return 0===t.length?null:(0,r.jsxs)("div",{className:"flex-shrink-0 px-4 pt-3 pb-2 border-t border-gray-100 bg-gradient-to-br from-gray-50 to-gray-100/50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"text-xs font-semibold text-gray-700 flex items-center gap-1.5",children:[r.jsx(p.Z,{size:14,className:"text-green-600"}),"Filled Details"]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[t.length," / ",e.length," completed"]})]}),r.jsx("div",{className:"grid grid-cols-3 gap-1.5 max-h-32 overflow-y-auto",style:{WebkitOverflowScrolling:"touch"},children:e.map((e,t)=>{let a=getStepValue(e);if("Not set"===a||"₹0"===a||""===a||"No payments"===a)return null;let n=t===E,s=getStepIcon(e);return(0,r.jsxs)("button",{onClick:()=>handleStepClick(t),className:`px-1.5 py-1 bg-white border rounded text-[10px] text-left active:bg-gray-50 active:scale-[0.98] transition-all duration-150 flex items-center gap-1 shadow-sm ${n?"border-primary-400 bg-primary-50/50":"border-gray-200"}`,style:{WebkitTapHighlightColor:"transparent"},children:[r.jsx(s,{size:10,className:`flex-shrink-0 ${n?"text-primary-600":"text-gray-400"}`}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[r.jsx("div",{className:"font-medium text-gray-700 truncate",style:{fontSize:"9px"},children:getStepLabel(e)}),r.jsx("div",{className:`truncate ${n?"text-primary-700 font-semibold":"text-gray-600"}`,style:{fontSize:"10px"},children:a})]})]},e)})})]})})(),(()=>{let e=Z[E];switch(e){case"date":return C.Z,L.date,()=>{};case"partyName":return S.Z,L.partyName,e=>{H([...q,e])};case"siteName":return S.Z,L.siteName,e=>{V([...K,e])};case"material":return S.Z,[...k],L.material,e=>{D({...L,material:e})};case"weight":return j.Z,L.weight,()=>{let e=G.current;e>0&&setTimeout(()=>handleAfterEdit(),100),G.current=null};case"rate":return j.Z,L.rate,()=>{let e=G.current;e>0&&setTimeout(()=>handleAfterEdit(),100),G.current=null};case"truckOwner":return S.Z,L.truckOwner,e=>{X([...U,e])};case"truckNo":return L.truckNo,e=>{D({...L,truckNo:e.target.value})};case"supplier":return S.Z,L.supplier,e=>{Y([...B,e])};case"originalWeight":return j.Z,L.originalWeight,()=>{let e=G.current;e>0&&setTimeout(()=>handleAfterEdit(),100),G.current=null};case"originalRate":return j.Z,L.originalRate,()=>{let e=G.current;e>0&&setTimeout(()=>handleAfterEdit(),100),G.current=null};case"additionalCost":return j.Z,L.additionalCost,()=>{setTimeout(()=>handleAfterEdit(),100)};case"payment":return renderPaymentStep();case"review":return renderReviewStep();default:return}})(),"review"!==Z[E]&&(canProceed(),N.Z),"review"!==Z[E]||(M||canProceed(),M||N.Z),null}function OrderForm({order:e,onClose:t,onSave:a}){return r.jsx(OrderFormWizard,{order:e,onClose:t,onSave:a})}},64782:(e,t,a)=>{a.d(t,{h:()=>r.nativePopup});var r=a(3149)}};