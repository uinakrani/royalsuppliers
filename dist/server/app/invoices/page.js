(()=>{var e={};e.id=760,e.ids=[760],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},57147:e=>{"use strict";e.exports=require("fs")},13685:e=>{"use strict";e.exports=require("http")},85158:e=>{"use strict";e.exports=require("http2")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},71017:e=>{"use strict";e.exports=require("path")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},71267:e=>{"use strict";e.exports=require("worker_threads")},59796:e=>{"use strict";e.exports=require("zlib")},74550:(e,t,a)=>{"use strict";a.r(t),a.d(t,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>c,routeModule:()=>h,tree:()=>d});var r=a(67096),s=a(16132),i=a(37284),l=a.n(i),o=a(32564),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);a.d(t,n);let d=["",{children:["invoices",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,11642)),"C:\\Users\\ashis\\Desktop\\royalsuppliers\\royalsuppliers\\app\\invoices\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(a.bind(a,29184)),"C:\\Users\\ashis\\Desktop\\royalsuppliers\\royalsuppliers\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,9291,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\ashis\\Desktop\\royalsuppliers\\royalsuppliers\\app\\invoices\\page.tsx"],m="/invoices/page",x={require:a,loadChunk:()=>Promise.resolve()},h=new r.AppPageRouteModule({definition:{kind:s.x.APP_PAGE,page:"/invoices/page",pathname:"/invoices",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:d}})},41130:(e,t,a)=>{Promise.resolve().then(a.bind(a,80019))},80019:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>InvoicesPage});var r=a(30784),s=a(9885),i=a(39431),l=a(59233),o=a(24754),n=a(93188);let formatIndianCurrency=e=>{let t=Math.round(e).toString();if(t.length<=3)return t;let a=t.split("").reverse(),r=[];r.push(a.slice(0,3).reverse().join(""));for(let e=3;e<a.length;e+=2){let t=a.slice(e,e+2).reverse().join("");t&&r.push(t)}return r.reverse().join(",")},loadImage=async e=>{try{let t=await fetch(`${e}?t=${Date.now()}`,{cache:"no-cache"});if(!t.ok)return null;let a=await t.blob(),r=new FileReader,s=await new Promise((e,t)=>{r.onloadend=()=>{"string"==typeof r.result?e(r.result):t(Error("Failed to convert blob to data URL"))},r.onerror=t,r.readAsDataURL(a)}),i=new Image;return await new Promise((e,t)=>{i.onload=()=>{if(0===i.width||0===i.height){t(Error("Invalid image dimensions"));return}e()},i.onerror=t,i.src=s}),{dataUrl:s,img:i}}catch(t){return console.warn(`Failed to load image from ${e}:`,t),null}},addLogoToPDF=async(e,t,a)=>{let r=!1;for(let t of["/top-logo.jpg"]){let a=await loadImage(t);if(a){let{dataUrl:s,img:i}=a;console.log(`Top logo loaded successfully: ${i.width}x${i.height} from ${t}`);let l=i.height/i.width,o=80*l;e.addImage(s,"PNG",20,15,80,o),console.log("Top logo added to PDF"),r=!0;break}}r||console.warn("Top logo (top-logo.jpg) not found.");let s=!1;for(let r of["/logo.png","/logo.jpg","/logo.jpeg"]){let i=await loadImage(r);if(i){let{dataUrl:l,img:o}=i;console.log(`Watermark logo loaded successfully: ${o.width}x${o.height} from ${r}`);let n=document.createElement("canvas");n.width=o.width,n.height=o.height;let d=n.getContext("2d");if(d){d.drawImage(o,0,0);let r=d.getImageData(0,0,n.width,n.height),i=r.data;for(let e=3;e<i.length;e+=4)i[e]=Math.round(.1*i[e]);d.putImageData(r,0,0);let l=n.toDataURL("image/png"),c=o.height/o.width,m=(t-60)/2,x=(a-60)/2,h=60*c;e.addImage(l,"PNG",m,x,60,h),console.log("Watermark added to PDF"),s=!0;break}}}s||console.warn("Watermark logo (logo.png, logo.jpg, or logo.jpeg) not found.")},generateInvoicePDF=async e=>{let t=new o.ZP,a=t.internal.pageSize.getWidth(),r=t.internal.pageSize.getHeight();t.setFont("helvetica","normal"),t.setProperties({title:"Invoice",subject:"Order Invoice",author:"Royal Suppliers",creator:"Royal Suppliers"}),await addLogoToPDF(t,a,r);let s=a-40,i=45,l=new Date(e.createdAt?e.createdAt:e.date),d=(0,n.ZP)(l,"yyMMddHHmm"),c=`ROYAL${d}`;t.setFontSize(11),t.setFont("helvetica","normal"),t.setTextColor(100,100,100),t.text(c,a-20,i,{align:"right",charSpace:0}),i+=12;let m=20+s/2+20;t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,30,30),t.text("Billed to:",20,i,{charSpace:0}),i+=7,t.setFont("helvetica","normal"),t.setFontSize(12),t.setTextColor(50,50,50),t.text(e.partyName,20,i,{charSpace:0}),i+=6,t.text(e.siteName,20,i,{charSpace:0});let x=i-13;t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor(30,30,30),t.text("From:",m,x,{charSpace:0}),t.setFont("helvetica","normal"),t.setTextColor(50,50,50),t.text("Royal Suppliers",m,x+7,{charSpace:0}),i+=18,t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(100,100,100);let h=20+s,p=h-20,g=.15*p,u=.3*p,y=.18*p,v=.18*p,f=.19*p,b=20+g,j=b+u,w=j+y,N=w+v;t.setDrawColor(0,0,0),t.setLineWidth(.5);let S=i-4;t.line(20,S,20+p,S);let P=i+4;t.line(20,P,20+p,P);let C=(S+P)/2+1.5;t.text("Date",20,C,{charSpace:0}),t.text("Material",b,C,{charSpace:0}),t.text("Weight",j+y,C,{charSpace:0,align:"right"}),t.text("Rate",w+v,C,{charSpace:0,align:"right"}),t.text("Total",N+f,C,{charSpace:0,align:"right"}),i=P+6,t.setFont("helvetica","normal"),t.setFontSize(11),t.setTextColor(50,50,50);let F=Array.isArray(e.material)?e.material:[e.material],T=F.join(", "),I=t.splitTextToSize(T,u-5),D={charSpace:0},A=new Date(e.date),k=(0,n.ZP)(A,"dd MMM yyyy");t.text(k,20,i,D),Array.isArray(I)?I.forEach((e,a)=>{t.text(e,b,i+7*a,D)}):t.text(I,b,i,D),t.text(e.weight.toFixed(2),j+y,i,{charSpace:0,align:"right"}),t.text(`Rs.${formatIndianCurrency(e.rate)}`,w+v,i,{charSpace:0,align:"right"}),t.text(`Rs.${formatIndianCurrency(e.total)}`,N+f,i,{charSpace:0,align:"right"});let z=Math.max(7,7*I.length);i+=z+5;let M=r-50,$=M;t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,30,30),t.text("Subtotal:",h-60,$,{charSpace:0}),t.setFont("helvetica","normal"),t.text(`Rs.${formatIndianCurrency(e.total)}`,h,$,{align:"right",charSpace:0}),$+=8,e.profit<0&&(t.setFont("helvetica","bold"),t.setFontSize(12),t.text("Discount Applied:",h-60,$,{charSpace:0}),t.setFont("helvetica","normal"),t.setTextColor(220,38,38),t.text(`- Rs.${formatIndianCurrency(Math.abs(e.profit))}`,h,$,{align:"right",charSpace:0}),t.setTextColor(50,50,50),$+=8),$+=4,t.setDrawColor(200,200,200),t.line(h-60,$,h,$),$+=8,t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("Total:",h-60,$,{charSpace:0});let R=e.total+(e.profit<0?e.profit:0);t.text(`Rs.${formatIndianCurrency(R)}`,h,$,{align:"right",charSpace:0}),t.save(`Invoice_${e.partyName}_${(0,n.ZP)(new Date(e.date),"ddMMyyyy")}.pdf`)},generateMultipleInvoicesPDF=async e=>{if(0===e.length)return;let t=new o.ZP,a=t.internal.pageSize.getWidth(),r=t.internal.pageSize.getHeight();t.setFont("helvetica","normal"),t.setProperties({title:"Invoice",subject:"Order Invoice",author:"Royal Suppliers",creator:"Royal Suppliers"}),await addLogoToPDF(t,a,r);let s=a-40,i=45,l=new Date(e[0].createdAt?e[0].createdAt:e[0].date),d=(0,n.ZP)(l,"yyMMddHHmm"),c=`ROYAL${d}`;t.setFontSize(11),t.setFont("helvetica","normal"),t.setTextColor(100,100,100),t.text(c,a-20,i,{align:"right",charSpace:0}),i+=12;let m=20+s/2+20,x=e[0].partyName,h=i;t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,30,30),t.text("Billed to:",20,i,{charSpace:0}),i+=7,t.setFont("helvetica","normal"),t.setFontSize(12),t.setTextColor(50,50,50),t.text(x,20,i,{charSpace:0}),i+=6;let p=Array.from(new Set(e.map(e=>(e.siteName||"").trim()).filter(e=>e&&e.length>0)));0===p.length?e[0].siteName&&(t.text((e[0].siteName||"").trim(),20,i,{charSpace:0}),i+=6):p.forEach(e=>{t.text(e,20,i,{charSpace:0}),i+=6}),t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor(30,30,30),t.text("From:",m,h,{charSpace:0}),t.setFont("helvetica","normal"),t.setTextColor(50,50,50),t.text("Royal Suppliers",m,h+7,{charSpace:0}),i=Math.max(i,h+20)+10,t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(100,100,100);let g=20+s,u=g-20,y=.15*u,v=.3*u,f=.18*u,b=.18*u,j=.19*u,w=20+y,N=w+v,S=N+f,P=S+b;t.setDrawColor(0,0,0),t.setLineWidth(.5);let C=i-4;t.line(20,C,20+u,C);let F=i+4;t.line(20,F,20+u,F);let T=(C+F)/2+1.5;t.text("Date",20,T,{charSpace:0}),t.text("Material",w,T,{charSpace:0}),t.text("Weight",N+f,T,{charSpace:0,align:"right"}),t.text("Rate",S+b,T,{charSpace:0,align:"right"}),t.text("Total",P+j,T,{charSpace:0,align:"right"}),i=F+6,t.setFont("helvetica","normal"),t.setFontSize(11),t.setTextColor(50,50,50);let I=0;for(let s of e){i>r-100&&(t.addPage(),await addLogoToPDF(t,a,r),i=45);let e=Array.isArray(s.material)?s.material:[s.material],l=e.join(", "),o=t.splitTextToSize(l,v-5),d={charSpace:0},c=new Date(s.date),m=(0,n.ZP)(c,"dd MMM yyyy");t.text(m,20,i,d),Array.isArray(o)?o.forEach((e,a)=>{t.text(e,w,i+7*a,d)}):t.text(o,w,i,d),t.text(s.weight.toFixed(2),N+f,i,{charSpace:0,align:"right"}),t.text(`Rs.${formatIndianCurrency(s.rate)}`,S+b,i,{charSpace:0,align:"right"}),t.text(`Rs.${formatIndianCurrency(s.total)}`,P+j,i,{charSpace:0,align:"right"});let x=Math.max(7,7*o.length);i+=x+4,I+=s.total}i+=5;let D=r-50,A=D;t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,30,30),t.text("Subtotal:",g-60,A,{charSpace:0}),t.setFont("helvetica","normal"),t.text(`Rs.${formatIndianCurrency(I)}`,g,A,{align:"right",charSpace:0}),A+=12,t.setDrawColor(200,200,200),t.line(g-60,A,g,A),A+=8,t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("Total:",g-60,A,{charSpace:0}),t.text(`Rs.${formatIndianCurrency(I)}`,g,A,{align:"right",charSpace:0});let k=`Invoice_${x}_${(0,n.ZP)(new Date,"ddMMyyyy")}.pdf`;t.save(k)};var d=a(81766),c=a(2861),m=a(92032),x=a(51831),h=a(22385),p=a(12029),g=a(39546),u=a(85574),y=a(37004),v=a(26303),f=a(83643),b=a(64782),j=a(92484),w=a(58683),N=a(97684),S=a(57114),P=a(2389);function InvoicesPage(){let[e,t]=(0,s.useState)([]),[a,o]=(0,s.useState)([]),[C,F]=(0,s.useState)(!0),[T,I]=(0,s.useState)(!1),[D,A]=(0,s.useState)({}),[k,z]=(0,s.useState)([]),[M,$]=(0,s.useState)(null),[R,Z]=(0,s.useState)({}),[_,q]=(0,s.useState)(!1),W=(0,S.useRouter)(),[E,H]=(0,s.useState)(""),[O,U]=(0,s.useState)(""),[L,B]=(0,s.useState)(""),[G,X]=(0,s.useState)(""),[Y,K]=(0,s.useState)("");(0,s.useEffect)(()=>{loadInvoices(),loadPartyNames()},[]),(0,s.useEffect)(()=>{applyFilters()},[e,D]);let loadInvoices=async()=>{F(!0);try{let e=await i.z.getAllInvoices();t(e);let a={};for(let t of e){let e=[];for(let a of t.orderIds){let t=await l.XK.getOrderById(a);t&&e.push(t)}a[t.id]=e}Z(a)}catch(e){console.error("Error loading invoices:",e),(0,f.showToast)("Failed to load invoices","error")}finally{F(!1)}},loadPartyNames=async()=>{try{let e=await i.z.getUniquePartyNames();z(e)}catch(e){console.error("Error loading party names:",e)}},applyFilters=()=>{let t=[...e];D.partyName&&(t=t.filter(e=>e.partyName===D.partyName)),void 0!==D.paid&&(t=t.filter(e=>e.paid===D.paid)),void 0!==D.overdue&&(t=t.filter(e=>e.overdue===D.overdue)),D.startDate&&(t=t.filter(e=>new Date(e.createdAt)>=new Date(D.startDate))),D.endDate&&(t=t.filter(e=>new Date(e.createdAt)<=new Date(D.endDate))),o(t)},applyFilterForm=()=>{let e={};E&&(e.partyName=E),O&&(e.startDate=O),L&&(e.endDate=L),"paid"===G&&(e.paid=!0),"unpaid"===G&&(e.paid=!1),"overdue"===Y&&(e.overdue=!0),"not-overdue"===Y&&(e.overdue=!1),A(e),I(!1)},resetFilters=()=>{H(""),U(""),B(""),X(""),K(""),A({}),I(!1)},handleAddPayment=async t=>{let a=e.find(e=>e.id===t);if(!a)return;let r=a.totalAmount-(a.paidAmount||0);try{let e=await b.h.prompt({title:"Add Payment",message:`Remaining balance: ${(0,d.formatIndianCurrency)(r)}`,inputLabel:"Payment Amount",inputPlaceholder:"Enter amount",inputType:"text",formatCurrencyInr:!0,confirmText:"Add Payment",cancelText:"Cancel"});if(!e)return;let a=parseFloat(e);if(isNaN(a)||a<=0){(0,f.showToast)("Invalid amount","error");return}if(a>r){(0,f.showToast)(`Amount cannot exceed remaining balance of ${(0,d.formatIndianCurrency)(r)}`,"error");return}let s=await b.h.prompt({title:"Payment Note (optional)",inputLabel:"Note",inputPlaceholder:"Add a note (optional)",inputType:"text",required:!1,confirmText:"Save",cancelText:"Skip"});await i.z.addPayment(t,a,s||void 0),(0,f.showToast)("Payment added successfully!","success"),await loadInvoices()}catch(e){e?.message&&!e.message.includes("SweetAlert")&&(0,f.showToast)(`Failed to add payment: ${e?.message||"Unknown error"}`,"error")}},handleRemovePayment=async(e,t)=>{try{let a=await b.h.confirm({title:"Remove Payment?",message:"Are you sure you want to remove this payment?",icon:"warning",confirmText:"Remove",cancelText:"Cancel"});if(!a)return;await i.z.removePayment(e,t),(0,f.showToast)("Payment removed successfully!","success"),await loadInvoices()}catch(e){e?.message&&!e.message.includes("SweetAlert")&&(0,f.showToast)(`Failed to remove payment: ${e?.message||"Unknown error"}`,"error")}},handleDeleteInvoice=async e=>{try{let t=await b.h.confirm({title:"Delete Invoice?",message:"Are you sure you want to delete this invoice? This will unmark the orders as invoiced.",icon:"warning",confirmText:"Delete",cancelText:"Cancel"});if(!t)return;await i.z.deleteInvoice(e),(0,f.showToast)("Invoice deleted successfully!","success"),await loadInvoices()}catch(e){e?.message&&!e.message.includes("SweetAlert")&&(0,f.showToast)(`Failed to delete invoice: ${e?.message||"Unknown error"}`,"error")}},handleDownloadInvoice=async e=>{try{let t=R[e.id]||[];if(0===t.length){(0,f.showToast)("No orders found for this invoice","error");return}1===t.length?await generateInvoicePDF(t[0]):await generateMultipleInvoicesPDF(t),(0,f.showToast)("Invoice PDF downloaded!","success")}catch(e){(0,f.showToast)(`Failed to download invoice: ${e?.message||"Unknown error"}`,"error")}},toggleExpand=e=>{$(M===e?null:e)},getStatusBadge=e=>e.paid?(0,r.jsxs)("span",{className:"px-2.5 py-1 text-xs font-bold rounded-full bg-gradient-to-r from-green-500 to-green-600 text-white flex items-center gap-1.5 shadow-sm shadow-green-500/30",children:[r.jsx(m.Z,{size:12,className:"flex-shrink-0"}),"Paid"]}):e.overdue?(0,r.jsxs)("span",{className:"px-2.5 py-1 text-xs font-bold rounded-full bg-gradient-to-r from-red-500 to-red-600 text-white flex items-center gap-1.5 shadow-sm shadow-red-500/30 animate-pulse",children:[r.jsx(x.Z,{size:12,className:"flex-shrink-0"}),"Overdue"]}):r.jsx("span",{className:"px-2.5 py-1 text-xs font-bold rounded-full bg-gradient-to-r from-amber-400 to-amber-500 text-white flex items-center gap-1.5 shadow-sm shadow-amber-500/30",children:"Pending"});return C?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",style:{paddingBottom:"calc(4rem + env(safe-area-inset-bottom, 0))"},children:[r.jsx("div",{className:"bg-primary-600 text-white p-2.5 sticky top-0 z-40",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx("h1",{className:"text-xl font-bold",children:"Invoices"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>q(!0),className:"p-1.5 bg-primary-500 rounded-lg hover:bg-primary-500/80 transition-colors flex items-center justify-center",children:r.jsx(h.Z,{size:18})}),r.jsx("button",{onClick:()=>I(!T),className:"p-1.5 bg-primary-500 rounded-lg hover:bg-primary-500/80 transition-colors flex items-center justify-center",children:r.jsx(p.Z,{size:18})})]})]})}),r.jsx("div",{className:"fixed inset-0 flex items-center justify-center z-30 bg-gray-50",children:r.jsx(w.Z,{size:100})}),r.jsx(c.Z,{})]}):(0,r.jsxs)("div",{className:"bg-gray-50",style:{height:"100dvh",minHeight:"100dvh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[r.jsx("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 text-white p-4 pt-safe sticky top-0 z-40 shadow-lg",style:{flexShrink:0},children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h1",{className:"text-2xl font-bold mb-0.5",children:"Invoices"}),(0,r.jsxs)("p",{className:"text-xs text-primary-100 opacity-90",children:[a.length," ",1===a.length?"invoice":"invoices"]})]}),r.jsx("button",{onClick:()=>I(!T),className:"p-2.5 bg-white/20 backdrop-blur-sm text-white rounded-xl hover:bg-white/30 active:scale-95 transition-all duration-150 flex items-center justify-center shadow-sm",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:r.jsx(p.Z,{size:20})})]})}),(0,r.jsxs)("div",{style:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",paddingBottom:"4rem"},children:[(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[r.jsx(j.Z,{isOpen:T,onClose:()=>I(!1),title:"Filters",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Party Name"}),(0,r.jsxs)("select",{value:E,onChange:e=>H(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg",children:[r.jsx("option",{value:"",children:"All"}),k.map(e=>r.jsx("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Date"}),r.jsx("input",{type:"date",value:O,onChange:e=>U(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Date"}),r.jsx("input",{type:"date",value:L,onChange:e=>B(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Payment Status"}),(0,r.jsxs)("select",{value:G,onChange:e=>X(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg",children:[r.jsx("option",{value:"",children:"All"}),r.jsx("option",{value:"paid",children:"Paid"}),r.jsx("option",{value:"unpaid",children:"Unpaid"})]})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Overdue Status"}),(0,r.jsxs)("select",{value:Y,onChange:e=>K(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg",children:[r.jsx("option",{value:"",children:"All"}),r.jsx("option",{value:"overdue",children:"Overdue"}),r.jsx("option",{value:"not-overdue",children:"Not Overdue"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 pt-2 border-t border-gray-200 sticky bottom-0 bg-white pb-2",children:[r.jsx("button",{onClick:()=>{applyFilterForm(),I(!1)},className:"flex-1 bg-primary-600 text-white px-2 py-1 rounded-lg text-xs font-medium hover:bg-primary-700 transition-colors",children:"Apply"}),r.jsx("button",{onClick:()=>{resetFilters(),I(!1)},className:"flex-1 bg-gray-200 text-gray-700 px-2 py-1 rounded-lg text-xs font-medium hover:bg-gray-300 transition-colors",children:"Reset"})]})]})}),r.jsx("div",{className:"space-y-3 p-3",children:0===a.length?(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-12 text-center border border-gray-200 shadow-sm",style:{animation:"fadeInUp 0.4s ease-out"},children:[r.jsx("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4",children:r.jsx(g.Z,{size:40,className:"text-gray-400"})}),r.jsx("p",{className:"text-gray-600 font-medium text-base",children:"No invoices found"}),r.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Try adjusting your filters"})]}):a.map((e,t)=>{let a=R[e.id]||[],s=e.totalAmount-(e.paidAmount||0),i=M===e.id,l=e.totalAmount>0?(e.paidAmount||0)/e.totalAmount*100:0;return(0,r.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition-all duration-300 ease-out",style:{animation:`fadeInUp 0.4s ease-out ${.05*t}s both`,WebkitTapHighlightColor:"transparent"},children:[(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-3",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[r.jsx("div",{className:"p-2 bg-gradient-to-br from-primary-500 to-primary-600 rounded-xl shadow-sm",children:r.jsx(g.Z,{size:18,className:"text-white"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[r.jsx("h3",{className:"text-base font-bold text-gray-900 truncate",children:e.invoiceNumber}),r.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:e.partyName})]})]}),getStatusBadge(e)]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-shrink-0",children:[r.jsx("button",{onClick:t=>{(0,P.m)(t),handleDownloadInvoice(e)},className:"p-2.5 bg-gradient-to-br from-primary-500 to-primary-600 text-white rounded-xl hover:from-primary-600 hover:to-primary-700 flex items-center justify-center shadow-sm shadow-primary-500/30 active:scale-95 transition-all duration-150",title:"Download Invoice",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:r.jsx(u.Z,{size:16})}),!e.paid&&r.jsx("button",{onClick:t=>{(0,P.m)(t),handleAddPayment(e.id)},className:"p-2.5 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 flex items-center justify-center shadow-sm shadow-green-500/30 active:scale-95 transition-all duration-150",title:"Add Payment",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:r.jsx(h.Z,{size:16})})]})]}),!e.paid&&(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1.5",children:[r.jsx("span",{className:"text-xs font-medium text-gray-600",children:"Payment Progress"}),(0,r.jsxs)("span",{className:"text-xs font-bold text-primary-600",children:[l.toFixed(0),"%"]})]}),r.jsx("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-gradient-to-r from-primary-500 to-primary-600 rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:`${Math.min(100,l)}%`}})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-3 border border-gray-200",children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Site"}),r.jsx("p",{className:"text-sm font-semibold text-gray-900 truncate",children:e.siteName})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-3 border border-gray-200",children:[r.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Due Date"}),r.jsx("p",{className:`text-sm font-semibold ${e.overdue?"text-red-600":"text-gray-900"}`,children:(0,n.ZP)(new Date(e.dueDate),"dd MMM yyyy")})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-br from-primary-50 to-primary-100 rounded-xl p-3 border border-primary-200",children:[r.jsx("p",{className:"text-xs text-primary-600 font-medium mb-1",children:"Total Amount"}),r.jsx("p",{className:"text-lg font-bold text-primary-700",children:(0,d.formatIndianCurrency)(e.totalAmount)})]}),(0,r.jsxs)("div",{className:`rounded-xl p-3 border ${e.paid?"bg-gradient-to-br from-green-50 to-green-100 border-green-200":"bg-gradient-to-br from-red-50 to-red-100 border-red-200"}`,children:[r.jsx("p",{className:`text-xs font-medium mb-1 ${e.paid?"text-green-600":"text-red-600"}`,children:e.paid?"Paid":"Remaining"}),r.jsx("p",{className:`text-lg font-bold ${e.paid?"text-green-700":"text-red-700"}`,children:(0,d.formatIndianCurrency)(e.paid?e.paidAmount||0:s)})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[r.jsx(y.Z,{size:12}),a.length," Order",1!==a.length?"s":""]}),r.jsx("span",{children:"•"}),(0,r.jsxs)("span",{children:[e.partialPayments?.length||0," Payment",e.partialPayments?.length!==1?"s":""]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:t=>{(0,P.m)(t),toggleExpand(e.id)},className:"px-3 py-1.5 bg-gray-100 text-gray-700 rounded-xl text-xs font-semibold hover:bg-gray-200 active:scale-95 transition-all duration-150",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:i?"Hide Details":"View Details"}),(0,r.jsxs)("button",{onClick:t=>{(0,P.m)(t),handleDeleteInvoice(e.id)},className:"px-3 py-1.5 bg-red-100 text-red-700 rounded-xl text-xs font-semibold hover:bg-red-200 active:scale-95 transition-all duration-150 flex items-center gap-1.5",title:"Delete Invoice",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:[r.jsx(v.Z,{size:12}),"Delete"]})]})]})]}),r.jsx("div",{className:`overflow-hidden transition-all duration-300 ease-out ${i?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"}`,children:r.jsx("div",{className:"p-4 bg-gradient-to-br from-gray-50 to-white border-t border-gray-200",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx("div",{className:"p-1.5 bg-primary-100 rounded-lg",children:r.jsx(y.Z,{size:14,className:"text-primary-600"})}),(0,r.jsxs)("h4",{className:"text-sm font-bold text-gray-900",children:["Orders (",a.length,")"]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm",children:[(0,r.jsxs)("div",{className:"hidden sm:grid grid-cols-12 gap-1.5 p-1.5 bg-gray-100 border-b border-gray-200 text-xs font-semibold text-gray-700",children:[r.jsx("div",{className:"col-span-2",children:"Date"}),r.jsx("div",{className:"col-span-5",children:"Material"}),r.jsx("div",{className:"col-span-1 text-right",children:"Weight"}),r.jsx("div",{className:"col-span-2 text-right",children:"Rate"}),r.jsx("div",{className:"col-span-2 text-right",children:"Total"})]}),r.jsx("div",{className:"divide-y divide-gray-200",children:a.map(e=>(0,r.jsxs)("div",{className:"p-1.5 hover:bg-gray-50",children:[(0,r.jsxs)("div",{className:"hidden sm:grid grid-cols-12 gap-1.5 text-xs",children:[r.jsx("div",{className:"col-span-2 text-gray-900",children:(0,n.ZP)(new Date(e.date),"dd MMM yyyy")}),r.jsx("div",{className:"col-span-5 text-gray-900 truncate",title:Array.isArray(e.material)?e.material.join(", "):e.material,children:Array.isArray(e.material)?e.material.join(", "):e.material}),r.jsx("div",{className:"col-span-1 text-right text-gray-900",children:e.weight.toFixed(2)}),r.jsx("div",{className:"col-span-2 text-right text-gray-900",children:(0,d.formatIndianCurrency)(e.rate)}),r.jsx("div",{className:"col-span-2 text-right font-semibold text-gray-900",children:(0,d.formatIndianCurrency)(e.total)})]}),(0,r.jsxs)("div",{className:"sm:hidden space-y-1 text-xs",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[r.jsx("p",{className:"font-semibold text-gray-900",children:(0,n.ZP)(new Date(e.date),"dd MMM yyyy")}),r.jsx("p",{className:"text-gray-600 mt-0.5",children:Array.isArray(e.material)?e.material.join(", "):e.material})]}),r.jsx("p",{className:"font-semibold text-gray-900 ml-2",children:(0,d.formatIndianCurrency)(e.total)})]}),(0,r.jsxs)("div",{className:"flex gap-3 text-gray-600",children:[(0,r.jsxs)("span",{children:["Weight: ",e.weight.toFixed(2)]}),(0,r.jsxs)("span",{children:["Rate: ",(0,d.formatIndianCurrency)(e.rate)]})]})]})]},e.id))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[r.jsx("div",{className:"p-1.5 bg-green-100 rounded-lg",children:r.jsx(m.Z,{size:14,className:"text-green-600"})}),(0,r.jsxs)("h4",{className:"text-sm font-bold text-gray-900",children:["Payments (",e.partialPayments?.length||0,")"]})]}),e.partialPayments&&e.partialPayments.length>0?r.jsx("div",{className:"space-y-2",children:e.partialPayments.map((t,a)=>(0,r.jsxs)("div",{className:"bg-white p-3 rounded-xl border border-gray-200 flex justify-between items-center shadow-sm hover:shadow-md transition-shadow duration-200",style:{animation:`fadeInUp 0.3s ease-out ${.05*a}s both`},children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("p",{className:"font-bold text-gray-900 text-sm",children:(0,d.formatIndianCurrency)(t.amount)}),r.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 rounded-full text-xs font-semibold",children:"Paid"})]}),r.jsx("p",{className:"text-xs text-gray-500",children:(0,n.ZP)(new Date(t.date),"dd MMM yyyy • HH:mm")}),t.note&&r.jsx("p",{className:"text-xs text-gray-600 mt-1.5 bg-gray-50 px-2 py-1 rounded-lg",children:t.note})]}),(0,r.jsxs)("button",{onClick:a=>{(0,P.m)(a),handleRemovePayment(e.id,t.id)},className:"ml-3 px-3 py-2 bg-red-100 text-red-700 rounded-xl text-xs font-semibold hover:bg-red-200 active:scale-95 transition-all duration-150 flex items-center gap-1.5",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:[r.jsx(v.Z,{size:12}),"Remove"]})]},t.id))}):(0,r.jsxs)("div",{className:"bg-white p-4 rounded-xl border border-gray-200 text-center",children:[r.jsx("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2",children:r.jsx(x.Z,{size:20,className:"text-gray-400"})}),r.jsx("p",{className:"text-sm text-gray-600 font-medium",children:"No payments recorded"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Add a payment to track invoice status"})]})]})]})})})]},e.id)})})]}),_&&r.jsx(N.Z,{order:null,onClose:()=>q(!1),onSave:async e=>{try{let t=await l.XK.createOrder(e);(0,f.showToast)("Order created successfully!","success"),q(!1),W.push(`/orders?highlight=${t}`)}catch(e){throw(0,f.showToast)(e?.message||"Failed to create order","error"),e}}})]}),r.jsx(c.Z,{})]})}},11642:(e,t,a)=>{"use strict";a.r(t),a.d(t,{$$typeof:()=>l,__esModule:()=>i,default:()=>n});var r=a(95153);let s=(0,r.createProxy)(String.raw`C:\Users\ashis\Desktop\royalsuppliers\royalsuppliers\app\invoices\page.tsx`),{__esModule:i,$$typeof:l}=s,o=s.default,n=o}};var t=require("../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),a=t.X(0,[252,166,392,813,416,868,943,123,233,766,599,265],()=>__webpack_exec__(74550));module.exports=a})();