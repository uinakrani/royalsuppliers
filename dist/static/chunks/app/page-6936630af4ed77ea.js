(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{90998:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(62898);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s.Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]])},42482:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(62898);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s.Z)("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]])},96142:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(62898);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s.Z)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]])},85790:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(62898);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s.Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},11961:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(62898);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s.Z)("Truck",[["path",{d:"M5 18H3c-.6 0-1-.4-1-1V7c0-.6.4-1 1-1h10c.6 0 1 .4 1 1v11",key:"hs4xqm"}],["path",{d:"M14 9h4l4 4v4c0 .6-.4 1-1 1h-2",key:"11fp61"}],["circle",{cx:"7",cy:"18",r:"2",key:"19iecd"}],["path",{d:"M15 18H9",key:"1lyqi6"}],["circle",{cx:"17",cy:"18",r:"2",key:"332jqn"}]])},39781:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});var s=a(62898);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let r=(0,s.Z)("Weight",[["circle",{cx:"12",cy:"5",r:"3",key:"rqqgnr"}],["path",{d:"M6.5 8a2 2 0 0 0-1.905 1.46L2.1 18.5A2 2 0 0 0 4 21h16a2 2 0 0 0 1.925-2.54L19.4 9.5A2 2 0 0 0 17.48 8Z",key:"56o5sh"}]])},64763:function(e,t,a){Promise.resolve().then(a.bind(a,30346))},30346:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Dashboard}});var s=a(57437),r=a(2265),i=a(70349),l=a(98025),n=a(6308),o=a(96918),d=a(36076),c=a(43568),m=a(98124),x=a(35876),u=a(71037);let calculateStats=(e,t,a,s)=>{let r={totalWeight:0,totalCost:0,totalProfit:0,currentBalance:0,totalOrders:e.length,paidOrders:0,unpaidOrders:0,partialOrders:0,estimatedProfit:0,paymentReceived:0,costAmount:0,moneyOut:0,rawMaterialPaymentsOutstanding:0,customerPaymentsReceived:0,rawMaterialPaymentsReceived:0,profitReceived:0,calculatedBalance:0};if(e.forEach(e=>{r.totalWeight+=e.weight;let t=e.originalTotal+e.additionalCost;r.totalCost+=t,r.costAmount+=t;let a=(0,u.I)(e);r.totalProfit+=a,r.estimatedProfit+=a;let s=e.partialPayments||[],i=s.reduce((e,t)=>e+t.amount,0);r.rawMaterialPaymentsReceived+=i;let l=Math.max(0,e.originalTotal-i);r.rawMaterialPaymentsOutstanding+=l,i>=e.originalTotal-250&&e.originalTotal>0?r.paidOrders++:(i>0&&r.partialOrders++,r.unpaidOrders++)}),t){let e=0,i=0,l=0;t.forEach(t=>{let r=new Date(t.date),n=!0;a&&r<a&&(n=!1),s&&r>s&&(n=!1),n&&("credit"===t.type?(e+=t.amount,t.partyName&&t.partyName.trim()&&(i+=t.amount)):"debit"===t.type&&(l+=t.amount))}),r.customerPaymentsReceived=i,r.moneyOut=l,r.calculatedBalance=i-l}return r},getDateRangeForDuration=e=>{let t;let a=new Date,s=a;switch(e){case"7days":t=function(e,t){let a=(0,d.Q)(e);return isNaN(t)?(0,c.L)(e,NaN):(t&&a.setDate(a.getDate()+t),a)}(a,-7);break;case"lastMonth":t=(0,n.Z)((0,m.Z)(a,1)),s=(0,o.Z)((0,m.Z)(a,1));break;case"last3Months":t=(0,m.Z)(a,3);break;case"last6Months":t=(0,m.Z)(a,6);break;case"lastYear":t=(0,x.Z)((0,m.Z)(a,12)),s=(0,m.Z)(a,12);break;default:t=(0,n.Z)(a),s=(0,o.Z)(a)}return{start:t,end:s}};var p=a(74931),h=a(61444),y=a(28521),b=a(9883),f=a(42482),g=a(34822),v=a(90998),j=a(62898);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let N=(0,j.Z)("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);var w=a(11981);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let k=(0,j.Z)("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);var C=a(85790);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let P=(0,j.Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),O=(0,j.Z)("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var M=a(41298),A=a(4322),R=a(30182),Z=a(42316),I=a(41587),D=a(74513),E=a(24033),T=a(27056),z=a(86725),L=a(79699);function Dashboard(){let[e,t]=(0,r.useState)([]),[a,n]=(0,r.useState)({totalWeight:0,totalCost:0,totalProfit:0,currentBalance:0,totalOrders:0,paidOrders:0,unpaidOrders:0,partialOrders:0,estimatedProfit:0,paymentReceived:0,costAmount:0,moneyOut:0,rawMaterialPaymentsOutstanding:0,customerPaymentsReceived:0,rawMaterialPaymentsReceived:0,profitReceived:0,calculatedBalance:0}),[o,d]=(0,r.useState)(!0),[c,m]=(0,r.useState)(null),[x,j]=(0,r.useState)({}),[S,B]=(0,r.useState)(!1),[H,W]=(0,r.useState)("currentMonth"),[F,q]=(0,r.useState)(""),[K,U]=(0,r.useState)(""),[Y,_]=(0,r.useState)(""),[J,V]=(0,r.useState)(""),[X,Q]=(0,r.useState)([]),[G,$]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(null),ea=(0,E.useRouter)();(0,r.useEffect)(()=>{loadPartyNames()},[]),(0,r.useEffect)(()=>{let e=setTimeout(()=>{loadOrders(),loadInvestment()},100);return()=>clearTimeout(e)},[x,H]);let loadInvestment=async()=>{try{let e=await L.K.getInvestment();et(e)}catch(e){console.error("Error loading investment:",e)}},loadPartyNames=async()=>{try{let e=await i.XK.getUniquePartyNames();Q(e)}catch(e){console.error("Error loading party names:",e)}},loadOrders=async()=>{d(!0);try{let e=new Promise((e,t)=>{setTimeout(()=>t(Error("Loading timeout after 30 seconds")),3e4)}),a=await Promise.race([i.XK.getAllOrders(),e]),s=null,r=null;if(x.startDate||x.endDate)x.startDate&&(s=new Date(x.startDate)).setHours(0,0,0,0),x.endDate&&(r=new Date(x.endDate)).setHours(23,59,59,999);else if(H){let{start:e,end:t}=getDateRangeForDuration(H);(s=e).setHours(0,0,0,0),(r=t).setHours(23,59,59,999)}let o=a;if((s||r)&&(o=o.filter(e=>{try{let t=new Date(e.date);if(isNaN(t.getTime()))return console.warn("Invalid order date:",e.date,e.id),!1;if(t.setHours(12,0,0,0),s&&t<s||r&&t>r)return!1;return!0}catch(t){return console.warn("Error parsing order date:",e.date,t),!1}})),x.partyName){let e=x.partyName.split(",").map(e=>e.trim().toLowerCase());o=o.filter(t=>e.some(e=>t.partyName.toLowerCase()===e))}if(x.material){let e=x.material.split(",").map(e=>e.trim().toLowerCase());o=o.filter(t=>{let a=Array.isArray(t.material)?t.material.map(e=>e.toLowerCase()):[t.material.toLowerCase()];return e.some(e=>a.some(t=>t.includes(e)))})}let d=[];try{d=await z.ledgerService.list()}catch(e){console.warn("Error loading ledger entries:",e)}d.reduce((e,t)=>e+("credit"===t.type?t.amount:-t.amount),0);let c=d.reduce((e,t)=>e+("debit"===t.type?t.amount:0),0),m=a.reduce((e,t)=>e+t.total,0),p=a.reduce((e,t)=>{let a=(t.customerPayments||[]).reduce((e,t)=>e+t.amount,0);return e+Math.max(0,t.total-a)},0),h=calculateStats(o,d,s||void 0,r||void 0),y=0;o.forEach(e=>{let t=(e.customerPayments||[]).reduce((e,t)=>e+t.amount,0),a=(e.partialPayments||[]).reduce((e,t)=>e+t.amount,0),s=t-a-e.additionalCost;y+=s}),h.profitReceived=y;let b=0,f=0;d.forEach(e=>{"credit"===e.type&&e.partyName?b+=e.amount:"debit"===e.type&&(f+=e.amount)});let g=((null==ee?void 0:ee.amount)||0)+b-f;h.totalLedgerBalance=g,h.totalMoneyOutAllTime=c,h.totalRevenueAllTime=m,h.totalReceivables=p,t(o),n(h);let v=0,j=new Map(o.map(e=>[e.id,e]));try{let e=await l.z.getAllInvoices(),t=await i.XK.getAllOrders(),a=new Map(t.map(e=>[e.id,e])),n=new Map;e.forEach(e=>{if(x.partyName){let t=x.partyName.split(",").map(e=>e.trim().toLowerCase());if(!t.some(t=>e.partyName.toLowerCase()===t))return}if(x.material){let t=x.material.split(",").map(e=>e.trim().toLowerCase()),s=e.orderIds.some(e=>{let s=a.get(e);if(!s)return!1;let r=Array.isArray(s.material)?s.material.map(e=>e.toLowerCase()):[s.material.toLowerCase()];return t.some(e=>r.some(t=>t.includes(e)))});if(!s)return}let t=0;e.orderIds.forEach(e=>{let s=a.get(e);s&&j.has(e)&&(t+=s.total)}),e.partialPayments&&e.partialPayments.length>0&&e.partialPayments.forEach(i=>{let l=new Date(i.date),o=!0;s&&l<s&&(o=!1),r&&l>r&&(o=!1),o&&t>0&&e.orderIds.forEach(e=>{let s=a.get(e);if(s&&j.has(e)){let a=s.total/t,r=i.amount*a,l=n.get(e)||0;n.set(e,l+r)}})})});try{let e=await T.s.getAllPayments();e.forEach(e=>{if(x.partyName){let t=x.partyName.split(",").map(e=>e.trim().toLowerCase());if(!t.some(t=>e.partyName.toLowerCase()===t))return}let t=new Date(e.date),a=!0;s&&t<s&&(a=!1),r&&t>r&&(a=!1),a&&o.forEach(t=>{if(t.partyName===e.partyName){let a=n.get(t.id)||0,s=o.filter(t=>t.partyName===e.partyName).length;s>0&&n.set(t.id,a+e.amount/s)}})})}catch(e){console.warn("Party payments not included:",e)}o.forEach(e=>{let t=n.get(e.id)||0;if(e.total>0){let a=(0,u.I)(e);if(t>=e.total)v+=a;else if(t>0){let s=a/e.total;v+=s*t}}})}catch(e){console.error("Error loading invoices for payment calculation:",e)}h.paymentReceived=h.customerPaymentsReceived,h.profitReceived=v,t(o),n(h)}catch(a){var e;if(console.error("Error loading orders:",a),null==a?void 0:null===(e=a.message)||void 0===e?void 0:e.includes("timeout")){let e="Loading timed out. Please check your Firebase configuration or network connection.";console.error(e),m(e)}else m("Failed to load orders. Please check your Firebase configuration.");t([]),n({totalWeight:0,totalCost:0,totalProfit:0,currentBalance:0,totalOrders:0,paidOrders:0,unpaidOrders:0,partialOrders:0,estimatedProfit:0,paymentReceived:0,costAmount:0,moneyOut:0,rawMaterialPaymentsOutstanding:0,customerPaymentsReceived:0,rawMaterialPaymentsReceived:0,profitReceived:0,calculatedBalance:0})}finally{d(!1)}},applyFilters=()=>{let e={};F&&(e.partyName=F),K&&(e.material=K),Y&&(e.startDate=Y),J&&(e.endDate=J),j(e),B(!1)},resetFilters=()=>{q(""),U(""),_(""),V(""),W("currentMonth"),j({}),B(!1)};return(0,s.jsxs)("div",{className:"bg-gray-50",style:{height:"100dvh",minHeight:"100dvh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,s.jsxs)("div",{className:"bg-primary-600 text-white p-2.5 pt-safe sticky top-0 z-40",style:{flexShrink:0},children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-2",children:[(0,s.jsx)("h1",{className:"text-xl font-bold",children:"Dashboard"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{onClick:e=>{(0,R.m)(e),$(!0)},className:"p-2 bg-white/20 backdrop-blur-sm text-white rounded-xl hover:bg-white/30 transition-all native-press flex items-center justify-center",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:(0,s.jsx)(b.Z,{size:18})}),(0,s.jsx)("button",{onClick:e=>{(0,R.m)(e),B(!S)},className:"p-2 bg-white/20 backdrop-blur-sm text-white rounded-xl hover:bg-white/30 transition-all native-press flex items-center justify-center",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:(0,s.jsx)(f.Z,{size:18})})]})]}),(0,s.jsx)("div",{className:"mt-2",children:(0,s.jsxs)("select",{value:H,onChange:e=>W(e.target.value),className:"w-full px-3 py-2 bg-white/95 backdrop-blur-sm border border-white/30 rounded-xl text-sm font-medium text-gray-900 focus:outline-none focus:ring-2 focus:ring-white/50 transition-all",children:[(0,s.jsx)("option",{value:"currentMonth",children:"Current Month"}),(0,s.jsx)("option",{value:"7days",children:"Last 7 Days"}),(0,s.jsx)("option",{value:"lastMonth",children:"Last Month"}),(0,s.jsx)("option",{value:"last3Months",children:"Last 3 Months"}),(0,s.jsx)("option",{value:"last6Months",children:"Last 6 Months"}),(0,s.jsx)("option",{value:"lastYear",children:"Last Year"})]})})]}),(0,s.jsxs)("div",{style:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",paddingBottom:"4rem"},children:[(0,s.jsx)(Z.Z,{isOpen:S,onClose:()=>B(!1),title:"Filters",children:(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Date"}),(0,s.jsx)("input",{type:"date",value:Y,onChange:e=>_(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Date"}),(0,s.jsx)("input",{type:"date",value:J,onChange:e=>V(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Party Name"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2 p-2 bg-gray-50 rounded-lg border border-gray-200 max-h-48 overflow-y-auto",children:X.map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 p-1.5 rounded transition-colors",children:[(0,s.jsx)("input",{type:"checkbox",checked:F.split(",").filter(e=>e.trim()).includes(e),onChange:t=>{let a=F.split(",").filter(e=>e.trim());q((t.target.checked?[...a,e]:a.filter(t=>t!==e)).join(","))},className:"custom-checkbox"}),(0,s.jsx)("span",{className:"text-xs text-gray-700 truncate",children:e})]},e))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Material"}),(0,s.jsx)("div",{className:"grid grid-cols-2 gap-2 p-2 bg-gray-50 rounded-lg border border-gray-200 max-h-48 overflow-y-auto",children:["Bodeli","Panetha","Nareshware","Kali","Chikhli Kapchi VSI","Chikhli Kapchi","Areth"].map(e=>(0,s.jsxs)("label",{className:"flex items-center gap-1.5 cursor-pointer hover:bg-gray-100 p-1.5 rounded transition-colors",children:[(0,s.jsx)("input",{type:"checkbox",checked:K.split(",").filter(e=>e.trim()).includes(e),onChange:t=>{let a=K.split(",").filter(e=>e.trim());U((t.target.checked?[...a,e]:a.filter(t=>t!==e)).join(","))},className:"custom-checkbox"}),(0,s.jsx)("span",{className:"text-xs text-gray-700 truncate",children:e})]},e))})]}),(0,s.jsxs)("div",{className:"flex gap-2 pt-2 border-t border-gray-200 sticky bottom-0 bg-white pb-2",children:[(0,s.jsx)("button",{onClick:()=>{applyFilters(),B(!1)},className:"flex-1 bg-primary-600 text-white px-2 py-1 rounded-lg text-xs font-medium hover:bg-primary-700 transition-colors",children:"Apply"}),(0,s.jsx)("button",{onClick:()=>{resetFilters(),B(!1)},className:"px-2 py-1 bg-gray-200 text-gray-700 rounded-lg text-xs font-medium hover:bg-gray-300 transition-colors",children:"Reset"})]})]})}),o?(0,s.jsxs)("div",{className:"fixed inset-0 flex flex-col items-center justify-center z-30 bg-gray-50 gap-4 p-4",children:[(0,s.jsx)(I.Z,{size:100}),c&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 max-w-md text-center",children:[(0,s.jsx)("p",{className:"text-sm text-red-800 mb-2",children:c}),(0,s.jsx)("button",{onClick:()=>{m(null),loadOrders()},className:"text-xs bg-red-600 text-white px-3 py-1.5 rounded hover:bg-red-700",children:"Retry"})]})]}):c?(0,s.jsx)("div",{className:"p-4",children:(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 text-center",children:[(0,s.jsx)("p",{className:"text-sm text-red-800 mb-3",children:c}),(0,s.jsx)("button",{onClick:()=>{m(null),loadOrders()},className:"text-xs bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700",children:"Retry"})]})}):(0,s.jsxs)("div",{className:"p-3 space-y-3",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 rounded-2xl p-4 text-white border-2 border-amber-400",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm",children:(0,s.jsx)(g.Z,{size:20,className:"text-white"})}),(0,s.jsx)("h3",{className:"text-base font-bold text-white",children:"Your Investment (Capital)"})]}),(0,s.jsx)("p",{className:"text-3xl font-bold mb-1",children:ee?(0,p.formatIndianCurrency)(ee.amount):(0,p.formatIndianCurrency)(0)}),(0,s.jsx)("p",{className:"text-xs opacity-90 mb-3",children:ee?ee.note||"Your actual capital in the business":"Set your investment in Ledger page"}),ee&&(0,s.jsxs)("div",{className:"pt-3 border-t border-white/20 space-y-3",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsxs)("div",{className:"bg-white/10 rounded-lg p-2 backdrop-blur-sm",children:[(0,s.jsx)("p",{className:"text-[10px] opacity-80 mb-0.5 uppercase tracking-wider",children:"Available Cash"}),(0,s.jsx)("p",{className:"text-sm font-bold text-white",children:(0,p.formatIndianCurrency)(a.totalLedgerBalance||0)})]}),(0,s.jsxs)("div",{className:"bg-white/10 rounded-lg p-2 backdrop-blur-sm",children:[(0,s.jsx)("p",{className:"text-[10px] opacity-80 mb-0.5 uppercase tracking-wider",children:"Market Receivables"}),(0,s.jsx)("p",{className:"text-sm font-bold text-white",children:(0,p.formatIndianCurrency)(a.totalReceivables||0)})]})]}),(0,s.jsxs)("div",{className:"space-y-1.5 pt-1",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{className:"opacity-80",children:"Total Business Volume:"}),(0,s.jsx)("span",{className:"font-semibold",children:(0,p.formatIndianCurrency)(a.totalRevenueAllTime||0)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{className:"opacity-80",children:"Capital Rotation:"}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(v.Z,{size:12,className:"text-amber-200"}),(0,s.jsxs)("span",{className:"font-bold text-amber-100",children:[((a.totalRevenueAllTime||0)/(ee.amount||1)).toFixed(1),"x"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{className:"opacity-80",children:"Investment Date:"}),(0,s.jsx)("span",{className:"font-semibold opacity-90",children:(0,y.ZP)(new Date(ee.date),"dd MMM yyyy")})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-4 border border-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("div",{className:"p-2 bg-primary-100 rounded-xl",children:(0,s.jsx)(g.Z,{size:18,className:"text-primary-600"})}),(0,s.jsx)("h3",{className:"text-base font-bold text-gray-900",children:"Financial Overview"})]}),(0,s.jsxs)("div",{className:"mb-3 p-3 bg-red-50 rounded-xl border border-red-100",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(N,{size:16,className:"text-red-600"}),(0,s.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Money Going Out"})]}),(0,s.jsx)("span",{className:"text-lg font-bold text-red-600",children:(0,p.formatIndianCurrency)(a.moneyOut)})]}),(0,s.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Total expenses (Raw materials + Additional costs)"})]}),a.rawMaterialPaymentsOutstanding>0&&(0,s.jsxs)("div",{className:"mb-3 p-3 bg-orange-50 rounded-xl border border-orange-100",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(w.Z,{size:16,className:"text-orange-600"}),(0,s.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Outstanding Raw Materials"})]}),(0,s.jsx)("span",{className:"text-lg font-bold text-orange-600",children:(0,p.formatIndianCurrency)(a.rawMaterialPaymentsOutstanding)})]}),(0,s.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Yet to be paid for raw materials"})]}),(0,s.jsxs)("div",{className:"mb-3 p-3 bg-green-50 rounded-xl border border-green-100",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(k,{size:16,className:"text-green-600"}),(0,s.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Money Received"})]}),(0,s.jsx)("span",{className:"text-lg font-bold text-green-600",children:(0,p.formatIndianCurrency)(a.customerPaymentsReceived)})]}),(0,s.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Money received from parties (ledger credit entries with party name)"})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-4 border border-gray-100",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("div",{className:"p-2 bg-blue-100 rounded-xl",children:(0,s.jsx)(C.Z,{size:18,className:"text-blue-600"})}),(0,s.jsx)("h3",{className:"text-base font-bold text-gray-900",children:"Profit Analysis"})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"p-3 bg-blue-50 rounded-xl border border-blue-100",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Estimated Profit"}),(0,s.jsx)("span",{className:"text-lg font-bold text-blue-600",children:(0,p.formatIndianCurrency)(a.estimatedProfit)})]}),(0,s.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Total profit from all orders"})]}),(0,s.jsxs)("div",{className:"p-3 bg-purple-50 rounded-xl border border-purple-100",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsx)("span",{className:"text-sm font-semibold text-gray-700",children:"Realized Cash Profit"}),(0,s.jsx)("span",{className:"text-lg font-bold ".concat(a.profitReceived>=0?"text-purple-600":"text-red-600"),children:(0,p.formatIndianCurrency)(a.profitReceived)})]}),(0,s.jsx)("p",{className:"text-xs text-gray-600 mt-1",children:"Actual cash profit (Received - Spent - Costs)"}),a.estimatedProfit>0&&(0,s.jsxs)("div",{className:"mt-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,s.jsx)("span",{className:"text-xs text-gray-600",children:"Recovery Rate"}),(0,s.jsxs)("span",{className:"text-xs font-semibold text-purple-700",children:[(a.profitReceived/a.estimatedProfit*100).toFixed(1),"%"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:(0,s.jsx)("div",{className:"bg-purple-600 h-1.5 rounded-full transition-all duration-300",style:{width:"".concat(Math.min(100,Math.max(0,a.profitReceived/a.estimatedProfit*100)),"%")}})})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-2xl p-4 text-white",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm",children:(0,s.jsx)(g.Z,{size:20,className:"text-white"})}),(0,s.jsx)("h3",{className:"text-base font-bold text-white",children:"Current Balance"})]}),(0,s.jsx)("p",{className:"text-3xl font-bold mb-1",children:(0,p.formatIndianCurrency)(a.calculatedBalance)}),(0,s.jsx)("p",{className:"text-xs opacity-90 mb-3",children:"Money Received (from Parties) - Money Spent"}),(0,s.jsxs)("div",{className:"pt-3 border-t border-white/20 space-y-1.5",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{className:"opacity-80",children:"Received from Parties:"}),(0,s.jsx)("span",{className:"font-semibold",children:(0,p.formatIndianCurrency)(a.customerPaymentsReceived)})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs",children:[(0,s.jsx)("span",{className:"opacity-80",children:"Spent (All Expenses):"}),(0,s.jsxs)("span",{className:"font-semibold",children:["-",(0,p.formatIndianCurrency)(a.moneyOut)]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-xs pt-1 border-t border-white/10",children:[(0,s.jsx)("span",{className:"opacity-80 font-medium",children:"Net Balance:"}),(0,s.jsx)("span",{className:"font-bold ".concat(a.calculatedBalance>=0?"text-green-200":"text-red-200"),children:(0,p.formatIndianCurrency)(a.calculatedBalance)})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-4 text-white native-press",style:{animation:"fadeInUp 0.4s ease-out 0.1s both",WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},onClick:e=>{(0,R.m)(e),ea.push("/orders?filter=paid")},children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm",children:(0,s.jsx)(P,{size:20,className:"text-white"})}),(0,s.jsx)(O,{size:16,className:"opacity-70"})]}),(0,s.jsx)("p",{className:"text-2xl font-bold mb-0.5",children:(0,p.formatIndianCurrency)(a.currentBalance)}),(0,s.jsx)("p",{className:"text-xs opacity-90 font-medium",children:"Payment Balance"})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-br from-red-500 to-red-600 rounded-2xl p-4 text-white native-press",style:{animation:"fadeInUp 0.4s ease-out 0.2s both",WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},onClick:e=>{(0,R.m)(e),ea.push("/ledger")},children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm",children:(0,s.jsx)(M.Z,{size:20,className:"text-white"})}),(0,s.jsx)(O,{size:16,className:"opacity-70"})]}),(0,s.jsx)("p",{className:"text-2xl font-bold mb-0.5",children:(0,p.formatIndianCurrency)(a.costAmount)}),(0,s.jsx)("p",{className:"text-xs opacity-90 font-medium",children:"Total Cost"})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-4 border border-gray-100",style:{animation:"fadeInUp 0.4s ease-out 0.5s both"},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,s.jsx)("div",{className:"p-2 bg-primary-100 rounded-xl",children:(0,s.jsx)(v.Z,{size:18,className:"text-primary-600"})}),(0,s.jsx)("h3",{className:"text-base font-bold text-gray-900",children:"Order Summary"})]}),(0,s.jsxs)("div",{className:"space-y-2.5",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center p-2.5 bg-gray-50 rounded-xl native-press",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},onClick:e=>{(0,R.m)(e),ea.push("/orders")},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(A.Z,{size:16,className:"text-gray-600"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Total Orders"})]}),(0,s.jsx)("span",{className:"text-base font-bold text-gray-900",children:a.totalOrders})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center p-2.5 bg-green-50 rounded-xl native-press",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},onClick:e=>{(0,R.m)(e),ea.push("/orders?filter=paid")},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Paid Orders"})]}),(0,s.jsx)("span",{className:"text-base font-bold text-green-600",children:a.paidOrders})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center p-2.5 bg-red-50 rounded-xl native-press",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},onClick:e=>{(0,R.m)(e),ea.push("/orders?filter=unpaid")},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Unpaid Orders"})]}),(0,s.jsx)("span",{className:"text-base font-bold text-red-600",children:a.unpaidOrders})]}),a.partialOrders>0&&(0,s.jsxs)("div",{className:"flex justify-between items-center p-2.5 bg-yellow-50 rounded-xl native-press",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},onClick:e=>{(0,R.m)(e),ea.push("/orders?filter=partial")},children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Partial Payments"})]}),(0,s.jsx)("span",{className:"text-base font-bold text-yellow-600",children:a.partialOrders})]})]})]}),(0,s.jsxs)("div",{className:"bg-white rounded-2xl p-4 border border-gray-100",style:{animation:"fadeInUp 0.4s ease-out 0.6s both"},children:[(0,s.jsx)("h3",{className:"text-base font-bold text-gray-900 mb-3",children:"Quick Actions"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("button",{onClick:e=>{(0,R.m)(e),$(!0)},className:"flex flex-col items-center justify-center gap-2 p-4 bg-primary-50 rounded-xl border-2 border-primary-200 native-press hover:bg-primary-100 transition-colors",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:[(0,s.jsx)("div",{className:"p-2.5 bg-primary-600 rounded-xl",children:(0,s.jsx)(b.Z,{size:20,className:"text-white"})}),(0,s.jsx)("span",{className:"text-sm font-semibold text-primary-700",children:"New Order"})]}),(0,s.jsxs)("button",{onClick:e=>{(0,R.m)(e),ea.push("/orders")},className:"flex flex-col items-center justify-center gap-2 p-4 bg-blue-50 rounded-xl border-2 border-blue-200 native-press hover:bg-blue-100 transition-colors",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:[(0,s.jsx)("div",{className:"p-2.5 bg-blue-600 rounded-xl",children:(0,s.jsx)(A.Z,{size:20,className:"text-white"})}),(0,s.jsx)("span",{className:"text-sm font-semibold text-blue-700",children:"View Orders"})]})]})]})]}),G&&(0,s.jsx)(D.Z,{order:null,onClose:()=>$(!1),onSave:async e=>{let t=await i.XK.createOrder(e);$(!1),ea.push("/orders?highlight=".concat(t))}})]}),(0,s.jsx)(h.Z,{})]})}},79699:function(e,t,a){"use strict";a.d(t,{K:function(){return i}});var s=a(45050),r=a(24086);let i=new class{async getInvestment(){try{let e=(0,s.z)();if(!e)throw Error("Database not initialized");let t=await (0,r.PL)((0,r.hJ)(e,this.collectionName));if(t.empty)return null;let a=t.docs[0];return{id:a.id,...a.data()}}catch(e){throw console.error("Error getting investment:",e),e}}async setInvestment(e,t,a){try{let i=(0,s.z)();if(!i)throw Error("Database not initialized");let l=await this.getInvestment(),n=new Date().toISOString();if(l&&l.id){let s=l.amount,o=l.date,d=l.note||"",c=s!==e||o!==t||d.trim()!==(a||"").trim();if(!c)return console.log("No changes detected for investment update, skipping."),l.id;return await (0,r.r7)((0,r.JU)(i,this.collectionName,l.id),{amount:e,date:t,note:a||"",updatedAt:n}),await this.logActivity({activityType:"updated",amount:e,previousAmount:s,date:t,previousDate:o,note:a,previousNote:d,timestamp:n}),l.id}{let s=await (0,r.ET)((0,r.hJ)(i,this.collectionName),{amount:e,date:t,note:a||"",createdAt:n,updatedAt:n});return await this.logActivity({activityType:"created",amount:e,date:t,note:a,timestamp:n}),s.id}}catch(e){throw console.error("Error setting investment:",e),e}}async getActivityLog(){try{let e=(0,s.z)();if(!e)return[];let t=(0,r.IO)((0,r.hJ)(e,this.activityCollectionName),(0,r.Xo)("timestamp","desc")),a=await (0,r.PL)(t);return a.docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting investment activity log:",e),[]}}async logActivity(e){try{let t=(0,s.z)();if(!t)return;await (0,r.ET)((0,r.hJ)(t,this.activityCollectionName),e)}catch(e){console.error("Error logging investment activity:",e)}}constructor(){this.collectionName="investment",this.activityCollectionName="investmentActivity"}}},71037:function(e,t,a){"use strict";a.d(t,{I:function(){return getAdjustedProfit},w:function(){return hasProfitAdjustments}});let toNumber=e=>{if("number"==typeof e)return e;if("string"==typeof e){let t=Number(e);return isNaN(t)?0:t}return 0},getAdjustedProfit=e=>{let t=toNumber(e.expenseAdjustment),a=toNumber(e.revenueAdjustment),s=toNumber(e.adjustmentAmount),r=e.profit+t+a+s;return Math.round(100*r)/100},hasProfitAdjustments=e=>{let t=getAdjustedProfit(e);return Math.abs(t-e.profit)>.01}}},function(e){e.O(0,[358,118,949,923,295,587,264,940,971,472,744],function(){return e(e.s=64763)}),_N_E=e.O()}]);