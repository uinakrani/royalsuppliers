(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[760],{34562:function(e,t,a){Promise.resolve().then(a.bind(a,43923))},43923:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return InvoicesPage}});var r=a(57437),s=a(2265),i=a(98025),l=a(70349),o=a(60930),n=a(28521);let formatIndianCurrency=e=>{let t=Math.round(e).toString();if(t.length<=3)return t;let a=t.split("").reverse(),r=[];r.push(a.slice(0,3).reverse().join(""));for(let e=3;e<a.length;e+=2){let t=a.slice(e,e+2).reverse().join("");t&&r.push(t)}return r.reverse().join(",")},loadImage=async e=>{try{let t=await fetch("".concat(e,"?t=").concat(Date.now()),{cache:"no-cache"});if(!t.ok)return null;let a=await t.blob(),r=new FileReader,s=await new Promise((e,t)=>{r.onloadend=()=>{"string"==typeof r.result?e(r.result):t(Error("Failed to convert blob to data URL"))},r.onerror=t,r.readAsDataURL(a)}),i=new Image;return await new Promise((e,t)=>{i.onload=()=>{if(0===i.width||0===i.height){t(Error("Invalid image dimensions"));return}e()},i.onerror=t,i.src=s}),{dataUrl:s,img:i}}catch(t){return console.warn("Failed to load image from ".concat(e,":"),t),null}},addLogoToPDF=async(e,t,a)=>{let r=!1;for(let t of["/top-logo.jpg"]){let a=await loadImage(t);if(a){let{dataUrl:s,img:i}=a;console.log("Top logo loaded successfully: ".concat(i.width,"x").concat(i.height," from ").concat(t));let l=i.height/i.width,o=80*l;e.addImage(s,"PNG",20,15,80,o),console.log("Top logo added to PDF"),r=!0;break}}r||console.warn("Top logo (top-logo.jpg) not found.");let s=!1;for(let r of["/logo.png","/logo.jpg","/logo.jpeg"]){let i=await loadImage(r);if(i){let{dataUrl:l,img:o}=i;console.log("Watermark logo loaded successfully: ".concat(o.width,"x").concat(o.height," from ").concat(r));let n=document.createElement("canvas");n.width=o.width,n.height=o.height;let d=n.getContext("2d");if(d){d.drawImage(o,0,0);let r=d.getImageData(0,0,n.width,n.height),i=r.data;for(let e=3;e<i.length;e+=4)i[e]=Math.round(.1*i[e]);d.putImageData(r,0,0);let l=n.toDataURL("image/png"),c=o.height/o.width,m=(t-60)/2,x=(a-60)/2,h=60*c;e.addImage(l,"PNG",m,x,60,h),console.log("Watermark added to PDF"),s=!0;break}}}s||console.warn("Watermark logo (logo.png, logo.jpg, or logo.jpeg) not found.")},generateInvoicePDF=async e=>{let t=new o.ZP,a=t.internal.pageSize.getWidth(),r=t.internal.pageSize.getHeight();t.setFont("helvetica","normal"),t.setProperties({title:"Invoice",subject:"Order Invoice",author:"Royal Suppliers",creator:"Royal Suppliers"}),await addLogoToPDF(t,a,r);let s=a-40,i=45,l=new Date(e.createdAt?e.createdAt:e.date),d=(0,n.ZP)(l,"yyMMddHHmm"),c="ROYAL".concat(d);t.setFontSize(11),t.setFont("helvetica","normal"),t.setTextColor(100,100,100),t.text(c,a-20,i,{align:"right",charSpace:0}),i+=12;let m=20+s/2+20;t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,30,30),t.text("Billed to:",20,i,{charSpace:0}),i+=7,t.setFont("helvetica","normal"),t.setFontSize(12),t.setTextColor(50,50,50),t.text(e.partyName,20,i,{charSpace:0}),i+=6,t.text(e.siteName,20,i,{charSpace:0});let x=i-13;t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor(30,30,30),t.text("From:",m,x,{charSpace:0}),t.setFont("helvetica","normal"),t.setTextColor(50,50,50),t.text("Royal Suppliers",m,x+7,{charSpace:0}),i+=18,t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(100,100,100);let h=20+s,g=h-20,p=.15*g,u=.3*g,y=.18*g,v=.18*g,f=.19*g,b=20+p,j=b+u,w=j+y,N=w+v;t.setDrawColor(0,0,0),t.setLineWidth(.5);let S=i-4;t.line(20,S,20+g,S);let F=i+4;t.line(20,F,20+g,F);let C=(S+F)/2+1.5;t.text("Date",20,C,{charSpace:0}),t.text("Material",b,C,{charSpace:0}),t.text("Weight",j+y,C,{charSpace:0,align:"right"}),t.text("Rate",w+v,C,{charSpace:0,align:"right"}),t.text("Total",N+f,C,{charSpace:0,align:"right"}),i=F+6,t.setFont("helvetica","normal"),t.setFontSize(11),t.setTextColor(50,50,50);let T=Array.isArray(e.material)?e.material:[e.material],P=T.join(", "),I=t.splitTextToSize(P,u-5),D={charSpace:0},A=new Date(e.date),k=(0,n.ZP)(A,"dd MMM yyyy");t.text(k,20,i,D),Array.isArray(I)?I.forEach((e,a)=>{t.text(e,b,i+7*a,D)}):t.text(I,b,i,D),t.text(e.weight.toFixed(2),j+y,i,{charSpace:0,align:"right"}),t.text("Rs.".concat(formatIndianCurrency(e.rate)),w+v,i,{charSpace:0,align:"right"}),t.text("Rs.".concat(formatIndianCurrency(e.total)),N+f,i,{charSpace:0,align:"right"});let z=Math.max(7,7*I.length);i+=z+5;let M=r-50,R=M;t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,30,30),t.text("Subtotal:",h-60,R,{charSpace:0}),t.setFont("helvetica","normal"),t.text("Rs.".concat(formatIndianCurrency(e.total)),h,R,{align:"right",charSpace:0}),R+=8,e.profit<0&&(t.setFont("helvetica","bold"),t.setFontSize(12),t.text("Discount Applied:",h-60,R,{charSpace:0}),t.setFont("helvetica","normal"),t.setTextColor(220,38,38),t.text("- Rs.".concat(formatIndianCurrency(Math.abs(e.profit))),h,R,{align:"right",charSpace:0}),t.setTextColor(50,50,50),R+=8),R+=4,t.setDrawColor(200,200,200),t.line(h-60,R,h,R),R+=8,t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("Total:",h-60,R,{charSpace:0});let Z=e.total+(e.profit<0?e.profit:0);t.text("Rs.".concat(formatIndianCurrency(Z)),h,R,{align:"right",charSpace:0}),t.save("Invoice_".concat(e.partyName,"_").concat((0,n.ZP)(new Date(e.date),"ddMMyyyy"),".pdf"))},generateMultipleInvoicesPDF=async e=>{if(0===e.length)return;let t=new o.ZP,a=t.internal.pageSize.getWidth(),r=t.internal.pageSize.getHeight();t.setFont("helvetica","normal"),t.setProperties({title:"Invoice",subject:"Order Invoice",author:"Royal Suppliers",creator:"Royal Suppliers"}),await addLogoToPDF(t,a,r);let s=a-40,i=45,l=new Date(e[0].createdAt?e[0].createdAt:e[0].date),d=(0,n.ZP)(l,"yyMMddHHmm"),c="ROYAL".concat(d);t.setFontSize(11),t.setFont("helvetica","normal"),t.setTextColor(100,100,100),t.text(c,a-20,i,{align:"right",charSpace:0}),i+=12;let m=20+s/2+20,x=e[0].partyName,h=i;t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,30,30),t.text("Billed to:",20,i,{charSpace:0}),i+=7,t.setFont("helvetica","normal"),t.setFontSize(12),t.setTextColor(50,50,50),t.text(x,20,i,{charSpace:0}),i+=6;let g=Array.from(new Set(e.map(e=>(e.siteName||"").trim()).filter(e=>e&&e.length>0)));0===g.length?e[0].siteName&&(t.text((e[0].siteName||"").trim(),20,i,{charSpace:0}),i+=6):g.forEach(e=>{t.text(e,20,i,{charSpace:0}),i+=6}),t.setFont("helvetica","bold"),t.setFontSize(12),t.setTextColor(30,30,30),t.text("From:",m,h,{charSpace:0}),t.setFont("helvetica","normal"),t.setTextColor(50,50,50),t.text("Royal Suppliers",m,h+7,{charSpace:0}),i=Math.max(i,h+20)+10,t.setFontSize(11),t.setFont("helvetica","bold"),t.setTextColor(100,100,100);let p=20+s,u=p-20,y=.15*u,v=.3*u,f=.18*u,b=.18*u,j=.19*u,w=20+y,N=w+v,S=N+f,F=S+b;t.setDrawColor(0,0,0),t.setLineWidth(.5);let C=i-4;t.line(20,C,20+u,C);let T=i+4;t.line(20,T,20+u,T);let P=(C+T)/2+1.5;t.text("Date",20,P,{charSpace:0}),t.text("Material",w,P,{charSpace:0}),t.text("Weight",N+f,P,{charSpace:0,align:"right"}),t.text("Rate",S+b,P,{charSpace:0,align:"right"}),t.text("Total",F+j,P,{charSpace:0,align:"right"}),i=T+6,t.setFont("helvetica","normal"),t.setFontSize(11),t.setTextColor(50,50,50);let I=0;for(let s of e){i>r-100&&(t.addPage(),await addLogoToPDF(t,a,r),i=45);let e=Array.isArray(s.material)?s.material:[s.material],l=e.join(", "),o=t.splitTextToSize(l,v-5),d={charSpace:0},c=new Date(s.date),m=(0,n.ZP)(c,"dd MMM yyyy");t.text(m,20,i,d),Array.isArray(o)?o.forEach((e,a)=>{t.text(e,w,i+7*a,d)}):t.text(o,w,i,d),t.text(s.weight.toFixed(2),N+f,i,{charSpace:0,align:"right"}),t.text("Rs.".concat(formatIndianCurrency(s.rate)),S+b,i,{charSpace:0,align:"right"}),t.text("Rs.".concat(formatIndianCurrency(s.total)),F+j,i,{charSpace:0,align:"right"});let x=Math.max(7,7*o.length);i+=x+4,I+=s.total}i+=5;let D=r-50,A=D;t.setFontSize(12),t.setFont("helvetica","bold"),t.setTextColor(30,30,30),t.text("Subtotal:",p-60,A,{charSpace:0}),t.setFont("helvetica","normal"),t.text("Rs.".concat(formatIndianCurrency(I)),p,A,{align:"right",charSpace:0}),A+=12,t.setDrawColor(200,200,200),t.line(p-60,A,p,A),A+=8,t.setFontSize(14),t.setFont("helvetica","bold"),t.setTextColor(0,0,0),t.text("Total:",p-60,A,{charSpace:0}),t.text("Rs.".concat(formatIndianCurrency(I)),p,A,{align:"right",charSpace:0});let k="Invoice_".concat(x,"_").concat((0,n.ZP)(new Date,"ddMMyyyy"),".pdf");t.save(k)};var d=a(74931),c=a(61444),m=a(13008),x=a(11981),h=a(9883),g=a(42482),p=a(76637),u=a(35817),y=a(4322),v=a(45367),f=a(86345),b=a(68286),j=a(42316),w=a(41587),N=a(74513),S=a(24033),F=a(30182);function InvoicesPage(){let[e,t]=(0,s.useState)([]),[a,o]=(0,s.useState)([]),[C,T]=(0,s.useState)(!0),[P,I]=(0,s.useState)(!1),[D,A]=(0,s.useState)({}),[k,z]=(0,s.useState)([]),[M,R]=(0,s.useState)(null),[Z,W]=(0,s.useState)({}),[E,H]=(0,s.useState)(!1),O=(0,S.useRouter)(),[L,U]=(0,s.useState)(""),[_,B]=(0,s.useState)(""),[Y,q]=(0,s.useState)(""),[G,K]=(0,s.useState)(""),[X,V]=(0,s.useState)("");(0,s.useEffect)(()=>{loadInvoices(),loadPartyNames()},[]),(0,s.useEffect)(()=>{applyFilters()},[e,D]);let loadInvoices=async()=>{T(!0);try{let e=await i.z.getAllInvoices();t(e);let a={};for(let t of e){let e=[];for(let a of t.orderIds){let t=await l.XK.getOrderById(a);t&&e.push(t)}a[t.id]=e}W(a)}catch(e){console.error("Error loading invoices:",e),(0,f.showToast)("Failed to load invoices","error")}finally{T(!1)}},loadPartyNames=async()=>{try{let e=await i.z.getUniquePartyNames();z(e)}catch(e){console.error("Error loading party names:",e)}},applyFilters=()=>{let t=[...e];D.partyName&&(t=t.filter(e=>e.partyName===D.partyName)),void 0!==D.paid&&(t=t.filter(e=>e.paid===D.paid)),void 0!==D.overdue&&(t=t.filter(e=>e.overdue===D.overdue)),D.startDate&&(t=t.filter(e=>new Date(e.createdAt)>=new Date(D.startDate))),D.endDate&&(t=t.filter(e=>new Date(e.createdAt)<=new Date(D.endDate))),o(t)},applyFilterForm=()=>{let e={};L&&(e.partyName=L),_&&(e.startDate=_),Y&&(e.endDate=Y),"paid"===G&&(e.paid=!0),"unpaid"===G&&(e.paid=!1),"overdue"===X&&(e.overdue=!0),"not-overdue"===X&&(e.overdue=!1),A(e),I(!1)},resetFilters=()=>{U(""),B(""),q(""),K(""),V(""),A({}),I(!1)},handleAddPayment=async t=>{let a=e.find(e=>e.id===t);if(!a)return;let r=a.totalAmount-(a.paidAmount||0);try{let e=await b.h.prompt({title:"Add Payment",message:"Remaining balance: ".concat((0,d.formatIndianCurrency)(r)),inputLabel:"Payment Amount",inputPlaceholder:"Enter amount",inputType:"text",formatCurrencyInr:!0,confirmText:"Add Payment",cancelText:"Cancel"});if(!e)return;let a=parseFloat(e);if(isNaN(a)||a<=0){(0,f.showToast)("Invalid amount","error");return}if(a>r){(0,f.showToast)("Amount cannot exceed remaining balance of ".concat((0,d.formatIndianCurrency)(r)),"error");return}let s=await b.h.prompt({title:"Payment Note (optional)",inputLabel:"Note",inputPlaceholder:"Add a note (optional)",inputType:"text",required:!1,confirmText:"Save",cancelText:"Skip"});await i.z.addPayment(t,a,s||void 0),(0,f.showToast)("Payment added successfully!","success"),await loadInvoices()}catch(e){(null==e?void 0:e.message)&&!e.message.includes("SweetAlert")&&(0,f.showToast)("Failed to add payment: ".concat((null==e?void 0:e.message)||"Unknown error"),"error")}},handleRemovePayment=async(e,t)=>{try{let a=await b.h.confirm({title:"Remove Payment?",message:"Are you sure you want to remove this payment?",icon:"warning",confirmText:"Remove",cancelText:"Cancel"});if(!a)return;await i.z.removePayment(e,t),(0,f.showToast)("Payment removed successfully!","success"),await loadInvoices()}catch(e){(null==e?void 0:e.message)&&!e.message.includes("SweetAlert")&&(0,f.showToast)("Failed to remove payment: ".concat((null==e?void 0:e.message)||"Unknown error"),"error")}},handleDeleteInvoice=async e=>{try{let t=await b.h.confirm({title:"Delete Invoice?",message:"Are you sure you want to delete this invoice? This will unmark the orders as invoiced.",icon:"warning",confirmText:"Delete",cancelText:"Cancel"});if(!t)return;await i.z.deleteInvoice(e),(0,f.showToast)("Invoice deleted successfully!","success"),await loadInvoices()}catch(e){(null==e?void 0:e.message)&&!e.message.includes("SweetAlert")&&(0,f.showToast)("Failed to delete invoice: ".concat((null==e?void 0:e.message)||"Unknown error"),"error")}},handleDownloadInvoice=async e=>{try{let t=Z[e.id]||[];if(0===t.length){(0,f.showToast)("No orders found for this invoice","error");return}1===t.length?await generateInvoicePDF(t[0]):await generateMultipleInvoicesPDF(t),(0,f.showToast)("Invoice PDF downloaded!","success")}catch(e){(0,f.showToast)("Failed to download invoice: ".concat((null==e?void 0:e.message)||"Unknown error"),"error")}},toggleExpand=e=>{R(M===e?null:e)},getStatusBadge=e=>e.paid?(0,r.jsxs)("span",{className:"px-2.5 py-1 text-xs font-bold rounded-full bg-gradient-to-r from-green-500 to-green-600 text-white flex items-center gap-1.5 shadow-sm shadow-green-500/30",children:[(0,r.jsx)(m.Z,{size:12,className:"flex-shrink-0"}),"Paid"]}):e.overdue?(0,r.jsxs)("span",{className:"px-2.5 py-1 text-xs font-bold rounded-full bg-gradient-to-r from-red-500 to-red-600 text-white flex items-center gap-1.5 shadow-sm shadow-red-500/30 animate-pulse",children:[(0,r.jsx)(x.Z,{size:12,className:"flex-shrink-0"}),"Overdue"]}):(0,r.jsx)("span",{className:"px-2.5 py-1 text-xs font-bold rounded-full bg-gradient-to-r from-amber-400 to-amber-500 text-white flex items-center gap-1.5 shadow-sm shadow-amber-500/30",children:"Pending"});return C?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",style:{paddingBottom:"calc(4rem + env(safe-area-inset-bottom, 0))"},children:[(0,r.jsx)("div",{className:"bg-primary-600 text-white p-2.5 sticky top-0 z-40",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("h1",{className:"text-xl font-bold",children:"Invoices"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("button",{onClick:()=>H(!0),className:"p-1.5 bg-primary-500 rounded-lg hover:bg-primary-500/80 transition-colors flex items-center justify-center",children:(0,r.jsx)(h.Z,{size:18})}),(0,r.jsx)("button",{onClick:()=>I(!P),className:"p-1.5 bg-primary-500 rounded-lg hover:bg-primary-500/80 transition-colors flex items-center justify-center",children:(0,r.jsx)(g.Z,{size:18})})]})]})}),(0,r.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-30 bg-gray-50",children:(0,r.jsx)(w.Z,{size:100})}),(0,r.jsx)(c.Z,{})]}):(0,r.jsxs)("div",{className:"bg-gray-50",style:{height:"100dvh",minHeight:"100dvh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,r.jsx)("div",{className:"bg-gradient-to-r from-primary-600 to-primary-700 text-white p-4 pt-safe sticky top-0 z-40 shadow-lg",style:{flexShrink:0},children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-0.5",children:"Invoices"}),(0,r.jsxs)("p",{className:"text-xs text-primary-100 opacity-90",children:[a.length," ",1===a.length?"invoice":"invoices"]})]}),(0,r.jsx)("button",{onClick:()=>I(!P),className:"p-2.5 bg-white/20 backdrop-blur-sm text-white rounded-xl hover:bg-white/30 active:scale-95 transition-all duration-150 flex items-center justify-center shadow-sm",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:(0,r.jsx)(g.Z,{size:20})})]})}),(0,r.jsxs)("div",{style:{flex:1,overflowY:"auto",WebkitOverflowScrolling:"touch",paddingBottom:"4rem"},children:[(0,r.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,r.jsx)(j.Z,{isOpen:P,onClose:()=>I(!1),title:"Filters",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Party Name"}),(0,r.jsxs)("select",{value:L,onChange:e=>U(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg",children:[(0,r.jsx)("option",{value:"",children:"All"}),k.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Start Date"}),(0,r.jsx)("input",{type:"date",value:_,onChange:e=>B(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"End Date"}),(0,r.jsx)("input",{type:"date",value:Y,onChange:e=>q(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Payment Status"}),(0,r.jsxs)("select",{value:G,onChange:e=>K(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg",children:[(0,r.jsx)("option",{value:"",children:"All"}),(0,r.jsx)("option",{value:"paid",children:"Paid"}),(0,r.jsx)("option",{value:"unpaid",children:"Unpaid"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-gray-700 mb-1",children:"Overdue Status"}),(0,r.jsxs)("select",{value:X,onChange:e=>V(e.target.value),className:"w-full px-2 py-1.5 bg-white border border-gray-300 rounded-lg",children:[(0,r.jsx)("option",{value:"",children:"All"}),(0,r.jsx)("option",{value:"overdue",children:"Overdue"}),(0,r.jsx)("option",{value:"not-overdue",children:"Not Overdue"})]})]}),(0,r.jsxs)("div",{className:"flex gap-2 pt-2 border-t border-gray-200 sticky bottom-0 bg-white pb-2",children:[(0,r.jsx)("button",{onClick:()=>{applyFilterForm(),I(!1)},className:"flex-1 bg-primary-600 text-white px-2 py-1 rounded-lg text-xs font-medium hover:bg-primary-700 transition-colors",children:"Apply"}),(0,r.jsx)("button",{onClick:()=>{resetFilters(),I(!1)},className:"flex-1 bg-gray-200 text-gray-700 px-2 py-1 rounded-lg text-xs font-medium hover:bg-gray-300 transition-colors",children:"Reset"})]})]})}),(0,r.jsx)("div",{className:"space-y-3 p-3",children:0===a.length?(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-2xl p-12 text-center border border-gray-200 shadow-sm",style:{animation:"fadeInUp 0.4s ease-out"},children:[(0,r.jsx)("div",{className:"w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,r.jsx)(p.Z,{size:40,className:"text-gray-400"})}),(0,r.jsx)("p",{className:"text-gray-600 font-medium text-base",children:"No invoices found"}),(0,r.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"Try adjusting your filters"})]}):a.map((e,t)=>{var a,s,i;let l=Z[e.id]||[],o=e.totalAmount-(e.paidAmount||0),c=M===e.id,g=e.totalAmount>0?(e.paidAmount||0)/e.totalAmount*100:0;return(0,r.jsxs)("div",{className:"bg-white rounded-2xl border border-gray-200 overflow-hidden shadow-sm hover:shadow-md transition-all duration-300 ease-out",style:{animation:"fadeInUp 0.4s ease-out ".concat(.05*t,"s both"),WebkitTapHighlightColor:"transparent"},children:[(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex items-start justify-between gap-3 mb-3",children:[(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-wrap mb-2",children:[(0,r.jsx)("div",{className:"p-2 bg-gradient-to-br from-primary-500 to-primary-600 rounded-xl shadow-sm",children:(0,r.jsx)(p.Z,{size:18,className:"text-white"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("h3",{className:"text-base font-bold text-gray-900 truncate",children:e.invoiceNumber}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-0.5",children:e.partyName})]})]}),getStatusBadge(e)]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-shrink-0",children:[(0,r.jsx)("button",{onClick:t=>{(0,F.m)(t),handleDownloadInvoice(e)},className:"p-2.5 bg-gradient-to-br from-primary-500 to-primary-600 text-white rounded-xl hover:from-primary-600 hover:to-primary-700 flex items-center justify-center shadow-sm shadow-primary-500/30 active:scale-95 transition-all duration-150",title:"Download Invoice",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:(0,r.jsx)(u.Z,{size:16})}),!e.paid&&(0,r.jsx)("button",{onClick:t=>{(0,F.m)(t),handleAddPayment(e.id)},className:"p-2.5 bg-gradient-to-br from-green-500 to-green-600 text-white rounded-xl hover:from-green-600 hover:to-green-700 flex items-center justify-center shadow-sm shadow-green-500/30 active:scale-95 transition-all duration-150",title:"Add Payment",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:(0,r.jsx)(h.Z,{size:16})})]})]}),!e.paid&&(0,r.jsxs)("div",{className:"mb-3",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1.5",children:[(0,r.jsx)("span",{className:"text-xs font-medium text-gray-600",children:"Payment Progress"}),(0,r.jsxs)("span",{className:"text-xs font-bold text-primary-600",children:[g.toFixed(0),"%"]})]}),(0,r.jsx)("div",{className:"h-2 bg-gray-200 rounded-full overflow-hidden",children:(0,r.jsx)("div",{className:"h-full bg-gradient-to-r from-primary-500 to-primary-600 rounded-full transition-all duration-500 ease-out shadow-sm",style:{width:"".concat(Math.min(100,g),"%")}})})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-3",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-3 border border-gray-200",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Site"}),(0,r.jsx)("p",{className:"text-sm font-semibold text-gray-900 truncate",children:e.siteName})]}),(0,r.jsxs)("div",{className:"bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-3 border border-gray-200",children:[(0,r.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Due Date"}),(0,r.jsx)("p",{className:"text-sm font-semibold ".concat(e.overdue?"text-red-600":"text-gray-900"),children:(0,n.ZP)(new Date(e.dueDate),"dd MMM yyyy")})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,r.jsxs)("div",{className:"bg-gradient-to-br from-primary-50 to-primary-100 rounded-xl p-3 border border-primary-200",children:[(0,r.jsx)("p",{className:"text-xs text-primary-600 font-medium mb-1",children:"Total Amount"}),(0,r.jsx)("p",{className:"text-lg font-bold text-primary-700",children:(0,d.formatIndianCurrency)(e.totalAmount)})]}),(0,r.jsxs)("div",{className:"rounded-xl p-3 border ".concat(e.paid?"bg-gradient-to-br from-green-50 to-green-100 border-green-200":"bg-gradient-to-br from-red-50 to-red-100 border-red-200"),children:[(0,r.jsx)("p",{className:"text-xs font-medium mb-1 ".concat(e.paid?"text-green-600":"text-red-600"),children:e.paid?"Paid":"Remaining"}),(0,r.jsx)("p",{className:"text-lg font-bold ".concat(e.paid?"text-green-700":"text-red-700"),children:(0,d.formatIndianCurrency)(e.paid?e.paidAmount||0:o)})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-between pt-3 border-t border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-600",children:[(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(y.Z,{size:12}),l.length," Order",1!==l.length?"s":""]}),(0,r.jsx)("span",{children:"•"}),(0,r.jsxs)("span",{children:[(null===(a=e.partialPayments)||void 0===a?void 0:a.length)||0," Payment",(null===(s=e.partialPayments)||void 0===s?void 0:s.length)!==1?"s":""]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:t=>{(0,F.m)(t),toggleExpand(e.id)},className:"px-3 py-1.5 bg-gray-100 text-gray-700 rounded-xl text-xs font-semibold hover:bg-gray-200 active:scale-95 transition-all duration-150",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:c?"Hide Details":"View Details"}),(0,r.jsxs)("button",{onClick:t=>{(0,F.m)(t),handleDeleteInvoice(e.id)},className:"px-3 py-1.5 bg-red-100 text-red-700 rounded-xl text-xs font-semibold hover:bg-red-200 active:scale-95 transition-all duration-150 flex items-center gap-1.5",title:"Delete Invoice",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:[(0,r.jsx)(v.Z,{size:12}),"Delete"]})]})]})]}),(0,r.jsx)("div",{className:"overflow-hidden transition-all duration-300 ease-out ".concat(c?"max-h-[2000px] opacity-100":"max-h-0 opacity-0"),children:(0,r.jsx)("div",{className:"p-4 bg-gradient-to-br from-gray-50 to-white border-t border-gray-200",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,r.jsx)("div",{className:"p-1.5 bg-primary-100 rounded-lg",children:(0,r.jsx)(y.Z,{size:14,className:"text-primary-600"})}),(0,r.jsxs)("h4",{className:"text-sm font-bold text-gray-900",children:["Orders (",l.length,")"]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm",children:[(0,r.jsxs)("div",{className:"hidden sm:grid grid-cols-12 gap-1.5 p-1.5 bg-gray-100 border-b border-gray-200 text-xs font-semibold text-gray-700",children:[(0,r.jsx)("div",{className:"col-span-2",children:"Date"}),(0,r.jsx)("div",{className:"col-span-5",children:"Material"}),(0,r.jsx)("div",{className:"col-span-1 text-right",children:"Weight"}),(0,r.jsx)("div",{className:"col-span-2 text-right",children:"Rate"}),(0,r.jsx)("div",{className:"col-span-2 text-right",children:"Total"})]}),(0,r.jsx)("div",{className:"divide-y divide-gray-200",children:l.map(e=>(0,r.jsxs)("div",{className:"p-1.5 hover:bg-gray-50",children:[(0,r.jsxs)("div",{className:"hidden sm:grid grid-cols-12 gap-1.5 text-xs",children:[(0,r.jsx)("div",{className:"col-span-2 text-gray-900",children:(0,n.ZP)(new Date(e.date),"dd MMM yyyy")}),(0,r.jsx)("div",{className:"col-span-5 text-gray-900 truncate",title:Array.isArray(e.material)?e.material.join(", "):e.material,children:Array.isArray(e.material)?e.material.join(", "):e.material}),(0,r.jsx)("div",{className:"col-span-1 text-right text-gray-900",children:e.weight.toFixed(2)}),(0,r.jsx)("div",{className:"col-span-2 text-right text-gray-900",children:(0,d.formatIndianCurrency)(e.rate)}),(0,r.jsx)("div",{className:"col-span-2 text-right font-semibold text-gray-900",children:(0,d.formatIndianCurrency)(e.total)})]}),(0,r.jsxs)("div",{className:"sm:hidden space-y-1 text-xs",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("p",{className:"font-semibold text-gray-900",children:(0,n.ZP)(new Date(e.date),"dd MMM yyyy")}),(0,r.jsx)("p",{className:"text-gray-600 mt-0.5",children:Array.isArray(e.material)?e.material.join(", "):e.material})]}),(0,r.jsx)("p",{className:"font-semibold text-gray-900 ml-2",children:(0,d.formatIndianCurrency)(e.total)})]}),(0,r.jsxs)("div",{className:"flex gap-3 text-gray-600",children:[(0,r.jsxs)("span",{children:["Weight: ",e.weight.toFixed(2)]}),(0,r.jsxs)("span",{children:["Rate: ",(0,d.formatIndianCurrency)(e.rate)]})]})]})]},e.id))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,r.jsx)("div",{className:"p-1.5 bg-green-100 rounded-lg",children:(0,r.jsx)(m.Z,{size:14,className:"text-green-600"})}),(0,r.jsxs)("h4",{className:"text-sm font-bold text-gray-900",children:["Payments (",(null===(i=e.partialPayments)||void 0===i?void 0:i.length)||0,")"]})]}),e.partialPayments&&e.partialPayments.length>0?(0,r.jsx)("div",{className:"space-y-2",children:e.partialPayments.map((t,a)=>(0,r.jsxs)("div",{className:"bg-white p-3 rounded-xl border border-gray-200 flex justify-between items-center shadow-sm hover:shadow-md transition-shadow duration-200",style:{animation:"fadeInUp 0.3s ease-out ".concat(.05*a,"s both")},children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,r.jsx)("p",{className:"font-bold text-gray-900 text-sm",children:(0,d.formatIndianCurrency)(t.amount)}),(0,r.jsx)("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 rounded-full text-xs font-semibold",children:"Paid"})]}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:(0,n.ZP)(new Date(t.date),"dd MMM yyyy • HH:mm")}),t.note&&(0,r.jsx)("p",{className:"text-xs text-gray-600 mt-1.5 bg-gray-50 px-2 py-1 rounded-lg",children:t.note})]}),(0,r.jsxs)("button",{onClick:a=>{(0,F.m)(a),handleRemovePayment(e.id,t.id)},className:"ml-3 px-3 py-2 bg-red-100 text-red-700 rounded-xl text-xs font-semibold hover:bg-red-200 active:scale-95 transition-all duration-150 flex items-center gap-1.5",style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:[(0,r.jsx)(v.Z,{size:12}),"Remove"]})]},t.id))}):(0,r.jsxs)("div",{className:"bg-white p-4 rounded-xl border border-gray-200 text-center",children:[(0,r.jsx)("div",{className:"w-12 h-12 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-2",children:(0,r.jsx)(x.Z,{size:20,className:"text-gray-400"})}),(0,r.jsx)("p",{className:"text-sm text-gray-600 font-medium",children:"No payments recorded"}),(0,r.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Add a payment to track invoice status"})]})]})]})})})]},e.id)})})]}),E&&(0,r.jsx)(N.Z,{order:null,onClose:()=>H(!1),onSave:async e=>{try{let t=await l.XK.createOrder(e);(0,f.showToast)("Order created successfully!","success"),H(!1),O.push("/orders?highlight=".concat(t))}catch(e){throw(0,f.showToast)((null==e?void 0:e.message)||"Failed to create order","error"),e}}})]}),(0,r.jsx)(c.Z,{})]})}}},function(e){e.O(0,[358,505,118,949,932,923,295,587,940,971,472,744],function(){return e(e.s=34562)}),_N_E=e.O()}]);