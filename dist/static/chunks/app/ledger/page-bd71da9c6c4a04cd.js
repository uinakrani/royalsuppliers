(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[537],{90998:function(e,t,a){"use strict";a.d(t,{Z:function(){return n}});var r=a(62898);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let n=(0,r.Z)("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]])},21785:function(e,t,a){Promise.resolve().then(a.bind(a,52020))},52020:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return LedgerPage}});var r=a(57437),n=a(2265),i=a(86725),s=a(28521),o=a(62898);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let l=(0,o.Z)("PlusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);var d=a(94136),c=a(82549),m=a(34822),u=a(28203);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let p=(0,o.Z)("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);var y=a(90998);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let g=(0,o.Z)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]]),x=(0,o.Z)("MinusCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]]);var h=a(9883),f=a(74931),b=a(61444),v=a(41298),w=a(93505),N=a(67972),j=a(76637),S=a(62442),k=a(45367),C=a(81291),D=a(17158),T=a(70349),E=a(56023),P=a(70258),A=a(39414);function BottomSheet(e){let{isOpen:t,onClose:a,onConfirm:i,title:s,message:o,children:l,confirmText:d="Confirm",cancelText:c="Cancel",confirmColor:m="red"}=e,u=(0,n.useRef)(null),p=(0,n.useRef)(null),[y,g]=(0,n.useState)(!1),[x,h]=(0,n.useState)(!1);(0,n.useEffect)(()=>(t?(document.body.style.overflow="hidden",g(!1),requestAnimationFrame(()=>{h(!0)})):(h(!1),document.body.style.overflow=""),()=>{document.body.style.overflow=""}),[t]);let handleClose=()=>{g(!0),h(!1),setTimeout(()=>{a(),g(!1)},350)};return t?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{ref:p,onClick:e=>{e.target===p.current&&handleClose()},className:"fixed inset-0 bg-black z-[99990] ".concat(y?"native-backdrop-exit":x?"native-backdrop-enter":"opacity-0"),style:{WebkitTapHighlightColor:"transparent"}}),(0,r.jsxs)("div",{ref:u,className:"fixed bottom-0 left-0 right-0 bg-white rounded-t-2xl shadow-2xl z-[100000] ".concat(y?"native-bottom-sheet-exit":x?"native-bottom-sheet-enter":"translate-y-full"),style:{WebkitOverflowScrolling:"touch",touchAction:"pan-y",paddingBottom:"env(safe-area-inset-bottom, 0)",backfaceVisibility:"hidden",willChange:"transform"},onClick:e=>e.stopPropagation(),children:[(0,r.jsx)("div",{className:"flex justify-center pt-3 pb-2",children:(0,r.jsx)("div",{className:"w-12 h-1 bg-gray-300 rounded-full"})}),(0,r.jsxs)("div",{className:"px-4 pb-4",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-2",children:s}),o&&(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:o}),l&&(0,r.jsx)("div",{className:"mb-6",children:l}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("button",{onClick:()=>{i(),handleClose()},className:"w-full py-3 ".concat({red:"bg-red-600 active:bg-red-700",blue:"bg-blue-600 active:bg-blue-700",green:"bg-green-600 active:bg-green-700",amber:"bg-amber-600 active:bg-amber-700"}[m]," text-white rounded-lg font-semibold transition-colors touch-manipulation"),style:{WebkitTapHighlightColor:"transparent",fontSize:"16px"},children:d}),(0,r.jsx)("button",{onClick:handleClose,className:"w-full py-3 bg-gray-100 text-gray-700 rounded-lg font-semibold active:bg-gray-200 transition-colors touch-manipulation",style:{WebkitTapHighlightColor:"transparent",fontSize:"16px"},children:c})]})]})]})]}):null}let formatLocalDate=e=>{let t=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(r)},parseToLocalDateString=e=>{if(!e)return formatLocalDate(new Date);if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;try{let t=new Date(e);if(isNaN(t.getTime()))return console.warn("Invalid date string:",e),formatLocalDate(new Date);return formatLocalDate(t)}catch(t){return console.warn("Error parsing date:",e,t),formatLocalDate(new Date)}},getStepOrder=e=>{let t=["amount","date"];return"debit"===e?[...t,"supplier","note"]:[...t,"partyName","note"]};function LedgerEntryWizard(e){let{entry:t,type:a,onClose:i,onSave:o,onDelete:l,onDeleteConfirm:d}=e,m=getStepOrder(a),p=!!(null==t?void 0:t.id),[y,g]=(0,n.useState)(0),[x,h]=(0,n.useState)(!1),[b,I]=(0,n.useState)(!1),[M,z]=(0,n.useState)({amount:(null==t?void 0:t.amount)||0,date:(null==t?void 0:t.date)?parseToLocalDateString(t.date):formatLocalDate(new Date),note:(null==t?void 0:t.note)||"",supplier:(null==t?void 0:t.supplier)||"",partyName:(null==t?void 0:t.partyName)||""});(0,n.useEffect)(()=>{t&&z({amount:t.amount||0,date:t.date?parseToLocalDateString(t.date):formatLocalDate(new Date),note:t.note||"",supplier:t.supplier||"",partyName:t.partyName||""})},[null==t?void 0:t.id,null==t?void 0:t.date,null==t?void 0:t.amount,null==t?void 0:t.note,null==t?void 0:t.supplier,null==t?void 0:t.partyName]);let[Z,O]=(0,n.useState)([]),[L,H]=(0,n.useState)([]),W=(0,n.useRef)(null),loadOptions=async()=>{try{let[e,t]=await Promise.all([T.XK.getUniqueSuppliers(),T.XK.getUniquePartyNames()]);O(e),H(t)}catch(e){console.error("Error loading options:",e)}},F=(0,n.useCallback)(()=>{x||i()},[x,i]);(0,n.useEffect)(()=>{loadOptions()},[]),(0,n.useEffect)(()=>{let handleEscape=e=>{"Escape"!==e.key||x||F()};return window.addEventListener("keydown",handleEscape),()=>{window.removeEventListener("keydown",handleEscape)}},[x,F]);let handlePrevious=()=>{y>0&&g(y-1)},handleAfterEdit=()=>{let e=m[y];"amount"===e&&M.amount>0?setTimeout(()=>{y<m.length-1&&g(y+1)},300):"date"===e&&M.date&&setTimeout(()=>{y<m.length-1&&g(y+1)},300)},canSave=()=>{let e="credit"!==a||!!M.partyName.trim();return M.amount>0&&!!M.date&&e},handleStepClick=e=>{e!==y&&g(e)},getStepIcon=e=>{let t={amount:v.Z,date:u.Z,supplier:w.Z,partyName:N.Z,note:j.Z,review:S.Z};return t[e]},isStepComplete=e=>{switch(e){case"amount":return M.amount>0;case"date":return!!M.date;case"supplier":return"debit"!==a||!!M.supplier.trim();case"partyName":return"credit"!==a||!!M.partyName.trim();case"note":case"review":return!0;default:return!1}},getStepValue=e=>{switch(e){case"amount":return M.amount>0?(0,f.formatIndianCurrency)(M.amount):"Not set";case"date":if(!M.date)return"Not set";try{let e=M.date.includes("T")?M.date:M.date+"T12:00:00",t=new Date(e);if(isNaN(t.getTime()))return"Not set";return(0,s.ZP)(t,"dd MMM yyyy")}catch(e){return console.error("Error formatting date:",e),"Not set"}case"supplier":return M.supplier||"";case"partyName":return M.partyName||"";case"note":return M.note||"";default:return""}},handleSubmit=async()=>{if(M.amount<=0){alert("Please enter a valid amount");return}if("credit"===a&&!M.partyName.trim()){alert("Please select a party name");return}h(!0);try{await o({amount:M.amount,date:M.date,note:(M.note||"").trim()||void 0,supplier:"debit"===a&&(M.supplier||"").trim()||void 0,partyName:"credit"===a&&(M.partyName||"").trim()||void 0}),F()}catch(e){console.error("Error saving entry:",e),alert((null==e?void 0:e.message)||"Error saving entry. Please try again."),h(!1)}},B=Math.max(0,Math.min(y,m.length-1)),R=m[B];R&&getStepIcon(R);let U=m.filter(e=>"review"!==e),K=U.filter(e=>{let t=getStepValue(e);return t&&"Not set"!==t&&"₹0"!==t&&""!==t});return(0,n.useEffect)(()=>{(y<0||y>=m.length)&&g(0)},[y,m.length]),(0,r.jsxs)("div",{className:"bg-gray-50 min-h-screen flex flex-col",style:{paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:[(0,r.jsxs)("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2.5",children:[(0,r.jsx)("button",{onClick:F,className:"p-1.5 active:bg-gray-100 active:scale-95 rounded-lg transition-all duration-150",style:{WebkitTapHighlightColor:"transparent"},children:(0,r.jsx)(c.Z,{size:18,className:"text-gray-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-base font-bold text-gray-900",children:p?"Edit ".concat("credit"===a?"Income":"Expense"):"New ".concat("credit"===a?"Income":"Expense")}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[K.length," / ",U.length," completed"]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[p&&(null==t?void 0:t.id)&&(0,r.jsxs)("button",{onClick:()=>{(null==t?void 0:t.id)&&I(!0)},disabled:x,className:"px-3 py-1.5 bg-red-50 border border-red-200 text-red-600 text-xs font-semibold rounded-lg active:bg-red-100 active:border-red-300 transition-all disabled:opacity-50 flex items-center gap-1.5",style:{WebkitTapHighlightColor:"transparent"},children:[(0,r.jsx)(k.Z,{size:14}),"Delete"]}),canSave()&&"note"===R&&(0,r.jsxs)("button",{onClick:handleSubmit,disabled:x,className:"px-3 py-1.5 bg-green-600 text-white text-xs font-semibold rounded-lg active:bg-green-700 transition-all disabled:opacity-50 flex items-center gap-1.5",style:{WebkitTapHighlightColor:"transparent"},children:[(0,r.jsx)(S.Z,{size:14}),"Save"]})]})]}),K.length>0&&(0,r.jsx)("div",{className:"px-3 pb-2 border-b border-gray-100 bg-gradient-to-br from-gray-50 to-gray-100/50",children:(0,r.jsx)("div",{className:"flex flex-wrap gap-1",children:U.map((e,t)=>{let a=getStepValue(e);if("Not set"===a||"₹0"===a||""===a)return null;let n=t===B,i=getStepIcon(e);return i?(0,r.jsxs)("button",{onClick:()=>handleStepClick(t),className:"px-1.5 py-0.5 bg-white border rounded text-xs text-left active:bg-gray-50 active:scale-95 transition-all duration-150 flex items-center gap-1 ".concat(n?"border-primary-400 bg-primary-50":"border-gray-200"),style:{WebkitTapHighlightColor:"transparent"},children:[(0,r.jsx)(i,{size:9,className:"flex-shrink-0 ".concat(n?"text-primary-600":"text-gray-400")}),(0,r.jsx)("span",{className:"truncate max-w-[60px] ".concat(n?"text-primary-700":"text-gray-600"),children:a})]},e):null})})}),(0,r.jsx)("div",{className:"px-3 py-1.5 bg-gray-50 border-b border-gray-100",children:(0,r.jsx)("div",{className:"flex gap-0.5",children:m.map((e,t)=>{let a=isStepComplete(e);return(0,r.jsx)("div",{className:"flex-1 h-0.5 rounded-full transition-all duration-200 ".concat(a?"bg-green-500":t===B?"bg-primary-600":"bg-gray-300")},e)})})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",style:{WebkitOverflowScrolling:"touch",paddingBottom:"5rem"},children:(0,r.jsx)("div",{className:"max-w-2xl mx-auto w-full px-3 py-3"})}),(0,r.jsx)("div",{className:"sticky bottom-0 bg-white border-t border-gray-200 shadow-lg z-20",children:(0,r.jsxs)("div",{className:"max-w-2xl mx-auto w-full px-3 py-3",children:[(0,r.jsx)("div",{className:"mb-3",children:(()=>{let e=Math.max(0,Math.min(y,m.length-1)),t=m[e];if(!t)return null;switch(t){case"amount":return(0,r.jsx)(E.Z,{value:M.amount,onChange:e=>{W.current=e,z({...M,amount:e})},onClose:()=>{W.current=null},label:"Enter ".concat("credit"===a?"Income":"Expense"," Amount"),inline:!0,hideDoneButton:!0,showCurrency:!0});case"date":return(0,r.jsx)("div",{className:"w-full",children:p?(0,r.jsxs)("div",{className:"p-4 bg-gray-50 border border-gray-200 rounded-lg text-center",children:[(0,r.jsx)("p",{className:"text-sm text-gray-500 mb-1",children:"Date cannot be changed for existing entries"}),(0,r.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:(0,s.ZP)(new Date(M.date),"dd MMM yyyy")})]}):(0,r.jsx)(A.Z,{value:M.date,onChange:e=>{z({...M,date:e}),setTimeout(()=>handleAfterEdit(),100)},onClose:()=>{},label:"Select Date",inline:!0})});case"supplier":return(0,r.jsx)(P.Z,{options:Z,value:M.supplier,onChange:e=>{z({...M,supplier:e}),setTimeout(()=>handleAfterEdit(),100)},onClose:()=>{},label:"Select Supplier",allowCustom:!0,onCustomAdd:e=>{O([...Z,e])},inline:!0,autoFocusSearch:!1});case"partyName":return(0,r.jsx)(P.Z,{options:L,value:M.partyName,onChange:e=>{z({...M,partyName:e}),setTimeout(()=>handleAfterEdit(),100)},onClose:()=>{},label:"Select Party Name",allowCustom:!0,onCustomAdd:e=>{H([...L,e])},inline:!0,autoFocusSearch:!1});case"note":return(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Note (Optional)"}),(0,r.jsx)("textarea",{value:M.note,onChange:e=>{z({...M,note:e.target.value})},placeholder:"Add a note (optional)",className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm text-gray-900 bg-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none",rows:4,style:{WebkitTapHighlightColor:"transparent",fontFamily:"inherit"}})]});default:return null}})()}),"note"===R?(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("button",{onClick:handleSubmit,disabled:x||!canSave(),className:"w-full h-11 bg-green-600 text-white rounded-lg font-semibold active:bg-green-700 transition-all duration-100 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 active:scale-[0.98] shadow-md text-sm",style:{WebkitTapHighlightColor:"transparent"},children:[x?"Saving...":p?"Save Changes":"Save Entry",!x&&(0,r.jsx)(S.Z,{size:16})]}),(0,r.jsx)("div",{className:"flex gap-2",children:y>0&&(0,r.jsxs)("button",{onClick:handlePrevious,className:"flex-1 h-10 bg-gray-100 text-gray-700 rounded-lg font-medium active:bg-gray-200 transition-all duration-100 flex items-center justify-center gap-1.5 active:scale-[0.98] text-sm",style:{WebkitTapHighlightColor:"transparent"},children:[(0,r.jsx)(C.Z,{size:14}),"Back"]})})]}):(0,r.jsxs)("div",{className:"flex gap-2",children:[y>0&&(0,r.jsxs)("button",{onClick:handlePrevious,className:"flex-1 h-10 bg-gray-100 text-gray-700 rounded-lg font-medium active:bg-gray-200 transition-all duration-100 flex items-center justify-center gap-1.5 active:scale-[0.98] text-sm",style:{WebkitTapHighlightColor:"transparent"},children:[(0,r.jsx)(C.Z,{size:16}),"Back"]}),(0,r.jsxs)("button",{onClick:()=>{y<m.length-1&&g(y+1)},disabled:!(()=>{let e=Math.max(0,Math.min(y,m.length-1)),t=m[e];return!!t&&isStepComplete(t)})(),className:"flex-1 h-10 bg-primary-600 text-white rounded-lg font-medium active:bg-primary-700 transition-all duration-100 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1.5 active:scale-[0.98] text-sm shadow-md",style:{WebkitTapHighlightColor:"transparent"},children:["Continue",(0,r.jsx)(D.Z,{size:16})]})]})]})}),p&&(null==t?void 0:t.id)&&(0,r.jsx)(BottomSheet,{isOpen:b,onClose:()=>I(!1),onConfirm:async()=>{(null==t?void 0:t.id)&&(d?await d(t.id):l&&l(t.id),I(!1))},title:"Delete Entry?",message:"This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",confirmColor:"red"})]})}var I=a(30182),M=a(41587),z=a(45050),Z=a(24086),O=a(88923),L=a(86345),H=a(8005),W=a(79699);/**
 * @license lucide-react v0.303.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let F=(0,o.Z)("ArrowDownRight",[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]]),B=(0,o.Z)("ArrowUpRight",[["path",{d:"M7 7h10v10",key:"1tivn9"}],["path",{d:"M7 17 17 7",key:"1vkiza"}]]),ensureDate=e=>{if(!e||"string"!=typeof e)return null;let t=e.includes("T")?e:"".concat(e,"T00:00:00.000Z"),a=new Date(t);return isNaN(a.getTime())?null:a},getTimelineTime=e=>{let t=ensureDate(e.createdAt||e.date);return t?t.getTime():0},getTimelineDateKey=e=>{let t=ensureDate(e.createdAt||e.date)||new Date;return(0,s.ZP)(t,"yyyy-MM-dd")};function LedgerTimelineView(e){let{entries:t,investment:a,investmentHistory:i=[],invoices:o=[],orders:l=[]}=e,d=(0,n.useMemo)(()=>{let e=[...t];if(i&&i.length>0){let t=[...i].sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime());t.forEach(t=>{let a=0,r=t.note||"";if("created"===t.activityType)a=t.amount,r=r||"Initial Capital Investment";else{if("updated"!==t.activityType)return;let e=t.previousAmount||0;if((a=t.amount-e)>0)r=r||"Capital Added";else{if(!(a<0))return;r=r||"Capital Reduced"}}if(0===a)return;let n=t.date;n.includes("T")||(n+="T00:00:00.000Z"),e.push({id:"inv-act-".concat(t.id||Math.random()),type:a>=0?"credit":"debit",amount:Math.abs(a),date:n,createdAt:t.timestamp||n,note:r,source:"manual",partyName:"Investment Capital"})})}else if(a){let t=a.date;t.includes("T")||(t+="T00:00:00.000Z"),e.push({id:"investment-capital",type:"credit",amount:a.amount,date:t,createdAt:a.updatedAt||t,note:a.note||"Initial Capital Investment",source:"manual",partyName:"Investment Capital"})}o.forEach(t=>{t.partialPayments&&t.partialPayments.forEach(a=>{let r=a.createdAt||a.date;e.push({id:"inv-pay-".concat(a.id),type:"credit",amount:a.amount,date:a.date,createdAt:r,note:"Invoice: ".concat(t.invoiceNumber).concat(a.note?" - ".concat(a.note):""),source:"manual",partyName:t.partyName||"Unknown Party"})})}),l.forEach(t=>{t.customerPayments&&t.customerPayments.forEach(a=>{if(!a.ledgerEntryId){let r=a.createdAt||a.date;e.push({id:"ord-cust-pay-".concat(a.id),type:"credit",amount:a.amount,date:a.date,createdAt:r,note:"Order Payment".concat(a.note?" - ".concat(a.note):""),source:"manual",partyName:t.partyName||"Unknown Party"})}}),t.partialPayments&&t.partialPayments.forEach(a=>{if(!a.ledgerEntryId){let r=a.createdAt||a.date;e.push({id:"ord-part-pay-".concat(a.id),type:"debit",amount:a.amount,date:a.date,createdAt:r,note:"Order Expense".concat(a.note?" - ".concat(a.note):""),source:"manual",supplier:t.supplier||"Unknown Supplier"})}})}),e.sort((e,t)=>{let a=getTimelineTime(e),r=getTimelineTime(t);return a-r});let r={},n=0;e.map(e=>{let t="credit"===e.type?e.amount:-e.amount;n+=t;let a=getTimelineDateKey(e);return r[a]||(r[a]=[]),r[a].push(e),{...e,balanceAfter:n}});let s=Object.keys(r).sort().reverse(),d=n;return s.map(e=>{let t=r[e];t.sort((e,t)=>{if("Investment Capital"===e.partyName)return 1;if("Investment Capital"===t.partyName)return -1;let a=getTimelineTime(e),r=getTimelineTime(t);return r-a});let a=t.filter(e=>"credit"===e.type).reduce((e,t)=>e+t.amount,0),n=t.filter(e=>"debit"===e.type).reduce((e,t)=>e+t.amount,0),i=d,s=d-(a-n);return d=s,{date:e,entries:t,openingBalance:s,closingBalance:i,totalIncome:a,totalExpense:n}})},[t,a,i,o,l]),renderTransactionRow=e=>{let t="credit"===e.type,a=(0,f.formatIndianCurrency)(e.amount),i=t?e.partyName:e.supplier,s=e.note,o="Investment Capital"===e.partyName,l="",d=s||"",c="",u="",p=null;return o?(l="Investment Capital",d=s||(t?"Capital Added":"Capital Reduced"),c="bg-amber-100 text-amber-600",u=t?"text-green-700":"text-red-700",p=(0,r.jsx)(m.Z,{size:18})):t?(l=i||"Income",c="bg-green-100 text-green-600",u="text-green-700",p=(0,r.jsx)(F,{size:18})):(l=i||"Expense",c="bg-red-100 text-red-600",u="text-red-700",p=(0,r.jsx)(B,{size:18})),(0,r.jsxs)("div",{className:"px-3 py-2 flex items-center gap-2 border-b border-gray-50 last:border-0 active:bg-gray-50 transition-colors",children:[(0,r.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 ".concat(c," bg-opacity-20"),children:n.cloneElement(p,{size:14})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsxs)("div",{className:"flex justify-between items-baseline",children:[(0,r.jsx)("div",{className:"text-xs font-bold text-gray-900 truncate",children:l}),(0,r.jsxs)("div",{className:"text-xs font-bold whitespace-nowrap ".concat(u),children:[t?"+":"-",a]})]}),d&&(0,r.jsx)("div",{className:"text-[10px] text-gray-500 truncate leading-tight",children:d})]})]},e.id)};return 0===d.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center py-12 text-gray-400",children:[(0,r.jsx)(m.Z,{size:48,className:"mb-3 opacity-20"}),(0,r.jsx)("p",{children:"No transactions found"})]}):(0,r.jsx)("div",{className:"pb-24 bg-gray-50 min-h-full",children:d.map(e=>(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"sticky top-0 z-10 bg-gray-50/95 backdrop-blur px-4 py-1.5 flex justify-between items-baseline border-b border-gray-100/50 shadow-sm",children:[(0,r.jsx)("h3",{className:"text-xs font-bold text-gray-600 uppercase tracking-wider",children:(0,s.ZP)(new Date(e.date),"EEE, dd MMM")}),(0,r.jsx)("span",{className:"text-xs font-bold ".concat(e.closingBalance>=0?"text-gray-900":"text-red-600"),children:(0,f.formatIndianCurrency)(e.closingBalance)})]}),(0,r.jsxs)("div",{className:"mx-3 mt-2 bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:[(0,r.jsxs)("div",{className:"px-3 py-1.5 bg-gray-50/50 border-b border-gray-100 flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-[10px] text-gray-400 uppercase tracking-wider font-medium",children:"Closing"}),(0,r.jsx)("span",{className:"text-xs font-bold font-mono ".concat(e.closingBalance>=0?"text-gray-900":"text-red-600"),children:(0,f.formatIndianCurrency)(e.closingBalance)})]}),(0,r.jsx)("div",{className:"divide-y divide-gray-50",children:e.entries.map(renderTransactionRow)}),(0,r.jsxs)("div",{className:"px-3 py-1.5 bg-gray-50/50 border-t border-gray-100 flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-[10px] text-gray-400 uppercase tracking-wider font-medium",children:"Opening"}),(0,r.jsx)("span",{className:"text-xs text-gray-600 font-semibold font-mono",children:(0,f.formatIndianCurrency)(e.openingBalance)})]})]})]},e.date))})}var R=a(98025);function LedgerPage(){let[e,t]=(0,n.useState)([]),[a,o]=(0,n.useState)([]),[v,w]=(0,n.useState)([]),[N,j]=(0,n.useState)(!0),[S,k]=(0,n.useState)("entries"),[C,D]=(0,n.useState)([]),[E,P]=(0,n.useState)(!0),[A,F]=(0,n.useState)(!1),[B,U]=(0,n.useState)(""),[K,J]=(0,n.useState)(""),[X,V]=(0,n.useState)(!1),[_,q]=(0,n.useState)("credit"),[G,Y]=(0,n.useState)("add"),[$,Q]=(0,n.useState)(null),[ee,et]=(0,n.useState)(!1),[ea,er]=(0,n.useState)(null),[en,ei]=(0,n.useState)(null),[es,eo]=(0,n.useState)([]),[el,ed]=(0,n.useState)(!1),[ec,em]=(0,n.useState)(""),[eu,ep]=(0,n.useState)(""),[ey,eg]=(0,n.useState)(""),[ex,eh]=(0,n.useState)("add"),ef=(0,n.useMemo)(()=>{let t=e.reduce((e,t)=>e+("credit"===t.type?t.amount:-t.amount),0);return((null==en?void 0:en.amount)||0)+t},[e,en]),eb=(0,n.useMemo)(()=>e.filter(e=>"credit"===e.type).sort((e,t)=>{let a=e.createdAt?new Date(e.createdAt).getTime():e.date?new Date(e.date).getTime():0,r=t.createdAt?new Date(t.createdAt).getTime():t.date?new Date(t.date).getTime():0;return r-a}),[e]),ev=(0,n.useMemo)(()=>e.filter(e=>"debit"===e.type).sort((e,t)=>{let a=e.createdAt?new Date(e.createdAt).getTime():e.date?new Date(e.date).getTime():0,r=t.createdAt?new Date(t.createdAt).getTime():t.date?new Date(t.date).getTime():0;return r-a}),[e]),ew=(0,n.useMemo)(()=>eb.reduce((e,t)=>e+t.amount,0),[eb]),eN=(0,n.useMemo)(()=>ev.reduce((e,t)=>e+t.amount,0),[ev]),load=async()=>{j(!0);try{let[e,a,r]=await Promise.all([i.ledgerService.list(),R.z.getAllInvoices(),T.XK.getAllOrders()]);t(e),o(a),w(r)}catch(e){console.error("Failed to load ledger data:",e),t([])}finally{j(!1)}},loadInvestment=async()=>{try{let e=await W.K.getInvestment();ei(e);let t=await W.K.getActivityLog();eo(t)}catch(e){console.error("Error loading investment:",e)}},openInvestmentDrawer=()=>{eh("add"),em(""),ep(new Date().toISOString().split("T")[0]),eg(""),ed(!0)},handleModeChange=e=>{eh(e),"set"===e&&en?em(en.amount.toString()):em("")};(0,n.useEffect)(()=>{load(),loadInvestment();let e=i.ledgerService.subscribe(e=>{t(e)});return()=>e()},[]),(0,n.useEffect)(()=>{if("activity"===S){P(!0);let loadActivities=async()=>{try{let e=await H.u.getActivities(B||void 0,K||void 0);D(e)}catch(e){console.error("Failed to load activities:",e),D([])}finally{P(!1)}};loadActivities();let e=H.u.subscribe(e=>{D(e),P(!1)},B||void 0,K||void 0);return()=>e()}},[S,B,K]);let handleSaveInvestment=async()=>{let e=new Date().toISOString().split("T")[0];if(!ec){(0,L.showToast)("Please fill in amount","error");return}try{let t=parseFloat(ec),a=(null==en?void 0:en.amount)||0,r="add"===ex?a+t:"reduce"===ex?Math.max(0,a-t):t;await W.K.setInvestment(r,e,ey),(0,L.showToast)("Investment updated successfully","success"),ed(!1),loadInvestment()}catch(e){console.error("Error saving investment:",e),(0,L.showToast)("Failed to save investment","error")}},handleEntryClick=e=>{handleEditEntry(e)},handleAddEntry=e=>{q(e),Y("add"),Q(null),V(!0)},handleEditEntry=e=>{Q(e),q(e.type),Y("edit"),V(!0)},handleSaveEntry=async e=>{if("edit"===G&&(null==$?void 0:$.id)){var t,a;let r=$.partyName,n=$.supplier,s=(null===(t=e.partyName)||void 0===t?void 0:t.trim())||void 0,o=(null===(a=e.supplier)||void 0===a?void 0:a.trim())||void 0;if(await i.ledgerService.update($.id,{amount:e.amount,date:e.date,note:e.note,supplier:o,partyName:s}),"credit"===$.type){if(r&&!s)await revertIncomeDistribution($.id,r),await deleteLinkedPartyPayment($.id);else if(r&&s&&r!==s)await revertIncomeDistribution($.id,r),await distributeIncomeToOrders($.id,e.amount,s,e.date),await updateLinkedPartyPaymentPartyName($.id,s),await updateLinkedPartyPayment($.id,e.amount,e.date,e.note);else if(!r&&s)await distributeIncomeToOrders($.id,e.amount,s,e.date),await createPartyPaymentFromIncome($.id,s,e.amount,e.date,e.note);else if(r&&s&&r===s){let t=$.amount,a=$.date;(t!==e.amount||a!==e.date)&&(await revertIncomeDistribution($.id,r),await distributeIncomeToOrders($.id,e.amount,s,e.date),await updateLinkedPartyPayment($.id,e.amount,e.date,e.note))}}if("debit"===$.type){if(n&&!o)await revertExpenseDistribution($.id,n);else if(n&&o&&n!==o)await revertExpenseDistribution($.id,n),await distributeExpenseToOrders($.id,e.amount,o,e.date);else if(!n&&o)await distributeExpenseToOrders($.id,e.amount,o,e.date);else if(n&&o&&n===o){let t=$.amount,a=$.date;(t!==e.amount||a!==e.date)&&(await revertExpenseDistribution($.id,n),await distributeExpenseToOrders($.id,e.amount,o,e.date))}}}else{let t=await i.ledgerService.addEntry(_,e.amount,e.note,"manual",e.date,e.supplier,e.partyName);"debit"===_&&e.supplier&&e.supplier.trim()&&await distributeExpenseToOrders(t,e.amount,e.supplier.trim(),e.date),"credit"===_&&e.partyName&&e.partyName.trim()&&(await distributeIncomeToOrders(t,e.amount,e.partyName.trim(),e.date),await createPartyPaymentFromIncome(t,e.partyName.trim(),e.amount,e.date,e.note))}},distributeExpenseToOrders=async(e,t,a,r)=>{try{console.log("\uD83D\uDD04 Distributing expense ".concat(t," for supplier ").concat(a," (ledger entry ").concat(e,")"));let n=await T.XK.getAllOrders({supplier:a});if(0===n.length){console.warn("No orders found for supplier ".concat(a));return}console.log("\uD83D\uDCE6 Found ".concat(n.length," orders for supplier ").concat(a));let i=n.map(t=>{let a=t.partialPayments||[],r=a.filter(t=>t.ledgerEntryId!==e),n=r.reduce((e,t)=>e+Number(t.amount||0),0),i=Number(t.originalTotal||0),s=Math.max(0,i-n),o={...t,partialPayments:r},l=(0,T.sA)(o),d=i-n,c=i-250;return console.log("  Order ".concat(t.id," (").concat(t.siteName||"N/A","): originalTotal=").concat(i,", totalPaid=").concat(n,", remaining=").concat(s,", difference=").concat(d,", isPaid=").concat(l,", tolerance=").concat(c," (paid if >= ").concat(c,")")),{order:t,remaining:s,currentPayments:a,tempOrder:o,isPaid:l,difference:d,totalPaid:n,originalTotal:i}}).filter(e=>{let{remaining:t,isPaid:a,order:r,totalPaid:n,originalTotal:i}=e,s=t>0&&!a;return s?console.log("  ✅ Including order ".concat(r.id," (").concat(r.siteName||"N/A","): remaining=").concat(t,", originalTotal=").concat(i,", totalPaid=").concat(n)):t<=0?console.log("  ⏭️  Skipping order ".concat(r.id," (").concat(r.siteName||"N/A","): remaining=").concat(t," <= 0 (originalTotal=").concat(i,", totalPaid=").concat(n,")")):a&&console.log("  ⏭️  Skipping order ".concat(r.id," (").concat(r.siteName||"N/A","): marked as PAID (remaining=").concat(t,", originalTotal=").concat(i,", totalPaid=").concat(n,", difference=").concat(i-n,")")),s}).sort((e,t)=>{let a=new Date(e.order.date).getTime(),r=new Date(t.order.date).getTime();if(a!==r)return a-r;let n=safeGetTime(e.order.createdAt||e.order.updatedAt||e.order.date),i=safeGetTime(t.order.createdAt||t.order.updatedAt||t.order.date);return n-i});if(console.log("✅ Found ".concat(i.length," orders with outstanding payments")),0===i.length){console.warn("No orders with outstanding payments for supplier ".concat(a)),O.nativePopup.warning("No Unpaid Orders",'No unpaid orders found for supplier "'.concat(a,'". All orders are already paid or have no outstanding amount.'));return}let s=i.reduce((e,t)=>{let{remaining:a}=t;return e+a},0);console.log("\uD83D\uDCB0 Total outstanding across ".concat(i.length," unpaid orders: ").concat(s)),t>s&&console.warn("⚠️ Expense amount (".concat(t,") exceeds total outstanding (").concat(s,")"));let o=t,l=[];for(let{order:t,remaining:a,currentPayments:n}of i){if(o<=0)break;if(!t.id){console.warn("  ⚠️ Order missing ID, skipping");continue}let i=Math.min(o,a),s=r;s&&!s.includes("T")&&(s=new Date(s+"T00:00:00").toISOString());let d={id:Date.now().toString()+Math.random().toString(36).substr(2,9),amount:i,date:s,note:"From ledger entry",ledgerEntryId:e},c=n.filter(t=>t.ledgerEntryId!==e),m=[...c,d];l.push({orderId:t.id,payment:m}),o-=i,console.log("  ✓ Adding payment of ".concat(i," to order ").concat(t.id," (order remaining: ").concat(a-i,", expense remaining: ").concat(o,")"))}for(let{orderId:e,payment:t}of(console.log("\uD83D\uDCCA Distribution summary: ".concat(l.length," orders will be updated, ").concat(o," remaining undistributed")),l))await T.XK.updateOrder(e,{partialPayments:t}),console.log("  ✅ Updated order ".concat(e," with new payment distribution"));o>0?(console.warn("⚠️ Could not fully distribute expense of ".concat(t,". Remaining undistributed: ").concat(o)),O.nativePopup.warning("Partial Distribution","₹".concat(t.toLocaleString("en-IN"),' was entered for supplier "').concat(a,'", but only ₹').concat((t-o).toLocaleString("en-IN")," could be distributed to unpaid orders. ₹").concat(o.toLocaleString("en-IN")," remains undistributed because all orders are already paid or there aren't enough unpaid orders."))):console.log("✅ Successfully distributed expense ".concat(t," across orders"))}catch(e){console.error("❌ Error distributing expense to orders:",e)}},distributeIncomeToOrders=async(e,t,a,r)=>{try{console.log("\uD83D\uDD04 Distributing income ".concat(t," for party ").concat(a," (ledger entry ").concat(e,")"));let n=await T.XK.getAllOrders({partyName:a});if(0===n.length){console.warn("No orders found for party ".concat(a));return}console.log("\uD83D\uDCE6 Found ".concat(n.length," orders for party ").concat(a));let i=n.map(t=>{let a=t.customerPayments||[],r=a.filter(t=>t.ledgerEntryId!==e),n=r.reduce((e,t)=>e+Number(t.amount||0),0),i=Number(t.total||0),s=Math.max(0,i-n),o={...t,customerPayments:r},l=(0,T.jX)(o),d=i-n,c=i-250;return console.log("  Order ".concat(t.id," (").concat(t.siteName||"N/A","): sellingTotal=").concat(i,", totalPaid=").concat(n,", remaining=").concat(s,", difference=").concat(d,", isPaid=").concat(l,", tolerance=").concat(c," (paid if >= ").concat(c,")")),{order:t,remaining:s,currentPayments:a,tempOrder:o,isPaid:l,difference:d,totalPaid:n,sellingTotal:i}}).filter(e=>{let{remaining:t,isPaid:a,order:r,totalPaid:n,sellingTotal:i}=e,s=t>0&&!a;return s?console.log("  ✅ Including order ".concat(r.id," (").concat(r.siteName||"N/A","): remaining=").concat(t,", sellingTotal=").concat(i,", totalPaid=").concat(n)):t<=0?console.log("  ⏭️  Skipping order ".concat(r.id," (").concat(r.siteName||"N/A","): remaining=").concat(t," <= 0 (sellingTotal=").concat(i,", totalPaid=").concat(n,")")):a&&console.log("  ⏭️  Skipping order ".concat(r.id," (").concat(r.siteName||"N/A","): marked as PAID (remaining=").concat(t,", sellingTotal=").concat(i,", totalPaid=").concat(n,", difference=").concat(i-n,")")),s}).sort((e,t)=>{let a=new Date(e.order.date).getTime(),r=new Date(t.order.date).getTime();if(a!==r)return a-r;let n=safeGetTime(e.order.createdAt||e.order.updatedAt||e.order.date),i=safeGetTime(t.order.createdAt||t.order.updatedAt||t.order.date);return n-i});if(console.log("✅ Found ".concat(i.length," orders with outstanding customer payments")),0===i.length){console.warn("No orders with outstanding customer payments for party ".concat(a)),O.nativePopup.warning("No Unpaid Orders",'No unpaid orders found for party "'.concat(a,'". All orders are already paid or have no outstanding amount.'));return}let s=i.reduce((e,t)=>{let{remaining:a}=t;return e+a},0);console.log("\uD83D\uDCB0 Total outstanding across ".concat(i.length," unpaid orders: ").concat(s)),t>s&&console.warn("⚠️ Income amount (".concat(t,") exceeds total outstanding (").concat(s,")"));let o=t,l=[];for(let{order:t,remaining:a,currentPayments:n}of i){if(o<=0)break;if(!t.id){console.warn("  ⚠️ Order missing ID, skipping");continue}let i=Math.min(o,a),s=r;s&&!s.includes("T")&&(s=new Date(s+"T00:00:00").toISOString());let d={id:Date.now().toString()+Math.random().toString(36).substr(2,9),amount:i,date:s,note:"From ledger entry",ledgerEntryId:e},c=n.filter(t=>t.ledgerEntryId!==e),m=[...c,d];l.push({orderId:t.id,payment:m}),o-=i,console.log("  ✓ Adding customer payment of ".concat(i," to order ").concat(t.id," (order remaining: ").concat(a-i,", income remaining: ").concat(o,")"))}for(let{orderId:e,payment:t}of(console.log("\uD83D\uDCCA Distribution summary: ".concat(l.length," orders will be updated, ").concat(o," remaining undistributed")),l))await T.XK.updateOrder(e,{customerPayments:t}),console.log("  ✅ Updated order ".concat(e," with new customer payment distribution"));o>0?(console.warn("⚠️ Could not fully distribute income of ".concat(t,". Remaining undistributed: ").concat(o)),O.nativePopup.warning("Partial Distribution","₹".concat(t.toLocaleString("en-IN"),' was entered for party "').concat(a,'", but only ₹').concat((t-o).toLocaleString("en-IN")," could be distributed to unpaid orders. ₹").concat(o.toLocaleString("en-IN")," remains undistributed because all orders are already paid or there aren't enough unpaid orders."))):console.log("✅ Successfully distributed income ".concat(t," across orders"))}catch(e){console.error("❌ Error distributing income to orders:",e)}},safeGetTime=e=>{if(!e)return 0;let t=new Date(e);return isNaN(t.getTime())?0:t.getTime()},createPartyPaymentFromIncome=async(e,t,a,r,n)=>{try{let i=(0,z.z)();if(!i)throw Error("Firebase is not configured.");let s=r;s&&!s.includes("T")&&(s=new Date(s+"T00:00:00").toISOString());let o=new Date().toISOString(),l={partyName:t,amount:a,date:s,ledgerEntryId:e,createdAt:o,updatedAt:o};n&&n.trim()&&(l.note=n.trim()),await (0,Z.ET)((0,Z.hJ)(i,"partyPayments"),l),console.log("✅ Party payment created for ".concat(t,": ").concat(a," (linked to ledger entry ").concat(e,")"))}catch(e){console.error("Error creating party payment from income entry:",e)}},updateLinkedPartyPayment=async(e,t,a,r)=>{try{let n=(0,z.z)();if(!n)throw Error("Firebase is not configured.");let i=(0,Z.IO)((0,Z.hJ)(n,"partyPayments"),(0,Z.ar)("ledgerEntryId","==",e)),s=await (0,Z.PL)(i);if(s.empty){console.warn("No party payment found linked to ledger entry ".concat(e));return}let o=a;o&&!o.includes("T")&&(o=new Date(o+"T00:00:00").toISOString());let l=s.docs.map(async e=>{let a={amount:t,date:o,updatedAt:new Date().toISOString()};void 0!==r&&(r&&r.trim()?a.note=r.trim():a.note=null),await (0,Z.r7)((0,Z.JU)(n,"partyPayments",e.id),a)});await Promise.all(l),console.log("✅ Updated party payment linked to ledger entry ".concat(e))}catch(e){console.error("Error updating linked party payment:",e)}},handleDeleteConfirm=async()=>{if(ea)try{let t=e.find(e=>e.id===ea);t&&("credit"===t.type&&t.partyName&&await deleteLinkedPartyPayment(ea),"debit"===t.type&&t.supplier&&await revertExpenseDistribution(ea,t.supplier)),await i.ledgerService.remove(ea),et(!1),er(null)}catch(e){console.error("Failed to delete entry:",e),et(!1),er(null)}},deleteLinkedPartyPayment=async e=>{try{let t=(0,z.z)();if(!t)throw Error("Firebase is not configured.");let a=(0,Z.IO)((0,Z.hJ)(t,"partyPayments"),(0,Z.ar)("ledgerEntryId","==",e)),r=await (0,Z.PL)(a);if(r.empty)return;let n=r.docs.map(async e=>{await (0,Z.oe)((0,Z.JU)(t,"partyPayments",e.id))});await Promise.all(n),console.log("✅ Deleted party payment linked to ledger entry ".concat(e))}catch(e){console.error("Error deleting linked party payment:",e)}},updateLinkedPartyPaymentPartyName=async(e,t)=>{try{let a=(0,z.z)();if(!a)throw Error("Firebase is not configured.");let r=(0,Z.IO)((0,Z.hJ)(a,"partyPayments"),(0,Z.ar)("ledgerEntryId","==",e)),n=await (0,Z.PL)(r);if(n.empty){console.warn("No party payment found linked to ledger entry ".concat(e));return}let i=n.docs.map(async e=>{await (0,Z.r7)((0,Z.JU)(a,"partyPayments",e.id),{partyName:t,updatedAt:new Date().toISOString()})});await Promise.all(i),console.log("✅ Updated party name in payment linked to ledger entry ".concat(e))}catch(e){console.error("Error updating party name in linked party payment:",e)}},revertExpenseDistribution=async(e,t)=>{try{let a=await T.XK.getAllOrders({supplier:t});for(let t of a){if(!t.id||!t.partialPayments)continue;let a=t.partialPayments.filter(t=>t.ledgerEntryId!==e);a.length<t.partialPayments.length&&(await T.XK.updateOrder(t.id,{partialPayments:a}),console.log("✅ Removed payments from order ".concat(t.id," for ledger entry ").concat(e)))}console.log("✅ Reverted expense distribution for ledger entry ".concat(e))}catch(e){console.error("Error reverting expense distribution:",e)}},revertIncomeDistribution=async(e,t)=>{try{let a=await T.XK.getAllOrders({partyName:t});for(let t of a){if(!t.id||!t.customerPayments)continue;let a=t.customerPayments.filter(t=>t.ledgerEntryId!==e);a.length<t.customerPayments.length&&(await T.XK.updateOrder(t.id,{customerPayments:a}),console.log("✅ Removed customer payments from order ".concat(t.id," for ledger entry ").concat(e)))}console.log("✅ Reverted income distribution for ledger entry ".concat(e))}catch(e){console.error("Error reverting income distribution:",e)}},renderEntry=e=>e.id?(0,r.jsx)("button",{onClick:t=>{(0,I.m)(t),handleEntryClick(e)},className:"w-full rounded-lg mb-1 p-2 active:bg-gray-50 transition-all duration-150 touch-manipulation native-press border ".concat("debit"===e.type&&e.supplier?"bg-red-50/40 border-red-200":"bg-white border-gray-100"),style:{WebkitTapHighlightColor:"transparent",position:"relative",overflow:"hidden"},children:(0,r.jsxs)("div",{className:"flex flex-col w-full",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between w-full mb-1",children:[(0,r.jsx)("span",{className:"font-bold ".concat("credit"===e.type?"text-green-700":"text-red-700"),style:{fontSize:"13px"},children:(0,f.formatIndianCurrency)(e.amount)}),(0,r.jsx)("span",{className:"text-gray-500 flex-shrink-0",style:{fontSize:"10px"},children:(0,s.ZP)(new Date(e.date),"dd MMM")})]}),e.note&&(0,r.jsx)("div",{className:"text-gray-600 text-left w-full mt-0.5",style:{fontSize:"11px",lineHeight:"1.3"},children:e.note}),"credit"===e.type&&e.partyName&&(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsxs)("span",{className:"inline-block px-1.5 py-0.5 rounded bg-green-100 text-green-700 text-[10px] font-semibold",children:["Party: ",e.partyName]})}),"debit"===e.type&&e.supplier&&(0,r.jsx)("div",{className:"mt-1",children:(0,r.jsxs)("span",{className:"inline-block px-1.5 py-0.5 rounded bg-red-100 text-red-700 text-[10px] font-semibold",children:["Supplier: ",e.supplier]})})]})},e.id):null,renderActivity=e=>{let t=[];return"created"===e.activityType?(void 0!==e.amount&&null!==e.amount&&t.push({label:"Amount",old:null,new:e.amount,formatter:e=>(0,f.formatIndianCurrency)(e||0)}),e.date&&t.push({label:"Date",old:null,new:e.date,formatter:e=>e?(0,s.ZP)(new Date(e),"dd MMM yyyy"):"N/A"}),e.note&&t.push({label:"Note",old:null,new:e.note}),e.supplier&&t.push({label:"Supplier",old:null,new:e.supplier}),e.partyName&&t.push({label:"Party",old:null,new:e.partyName})):"deleted"===e.activityType?(void 0!==e.previousAmount&&null!==e.previousAmount&&t.push({label:"Amount",old:e.previousAmount,new:null,formatter:e=>(0,f.formatIndianCurrency)(e||0)}),e.previousDate&&t.push({label:"Date",old:e.previousDate,new:null,formatter:e=>e?(0,s.ZP)(new Date(e),"dd MMM yyyy"):"N/A"}),e.previousNote&&t.push({label:"Note",old:e.previousNote,new:null}),e.previousSupplier&&t.push({label:"Supplier",old:e.previousSupplier,new:null}),e.previousPartyName&&t.push({label:"Party",old:e.previousPartyName,new:null})):(e.previousAmount!==e.amount&&(void 0!==e.previousAmount||void 0!==e.amount)&&t.push({label:"Amount",old:e.previousAmount,new:e.amount,formatter:e=>(0,f.formatIndianCurrency)(e||0)}),e.previousDate!==e.date&&(e.previousDate||e.date)&&t.push({label:"Date",old:e.previousDate,new:e.date,formatter:e=>e?(0,s.ZP)(new Date(e),"dd MMM yyyy"):"N/A"}),e.previousNote!==e.note&&(void 0!==e.previousNote||void 0!==e.note)&&t.push({label:"Note",old:e.previousNote,new:e.note}),e.previousSupplier!==e.supplier&&(void 0!==e.previousSupplier||void 0!==e.supplier)&&t.push({label:"Supplier",old:e.previousSupplier,new:e.supplier}),e.previousPartyName!==e.partyName&&(void 0!==e.previousPartyName||void 0!==e.partyName)&&t.push({label:"Party",old:e.previousPartyName,new:e.partyName})),(0,r.jsx)("div",{className:"rounded-lg border-l-3 ".concat((()=>{switch(e.activityType){case"created":return"bg-green-50/50 border-l-3 border-green-500";case"updated":return"bg-blue-50/50 border-l-3 border-blue-500";case"deleted":return"bg-red-50/50 border-l-3 border-red-500";default:return"bg-gray-50/50 border-l-3 border-gray-400"}})()," transition-all duration-150 hover:shadow-sm"),style:{borderLeftWidth:"3px"},children:(0,r.jsxs)("div",{className:"p-2.5",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1.5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5 flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(()=>{switch(e.activityType){case"created":return(0,r.jsx)(l,{size:14,className:"text-green-600"});case"updated":return(0,r.jsx)(d.Z,{size:14,className:"text-blue-600"});case"deleted":return(0,r.jsx)(c.Z,{size:14,className:"text-red-600"});default:return null}})()}),(0,r.jsx)("span",{className:"font-semibold text-gray-900 text-xs",children:(()=>{switch(e.activityType){case"created":return"Created";case"updated":return"Updated";case"deleted":return"Deleted";default:return"Activity"}})()}),e.type&&(0,r.jsx)("span",{className:"px-1.5 py-0.5 rounded text-[10px] font-semibold flex-shrink-0 ".concat("credit"===e.type?"bg-green-100 text-green-700":"bg-red-100 text-red-700"),children:"credit"===e.type?"Income":"Expense"})]}),(0,r.jsx)("span",{className:"text-gray-500 text-[10px] flex-shrink-0 ml-2",children:(e=>{let t=new Date(e),a=new Date,r=a.getTime()-t.getTime(),n=Math.floor(r/6e4),i=Math.floor(r/36e5),o=Math.floor(r/864e5);return n<1?"Just now":n<60?"".concat(n,"m ago"):i<24?"".concat(i,"h ago"):o<7?"".concat(o,"d ago"):(0,s.ZP)(t,"dd MMM, hh:mm a")})(e.timestamp)})]}),t.length>0&&(0,r.jsx)("div",{className:"flex flex-wrap items-center gap-x-2 gap-y-1 mt-1.5",children:t.map((t,a)=>(0,r.jsxs)("div",{className:"flex items-center gap-1 text-[10px]",children:[(0,r.jsxs)("span",{className:"text-gray-500 font-medium",children:[t.label,":"]}),"created"===e.activityType?(0,r.jsx)("span",{className:"text-gray-800 font-semibold",children:t.formatter?t.formatter(t.new):String(t.new)}):"deleted"===e.activityType?(0,r.jsx)("span",{className:"text-gray-600 line-through",children:t.formatter?t.formatter(t.old):String(t.old)}):(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[void 0!==t.old&&null!==t.old&&""!==t.old&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"text-red-600 line-through",children:t.formatter?t.formatter(t.old):String(t.old)}),(0,r.jsx)("span",{className:"text-gray-400",children:"→"})]}),void 0!==t.new&&null!==t.new&&""!==t.new?(0,r.jsx)("span",{className:"text-green-600 font-semibold",children:t.formatter?t.formatter(t.new):String(t.new)}):void 0!==t.old&&(0,r.jsx)("span",{className:"text-gray-400 italic",children:"removed"})]})]},a))})]})},e.id)};return X?(0,r.jsx)(LedgerEntryWizard,{entry:$||null,type:_,onClose:()=>{V(!1),Q(null)},onSave:handleSaveEntry,onDelete:e=>{er(e),et(!0)},onDeleteConfirm:async t=>{try{let a=e.find(e=>e.id===t);a&&("credit"===a.type&&a.partyName&&await revertIncomeDistribution(t,a.partyName),"debit"===a.type&&a.supplier&&await revertExpenseDistribution(t,a.supplier)),await i.ledgerService.remove(t),V(!1),Q(null)}catch(e){throw console.error("Failed to delete entry:",e),e}}}):(0,r.jsxs)("div",{className:"bg-gray-50",style:{height:"100dvh",minHeight:"100dvh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,r.jsxs)("div",{className:"bg-primary-600 text-white p-2 pt-safe sticky top-0 z-40",style:{flexShrink:0},children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1.5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1.5 min-w-0",children:[(0,r.jsx)(m.Z,{size:18}),(0,r.jsx)("h1",{className:"text-lg font-bold truncate",children:"Ledger"})]}),"activity"===S&&(0,r.jsx)("button",{onClick:e=>{(0,I.m)(e),F(!A)},className:"p-1.5 bg-white/20 backdrop-blur-sm rounded-lg active:bg-white/30 transition-colors touch-manipulation",style:{WebkitTapHighlightColor:"transparent"},children:(0,r.jsx)(u.Z,{size:16})})]}),"entries"===S&&(0,r.jsxs)("div",{className:"bg-white rounded-lg p-2 text-gray-800 flex items-center justify-between",children:[(0,r.jsx)("span",{className:"font-medium",style:{fontSize:"12px"},children:"Balance"}),(0,r.jsxs)("span",{className:"font-bold ".concat(ef>=0?"text-green-700":"text-red-600"),style:{fontSize:"12px"},children:[(0,f.formatIndianCurrency)(Math.abs(ef))," ",ef>=0?"":"(Dr)"]})]}),(0,r.jsxs)("div",{className:"flex gap-1 mt-2 overflow-x-auto pb-1 no-scrollbar",children:[(0,r.jsxs)("button",{onClick:e=>{(0,I.m)(e),k("entries")},className:"flex-1 py-2 px-3 whitespace-nowrap rounded-lg font-medium transition-all duration-200 touch-manipulation flex items-center justify-center gap-1.5 ".concat("entries"===S?"bg-white text-primary-600 shadow-sm":"bg-white/20 text-white/80 active:bg-white/30"),style:{fontSize:"13px",WebkitTapHighlightColor:"transparent"},children:[(0,r.jsx)(p,{size:14}),"Entries"]}),(0,r.jsxs)("button",{onClick:e=>{(0,I.m)(e),k("timeline")},className:"flex-1 py-2 px-3 whitespace-nowrap rounded-lg font-medium transition-all duration-200 touch-manipulation flex items-center justify-center gap-1.5 ".concat("timeline"===S?"bg-white text-primary-600 shadow-sm":"bg-white/20 text-white/80 active:bg-white/30"),style:{fontSize:"13px",WebkitTapHighlightColor:"transparent"},children:[(0,r.jsx)(y.Z,{size:14}),"Timeline"]}),(0,r.jsxs)("button",{onClick:e=>{(0,I.m)(e),k("activity")},className:"flex-1 py-2 px-3 whitespace-nowrap rounded-lg font-medium transition-all duration-200 touch-manipulation flex items-center justify-center gap-1.5 ".concat("activity"===S?"bg-white text-primary-600 shadow-sm":"bg-white/20 text-white/80 active:bg-white/30"),style:{fontSize:"13px",WebkitTapHighlightColor:"transparent"},children:[(0,r.jsx)(g,{size:14}),"Log"]}),(0,r.jsxs)("button",{onClick:e=>{(0,I.m)(e),k("investment")},className:"flex-1 py-2 px-3 whitespace-nowrap rounded-lg font-medium transition-all duration-200 touch-manipulation flex items-center justify-center gap-1.5 ".concat("investment"===S?"bg-white text-primary-600 shadow-sm":"bg-white/20 text-white/80 active:bg-white/30"),style:{fontSize:"13px",WebkitTapHighlightColor:"transparent"},children:[(0,r.jsx)(m.Z,{size:14}),"Inv."]})]}),A&&"activity"===S&&(0,r.jsxs)("div",{className:"mt-2 bg-white/95 backdrop-blur-xl rounded-lg p-2 space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsx)("span",{className:"text-gray-800 font-medium",style:{fontSize:"12px"},children:"Date Range"}),(0,r.jsx)("button",{onClick:e=>{(0,I.m)(e),U(""),J("")},className:"text-primary-600 text-xs font-medium active:opacity-70 touch-manipulation",style:{WebkitTapHighlightColor:"transparent"},children:"Clear"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"Start Date"}),(0,r.jsx)("input",{type:"date",value:B,onChange:e=>U(e.target.value),className:"w-full px-2 py-1.5 bg-gray-50 border border-gray-200 rounded-lg text-xs text-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-600 mb-1",children:"End Date"}),(0,r.jsx)("input",{type:"date",value:K,onChange:e=>J(e.target.value),className:"w-full px-2 py-1.5 bg-gray-50 border border-gray-200 rounded-lg text-xs text-gray-800 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"})]})]}),(0,r.jsxs)("div",{className:"mt-2 grid grid-cols-3 gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>handleModeChange("add"),className:"px-2 py-1 rounded-lg text-xs font-medium ".concat("add"===ex?"bg-amber-600 text-white":"bg-gray-100 text-gray-800"," active:opacity-80"),children:"Add Investment"}),(0,r.jsx)("button",{type:"button",onClick:()=>handleModeChange("reduce"),className:"px-2 py-1 rounded-lg text-xs font-medium ".concat("reduce"===ex?"bg-amber-600 text-white":"bg-gray-100 text-gray-800"," active:opacity-80"),children:"Reduce Amount"}),(0,r.jsx)("button",{type:"button",onClick:()=>handleModeChange("set"),className:"px-2 py-1 rounded-lg text-xs font-medium ".concat("set"===ex?"bg-amber-600 text-white":"bg-gray-100 text-gray-800"," active:opacity-80"),children:"Set Exact Value"})]})]})]}),(0,r.jsx)("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column",paddingBottom:"entries"===S?"9.25rem":"5rem"},children:"entries"===S?N?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsx)(M.Z,{size:100})}):(0,r.jsxs)("div",{className:"flex-1 grid grid-cols-2 gap-1.5 p-1.5",style:{minHeight:0},children:[(0,r.jsxs)("div",{className:"bg-green-50 rounded-lg p-1.5 border border-green-200 flex flex-col",style:{minHeight:0},children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-1.5 flex-shrink-0",children:(0,r.jsxs)("h2",{className:"font-semibold text-green-800 flex items-center gap-1",style:{fontSize:"12px"},children:[(0,r.jsx)(l,{size:14}),"Income"]})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-1.5 mb-1.5 border border-green-300 flex-shrink-0",children:[(0,r.jsx)("div",{className:"text-gray-600",style:{fontSize:"11px"},children:"Total"}),(0,r.jsx)("div",{className:"font-bold text-green-700",style:{fontSize:"12px"},children:(0,f.formatIndianCurrency)(ew)})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto space-y-1",style:{minHeight:0,WebkitOverflowScrolling:"touch"},children:0===eb.length?(0,r.jsx)("div",{className:"text-center text-gray-400 py-4",style:{fontSize:"11px"},children:"No entries"}):eb.map(renderEntry)})]}),(0,r.jsxs)("div",{className:"bg-red-50 rounded-lg p-1.5 border border-red-200 flex flex-col",style:{minHeight:0},children:[(0,r.jsx)("div",{className:"flex items-center justify-between mb-1.5 flex-shrink-0",children:(0,r.jsxs)("h2",{className:"font-semibold text-red-800 flex items-center gap-1",style:{fontSize:"12px"},children:[(0,r.jsx)(x,{size:14}),"Expenses"]})}),(0,r.jsxs)("div",{className:"bg-white rounded-lg p-1.5 mb-1.5 border border-red-300 flex-shrink-0",children:[(0,r.jsx)("div",{className:"text-gray-600",style:{fontSize:"11px"},children:"Total"}),(0,r.jsx)("div",{className:"font-bold text-red-700",style:{fontSize:"12px"},children:(0,f.formatIndianCurrency)(eN)})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto space-y-1",style:{minHeight:0,WebkitOverflowScrolling:"touch"},children:0===ev.length?(0,r.jsx)("div",{className:"text-center text-gray-400 py-4",style:{fontSize:"11px"},children:"No entries"}):ev.map(renderEntry)})]})]}):"timeline"===S?(0,r.jsx)("div",{className:"flex-1 overflow-y-auto",style:{WebkitOverflowScrolling:"touch"},children:N?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center py-12",children:(0,r.jsx)(M.Z,{size:100})}):(0,r.jsx)(LedgerTimelineView,{entries:e,investment:en,investmentHistory:es,invoices:a,orders:v})}):"investment"===S?(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-3 space-y-4",style:{WebkitOverflowScrolling:"touch"},children:[(0,r.jsxs)("div",{className:"bg-gradient-to-br from-amber-500 to-amber-600 rounded-2xl p-4 text-white shadow-lg relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:(0,r.jsx)(m.Z,{size:100})}),(0,r.jsxs)("div",{className:"relative z-10",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"p-2 bg-white/20 rounded-xl backdrop-blur-sm",children:(0,r.jsx)(m.Z,{size:20,className:"text-white"})}),(0,r.jsx)("h3",{className:"text-lg font-bold text-white",children:"Current Investment"})]}),(0,r.jsx)("button",{onClick:e=>{(0,I.m)(e),openInvestmentDrawer()},className:"p-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors backdrop-blur-sm",children:(0,r.jsx)(d.Z,{size:18,className:"text-white"})})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("p",{className:"text-sm text-amber-100 mb-1",children:"Total Capital Invested"}),(0,r.jsx)("p",{className:"text-3xl font-bold",children:en?(0,f.formatIndianCurrency)(en.amount):(0,f.formatIndianCurrency)(0)})]}),en&&(0,r.jsxs)("div",{className:"space-y-2 text-sm text-amber-50",children:[(0,r.jsxs)("div",{className:"flex justify-between border-b border-white/10 pb-2",children:[(0,r.jsx)("span",{children:"Date"}),(0,r.jsx)("span",{className:"font-medium",children:(0,s.ZP)(new Date(en.date),"dd MMM yyyy")})]}),en.note&&(0,r.jsxs)("div",{className:"flex justify-between border-b border-white/10 pb-2",children:[(0,r.jsx)("span",{children:"Note"}),(0,r.jsx)("span",{className:"font-medium",children:en.note})]}),(0,r.jsxs)("div",{className:"flex justify-between pt-1",children:[(0,r.jsx)("span",{children:"Last Updated"}),(0,r.jsx)("span",{className:"font-medium",children:en.updatedAt?(0,s.ZP)(new Date(en.updatedAt),"dd MMM yyyy HH:mm"):(0,s.ZP)(new Date(en.createdAt||en.date),"dd MMM yyyy HH:mm")})]})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"text-base font-bold text-gray-800 mb-3 flex items-center gap-2",children:[(0,r.jsx)(g,{size:18,className:"text-gray-500"}),"History"]}),(0,r.jsx)("div",{className:"space-y-3",children:0===es.length?(0,r.jsx)("div",{className:"text-center text-gray-400 py-8 bg-gray-50 rounded-xl border border-gray-100",children:"No history available"}):es.map(e=>(0,r.jsxs)("div",{className:"bg-white p-3 rounded-xl border border-gray-100 shadow-sm",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"p-1.5 rounded-lg ".concat("created"===e.activityType?"bg-green-100 text-green-600":"bg-blue-100 text-blue-600"),children:"created"===e.activityType?(0,r.jsx)(h.Z,{size:14}):(0,r.jsx)(d.Z,{size:14})}),(0,r.jsxs)("span",{className:"font-medium text-gray-900 text-sm capitalize",children:["Investment ",e.activityType]})]}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:(0,s.ZP)(new Date(e.timestamp),"dd MMM HH:mm")})]}),(0,r.jsxs)("div",{className:"pl-9 space-y-1",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Amount"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[void 0!==e.previousAmount&&e.previousAmount!==e.amount&&(0,r.jsx)("span",{className:"text-gray-400 line-through text-xs",children:(0,f.formatIndianCurrency)(e.previousAmount)}),(0,r.jsx)("span",{className:"font-bold text-gray-900",children:(0,f.formatIndianCurrency)(e.amount)})]})]}),void 0!==e.previousDate&&e.previousDate!==e.date&&(0,r.jsxs)("div",{className:"flex justify-between text-xs",children:[(0,r.jsx)("span",{className:"text-gray-500",children:"Date Changed"}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{className:"text-gray-400 line-through",children:(0,s.ZP)(new Date(e.previousDate),"dd MMM yyyy")}),(0,r.jsx)("span",{children:"→"}),(0,r.jsx)("span",{className:"text-gray-700",children:(0,s.ZP)(new Date(e.date),"dd MMM yyyy")})]})]})]})]},e.id))})]})]}):(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-1.5",style:{WebkitOverflowScrolling:"touch"},children:E?(0,r.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,r.jsx)(M.Z,{size:80})}):0===C.length?(0,r.jsxs)("div",{className:"text-center text-gray-400 py-12",style:{fontSize:"13px"},children:["No activity logs found",(B||K)&&(0,r.jsx)("div",{className:"mt-2 text-xs text-gray-500",children:"Try adjusting the date range"})]}):(0,r.jsx)("div",{className:"space-y-1.5",children:C.map(e=>renderActivity(e))})})}),"entries"===S&&(0,r.jsx)("div",{className:"fixed left-0 right-0 z-30 flex items-end justify-center",style:{bottom:"5.25rem",paddingLeft:"max(0.75rem, env(safe-area-inset-left, 0px))",paddingRight:"max(0.75rem, env(safe-area-inset-right, 0px))",pointerEvents:"none"},children:(0,r.jsx)("div",{className:"bg-white/95 backdrop-blur-xl border border-gray-200/60 rounded-2xl w-full",style:{padding:"0.75rem",boxShadow:"0 2px 16px rgba(0, 0, 0, 0.06), 0 1px 4px rgba(0, 0, 0, 0.03)",pointerEvents:"auto"},children:(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)("button",{onClick:e=>{(0,I.m)(e),handleAddEntry("credit")},className:"flex-1 bg-green-600 text-white rounded-xl active:bg-green-700 transition-colors flex items-center justify-center gap-2 py-3 touch-manipulation font-medium native-press",style:{WebkitTapHighlightColor:"transparent",fontSize:"14px",position:"relative",overflow:"hidden"},title:"Add Income","aria-label":"Add Income",children:[(0,r.jsx)(h.Z,{size:18}),(0,r.jsx)("span",{children:"Add Income"})]}),(0,r.jsxs)("button",{onClick:e=>{(0,I.m)(e),handleAddEntry("debit")},className:"flex-1 bg-red-600 text-white rounded-xl active:bg-red-700 transition-colors flex items-center justify-center gap-2 py-3 touch-manipulation font-medium native-press",style:{WebkitTapHighlightColor:"transparent",fontSize:"14px",position:"relative",overflow:"hidden"},title:"Add Expense","aria-label":"Add Expense",children:[(0,r.jsx)(h.Z,{size:18}),(0,r.jsx)("span",{children:"Add Expense"})]})]})})}),(0,r.jsx)(BottomSheet,{isOpen:ee,onClose:()=>{et(!1),er(null)},onConfirm:handleDeleteConfirm,title:"Delete Entry?",message:"This action cannot be undone.",confirmText:"Delete",cancelText:"Cancel",confirmColor:"red"}),(0,r.jsx)(BottomSheet,{isOpen:el,onClose:()=>ed(!1),title:"Update Investment",confirmText:"Save",cancelText:"Cancel",onConfirm:handleSaveInvestment,confirmColor:"amber",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Investment Amount"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"₹"}),(0,r.jsx)("input",{type:"number",value:ec,onChange:e=>em(e.target.value),className:"w-full pl-8 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none",placeholder:"0"})]}),(0,r.jsxs)("div",{className:"mt-2 grid grid-cols-3 gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:()=>handleModeChange("add"),className:"px-2 py-1 rounded-lg text-xs font-medium ".concat("add"===ex?"bg-amber-600 text-white":"bg-gray-100 text-gray-800"," active:opacity-80"),children:"Add Investment"}),(0,r.jsx)("button",{type:"button",onClick:()=>handleModeChange("reduce"),className:"px-2 py-1 rounded-lg text-xs font-medium ".concat("reduce"===ex?"bg-amber-600 text-white":"bg-gray-100 text-gray-800"," active:opacity-80"),children:"Reduce Amount"}),(0,r.jsx)("button",{type:"button",onClick:()=>handleModeChange("set"),className:"px-2 py-1 rounded-lg text-xs font-medium ".concat("set"===ex?"bg-amber-600 text-white":"bg-gray-100 text-gray-800"," active:opacity-80"),children:"Set Exact Value"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Note (Optional)"}),(0,r.jsx)("textarea",{value:ey,onChange:e=>eg(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent outline-none resize-none",rows:3,placeholder:"Add a note about this investment..."})]})]})}),(0,r.jsx)(b.Z,{})]})}},79699:function(e,t,a){"use strict";a.d(t,{K:function(){return i}});var r=a(45050),n=a(24086);let i=new class{async getInvestment(){try{let e=(0,r.z)();if(!e)throw Error("Database not initialized");let t=await (0,n.PL)((0,n.hJ)(e,this.collectionName));if(t.empty)return null;let a=t.docs[0];return{id:a.id,...a.data()}}catch(e){throw console.error("Error getting investment:",e),e}}async setInvestment(e,t,a){try{let i=(0,r.z)();if(!i)throw Error("Database not initialized");let s=await this.getInvestment(),o=new Date().toISOString();if(s&&s.id){let r=s.amount,l=s.date,d=s.note||"",c=r!==e||l!==t||d.trim()!==(a||"").trim();if(!c)return console.log("No changes detected for investment update, skipping."),s.id;return await (0,n.r7)((0,n.JU)(i,this.collectionName,s.id),{amount:e,date:t,note:a||"",updatedAt:o}),await this.logActivity({activityType:"updated",amount:e,previousAmount:r,date:t,previousDate:l,note:a,previousNote:d,timestamp:o}),s.id}{let r=await (0,n.ET)((0,n.hJ)(i,this.collectionName),{amount:e,date:t,note:a||"",createdAt:o,updatedAt:o});return await this.logActivity({activityType:"created",amount:e,date:t,note:a,timestamp:o}),r.id}}catch(e){throw console.error("Error setting investment:",e),e}}async getActivityLog(){try{let e=(0,r.z)();if(!e)return[];let t=(0,n.IO)((0,n.hJ)(e,this.activityCollectionName),(0,n.Xo)("timestamp","desc")),a=await (0,n.PL)(t);return a.docs.map(e=>({id:e.id,...e.data()}))}catch(e){return console.error("Error getting investment activity log:",e),[]}}async logActivity(e){try{let t=(0,r.z)();if(!t)return;await (0,n.ET)((0,n.hJ)(t,this.activityCollectionName),e)}catch(e){console.error("Error logging investment activity:",e)}}constructor(){this.collectionName="investment",this.activityCollectionName="investmentActivity"}}}},function(e){e.O(0,[358,118,949,923,295,587,264,971,472,744],function(){return e(e.s=21785)}),_N_E=e.O()}]);