"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[940],{42316:function(e,t,a){a.d(t,{Z:function(){return FilterPopup}});var r=a(57437),n=a(2265),i=a(54887),l=a(82549);function FilterPopup(e){let{isOpen:t,onClose:a,title:s="Filters",children:o}=e,[d,c]=(0,n.useState)(!1),[m,u]=(0,n.useState)(!1),[g,h]=(0,n.useState)(!1),p=(0,n.useRef)(null),x=(0,n.useRef)(null);(0,n.useEffect)(()=>{let checkStandalone=()=>{let e=window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone||document.documentElement.classList.contains("standalone");h(e)};checkStandalone();let e=new MutationObserver(checkStandalone);return e.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>e.disconnect()},[]),(0,n.useEffect)(()=>(t?(c(!1),u(!1),document.body.style.overflow="hidden",requestAnimationFrame(()=>{u(!0)})):(u(!1),document.body.style.overflow=""),()=>{document.body.style.overflow=""}),[t]);let handleClose=()=>{c(!0),u(!1),setTimeout(()=>{a(),c(!1)},250)};if(!t)return null;let y=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{ref:p,onClick:e=>{e.target===p.current&&handleClose()},className:"fixed inset-0 bg-black/50 z-[99999] popup-backdrop ".concat(d?"native-backdrop-exit":m?"native-backdrop-enter":"opacity-0"),style:{willChange:"opacity",WebkitTapHighlightColor:"transparent",touchAction:"none",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999}}),(0,r.jsx)("div",{className:"fixed inset-0 z-[99999] flex items-center justify-center pointer-events-none popup-container",style:{WebkitTapHighlightColor:"transparent",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999,padding:"1rem",paddingLeft:"max(1rem, env(safe-area-inset-left, 0px))",paddingRight:"max(1rem, env(safe-area-inset-right, 0px))"},children:(0,r.jsxs)("div",{ref:x,className:"bg-white rounded-2xl border border-gray-100 max-w-md w-full pointer-events-auto flex flex-col ".concat(d?"native-modal-exit":m?"native-modal-enter":"opacity-0 scale-95 translate-y-4"),style:{willChange:"transform, opacity",backfaceVisibility:"hidden",WebkitFontSmoothing:"antialiased",maxHeight:"calc(100dvh - 2rem - env(safe-area-inset-top, 0px) - env(safe-area-inset-bottom, 0px))"},children:[(0,r.jsxs)("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-gray-200",children:[(0,r.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:s}),(0,r.jsx)("button",{onClick:handleClose,className:"p-1.5 rounded-lg active:bg-gray-100 transition-colors touch-manipulation",style:{WebkitTapHighlightColor:"transparent"},"aria-label":"Close filters",children:(0,r.jsx)(l.Z,{size:20,className:"text-gray-500"})})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-4",style:{WebkitOverflowScrolling:"touch"},children:o})]})})]});return(0,i.createPortal)(y,document.body)}},74513:function(e,t,a){a.d(t,{Z:function(){return OrderForm}});var r=a(57437),n=a(2265),i=a(54887),l=a(28203),s=a(67972),o=a(96142),d=a(4322),c=a(39781),m=a(41298),u=a(11961),g=a(93505),h=a(62442),p=a(94136),x=a(45367),y=a(9883),f=a(81291),b=a(82549),N=a(17158),v=a(70349),w=a(74931),j=a(28521),C=a(56023),S=a(70258),k=a(39414);let T=["Bodeli","Panetha","Nareshware","Kali","Chikhli Kapchi VSI","Chikhli Kapchi","Areth"];var P=a(68286),I=a(86345);let E=["date","partyName","siteName","material","weight","rate","truckOwner","truckNo","supplier","originalWeight","originalRate","additionalCost","payment","review"];function OrderFormWizard(e){let{order:t,onClose:a,onSave:O}=e,A=!!(null==t?void 0:t.id),W=A?E.length-1:0,[Z,R]=(0,n.useState)(W),[z,D]=(0,n.useState)(!1),[F,M]=(0,n.useState)(!1),[H,L]=(0,n.useState)(!1),[B,V]=(0,n.useState)({date:(e=>{if(!e)return new Date().toISOString().split("T")[0];if(/^\d{4}-\d{2}-\d{2}$/.test(e))return e;if(e.includes("T"))return e.split("T")[0];try{return new Date(e).toISOString().split("T")[0]}catch(e){return new Date().toISOString().split("T")[0]}})(null==t?void 0:t.date),partyName:(null==t?void 0:t.partyName)||"",siteName:(null==t?void 0:t.siteName)||"",material:Array.isArray(null==t?void 0:t.material)?t.material:(null==t?void 0:t.material)?[t.material]:[],weight:(null==t?void 0:t.weight)||0,rate:(null==t?void 0:t.rate)||0,truckOwner:(null==t?void 0:t.truckOwner)||"",truckNo:(null==t?void 0:t.truckNo)||"",supplier:(null==t?void 0:t.supplier)||"",originalWeight:(null==t?void 0:t.originalWeight)||0,originalRate:(null==t?void 0:t.originalRate)||0,additionalCost:(null==t?void 0:t.additionalCost)||0,partialPayments:(null==t?void 0:t.partialPayments)||[]}),[q,K]=(0,n.useState)([]),[U,X]=(0,n.useState)([]),[_,Y]=(0,n.useState)([]),[$,G]=(0,n.useState)([]),J=(0,n.useRef)(null);(0,n.useEffect)(()=>(document.body.style.overflow="hidden",requestAnimationFrame(()=>{M(!0)}),loadOptions(),()=>{document.body.style.overflow=""}),[A]);let loadOptions=async()=>{try{let[e,t,a,r]=await Promise.all([v.XK.getUniquePartyNames(),v.XK.getUniqueSiteNames(),v.XK.getUniqueTruckOwners(),v.XK.getUniqueSuppliers()]);K(e),X(t),Y(a),G(r)}catch(e){console.error("Error loading options:",e)}},handleClose=()=>{D(!0),M(!1),setTimeout(()=>{a(),D(!1)},300)},handleNext=()=>{Z<E.length-1&&R(Z+1)},handleAfterEdit=()=>{A?R(E.length-1):handleNext()},handleStepClick=e=>{e!==Z&&R(e)},getStepLabel=e=>({date:"Date",partyName:"Party Name",siteName:"Site Name",material:"Material",weight:"Weight",rate:"Rate",truckOwner:"Truck Owner",truckNo:"Truck Number",supplier:"Supplier",originalWeight:"Original Weight",originalRate:"Original Rate",additionalCost:"Additional Cost",payment:"Payment",review:"Review"})[e],getStepIcon=e=>{let t={date:l.Z,partyName:s.Z,siteName:o.Z,material:d.Z,weight:c.Z,rate:m.Z,truckOwner:u.Z,truckNo:u.Z,supplier:g.Z,originalWeight:c.Z,originalRate:m.Z,additionalCost:m.Z,payment:m.Z,review:h.Z};return t[e]},isStepComplete=e=>{switch(e){case"date":return!!B.date;case"partyName":return!!B.partyName;case"siteName":return!!B.siteName;case"material":return Array.isArray(B.material)&&B.material.length>0;case"weight":return B.weight>0;case"rate":return B.rate>0;case"truckOwner":return!!B.truckOwner;case"truckNo":return!!B.truckNo;case"supplier":return!!B.supplier;case"originalWeight":return B.originalWeight>0;case"originalRate":return B.originalRate>0;case"additionalCost":case"payment":case"review":return!0;default:return!1}},canProceed=()=>{let e=E[Z];return isStepComplete(e)},renderPaymentStep=()=>{let e=B.originalWeight*B.originalRate,t=B.partialPayments||[],a=t.reduce((e,t)=>e+Number(t.amount||0),0),n=e-a,handleAddPayment=async()=>{if(n<=0){(0,I.showToast)("Order is already fully paid","error");return}try{let e=await P.h.prompt({title:"Add Payment",message:"Remaining amount: ".concat((0,w.formatIndianCurrency)(n)),inputLabel:"Payment Amount",inputPlaceholder:"Enter amount",inputType:"text",formatCurrencyInr:!0,confirmText:"Add Payment",cancelText:"Cancel"});if(!e)return;let a=Math.abs(parseFloat(String(e).replace(/,/g,"")));if(!a||Number.isNaN(a)||a<=0){(0,I.showToast)("Invalid amount","error");return}if(a>n){(0,I.showToast)("Payment amount cannot exceed remaining amount (".concat((0,w.formatIndianCurrency)(n),")"),"error");return}let r=await P.h.prompt({title:"Add Note (optional)",inputLabel:"Note",inputPlaceholder:"e.g. Cash payment / Bank transfer",inputType:"text",required:!1,confirmText:"Save",cancelText:"Skip"}),i=new Date().toISOString(),l={id:Date.now().toString()+Math.random().toString(36).substr(2,9),amount:a,date:i,createdAt:i,note:r||void 0};V({...B,partialPayments:[...t,l]}),(0,I.showToast)("Payment added successfully!","success")}catch(e){(null==e?void 0:e.message)&&!e.message.includes("SweetAlert")&&(0,I.showToast)(e.message||"Failed to add payment","error")}},handleEditPayment=async a=>{let r=t.find(e=>e.id===a);if(!r)return;let n=t.filter(e=>e.id!==a).reduce((e,t)=>e+Number(t.amount||0),0),i=e-n,l=!!r.ledgerEntryId;try{let e=await P.h.prompt({title:"Edit Payment",message:"Max amount: ".concat((0,w.formatIndianCurrency)(i)),inputLabel:"Payment Amount",inputPlaceholder:"Enter amount",inputType:"text",formatCurrencyInr:!0,inputValue:r.amount.toString(),confirmText:"Save",cancelText:"Cancel"});if(!e)return;let n=Math.abs(parseFloat(String(e).replace(/,/g,"")));if(!n||Number.isNaN(n)||n<=0){(0,I.showToast)("Invalid amount","error");return}if(n>i){(0,I.showToast)("Payment amount cannot exceed ".concat((0,w.formatIndianCurrency)(i)),"error");return}let s=await P.h.prompt({title:"Edit Note (optional)",inputLabel:"Note",inputPlaceholder:"e.g. Cash payment / Bank transfer",inputType:"text",required:!1,inputValue:r.note||"",confirmText:"Save",cancelText:"Skip"}),o={...r,amount:n,note:s||void 0,...l&&{ledgerEntryId:r.ledgerEntryId}},d=!!l&&!!r&&Math.abs(Number(n)-Number(r.amount))>.01;V({...B,partialPayments:t.map(e=>e.id===a?o:e)}),l&&d?(0,I.showToast)("Payment amount updated. Ledger entry will be redistributed after saving.","success"):l?(0,I.showToast)("Payment updated successfully! (Date/note only - no redistribution needed)","success"):(0,I.showToast)("Payment updated successfully!","success")}catch(e){(null==e?void 0:e.message)&&!e.message.includes("SweetAlert")&&(0,I.showToast)(e.message||"Failed to update payment","error")}},handleRemovePayment=async e=>{let a=t.find(t=>t.id===e);if(!a)return;let r=!!a.ledgerEntryId;try{let n=await P.h.confirm({title:"Remove Payment?",message:"Are you sure you want to remove payment of ".concat((0,w.formatIndianCurrency)(a.amount),"?"),icon:"warning",confirmText:"Remove",cancelText:"Cancel"});if(!n)return;V({...B,partialPayments:t.filter(t=>t.id!==e)}),r?(0,I.showToast)("Payment removed. Ledger entry will be redistributed after saving.","success"):(0,I.showToast)("Payment removed successfully!","success")}catch(e){(null==e?void 0:e.message)&&e.message.includes("SweetAlert")}};return(0,r.jsxs)("div",{className:"py-6",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)(m.Z,{size:48,className:"mx-auto mb-3 text-primary-600"}),(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-1",children:"Partial Payment"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Add payments for raw materials (Optional)"})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)("div",{className:"bg-gradient-to-br from-blue-50 to-blue-100 rounded-xl p-4 border border-blue-200",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Original Total:"}),(0,r.jsx)("span",{className:"font-bold text-gray-900",children:(0,w.formatIndianCurrency)(e)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Total Paid:"}),(0,r.jsx)("span",{className:"font-bold text-green-600",children:(0,w.formatIndianCurrency)(a)})]}),(0,r.jsxs)("div",{className:"pt-2 border-t border-blue-200 flex justify-between",children:[(0,r.jsx)("span",{className:"text-base font-semibold text-gray-700",children:"Remaining:"}),(0,r.jsx)("span",{className:"text-base font-bold ".concat(n>0?"text-red-600":"text-green-600"),children:(0,w.formatIndianCurrency)(Math.abs(n))})]})]})}),t.length>0&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("h3",{className:"text-sm font-semibold text-gray-700",children:"Payment History"}),t.map(e=>{let t=e.date?new Date(e.date):new Date;return(0,r.jsxs)("div",{className:"bg-white border border-gray-200 rounded-lg p-3 flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,r.jsx)("span",{className:"font-semibold text-gray-900",children:(0,w.formatIndianCurrency)(e.amount)}),(0,r.jsx)("span",{className:"text-xs text-gray-500",children:(0,j.ZP)(t,"dd MMM yyyy")})]}),e.note&&(0,r.jsxs)("div",{className:"text-xs text-gray-600 mt-1",children:["• ",e.note]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 ml-3",children:[(0,r.jsx)("button",{onClick:()=>handleEditPayment(e.id),className:"p-1.5 bg-blue-50 text-blue-600 rounded active:bg-blue-100 transition-colors",style:{WebkitTapHighlightColor:"transparent"},title:e.ledgerEntryId?"Edit payment (from ledger)":"Edit payment",children:(0,r.jsx)(p.Z,{size:14})}),(0,r.jsx)("button",{onClick:()=>handleRemovePayment(e.id),className:"p-1.5 bg-red-50 text-red-600 rounded active:bg-red-100 transition-colors",style:{WebkitTapHighlightColor:"transparent"},title:e.ledgerEntryId?"Remove payment (from ledger)":"Remove payment",children:(0,r.jsx)(x.Z,{size:14})}),e.ledgerEntryId&&(0,r.jsx)("span",{className:"text-[10px] bg-purple-100 text-purple-700 px-2 py-1 rounded font-medium",children:"From Ledger"})]})]},e.id)})]}),n>0&&(0,r.jsxs)("button",{onClick:handleAddPayment,className:"w-full py-3 bg-primary-600 text-white rounded-xl font-semibold active:bg-primary-700 transition-colors flex items-center justify-center gap-2 active:scale-[0.98] shadow-lg shadow-primary-600/30",style:{WebkitTapHighlightColor:"transparent"},children:[(0,r.jsx)(y.Z,{size:20}),"Add Payment"]}),0===t.length&&(0,r.jsx)("div",{className:"text-center py-8 text-gray-500 text-sm",children:"No payments added yet. You can skip this step or add payments later."})]})]})},renderReviewStep=()=>{let e=B.weight*B.rate,t=B.originalWeight*B.originalRate,a=e-(t+B.additionalCost);return(0,r.jsxs)("div",{className:"py-6",children:[(0,r.jsxs)("div",{className:"text-center mb-6",children:[(0,r.jsx)(h.Z,{size:64,className:"mx-auto mb-4 text-primary-600"}),(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:A?"Edit Order":"Review Order"}),(0,r.jsx)("p",{className:"text-gray-600",children:A?"Click on any field to edit, then save your changes":"Review all details before saving"})]}),(0,r.jsx)("div",{className:"space-y-3",children:E.slice(0,-1).map((e,t)=>{let a=getStepIcon(e),n=getStepValue(e);return(0,r.jsx)("button",{onClick:()=>handleStepClick(t),className:"w-full text-left bg-white border border-gray-200 rounded-xl p-4 active:bg-gray-50 transition-colors",style:{WebkitTapHighlightColor:"transparent"},children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"p-2 bg-primary-50 rounded-lg",children:(0,r.jsx)(a,{size:20,className:"text-primary-600"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs text-gray-500 mb-0.5",children:getStepLabel(e)}),(0,r.jsx)("div",{className:"text-sm font-semibold text-gray-900",children:n})]})]}),(0,r.jsx)(p.Z,{size:18,className:"text-gray-400"})]})},e)})}),(0,r.jsx)("div",{className:"mt-6 bg-gradient-to-br from-primary-50 to-primary-100 rounded-xl p-4 border border-primary-200",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Total:"}),(0,r.jsx)("span",{className:"font-bold text-gray-900",children:(0,w.formatIndianCurrency)(e)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Original Total:"}),(0,r.jsx)("span",{className:"font-bold text-gray-900",children:(0,w.formatIndianCurrency)(t)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Additional Cost:"}),(0,r.jsx)("span",{className:"font-bold text-gray-900",children:(0,w.formatIndianCurrency)(B.additionalCost)})]}),(()=>{let e=B.partialPayments||[],a=e.reduce((e,t)=>e+Number(t.amount||0),0),n=t-a;return e.length>0?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Payments:"}),(0,r.jsx)("span",{className:"font-bold text-green-600",children:(0,w.formatIndianCurrency)(a)})]}),(0,r.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Remaining:"}),(0,r.jsx)("span",{className:"font-bold ".concat(n>0?"text-red-600":"text-green-600"),children:(0,w.formatIndianCurrency)(Math.abs(n))})]})]}):null})(),(0,r.jsxs)("div",{className:"pt-2 border-t border-primary-200 flex justify-between",children:[(0,r.jsx)("span",{className:"text-base font-semibold text-gray-700",children:"Profit:"}),(0,r.jsx)("span",{className:"text-base font-bold ".concat(a>=0?"text-green-600":"text-red-600"),children:(0,w.formatIndianCurrency)(a)})]})]})})]})},getStepValue=e=>{switch(e){case"date":return B.date?(0,j.ZP)(new Date(B.date),"dd MMM yyyy"):"Not set";case"partyName":return B.partyName||"Not set";case"siteName":return B.siteName||"Not set";case"material":return B.material.length>0?B.material.join(", "):"Not set";case"weight":return B.weight>0?"".concat(B.weight," tons"):"Not set";case"rate":return B.rate>0?(0,w.formatIndianCurrency)(B.rate):"Not set";case"truckOwner":return B.truckOwner||"Not set";case"truckNo":return B.truckNo||"Not set";case"supplier":return B.supplier||"Not set";case"originalWeight":return B.originalWeight>0?"".concat(B.originalWeight," tons"):"Not set";case"originalRate":return B.originalRate>0?(0,w.formatIndianCurrency)(B.originalRate):"Not set";case"additionalCost":return B.additionalCost>0?(0,w.formatIndianCurrency)(B.additionalCost):"₹0";case"payment":let t=B.partialPayments||[],a=t.reduce((e,t)=>e+Number(t.amount||0),0);return t.length>0?"".concat(t.length," payment(s) - ").concat((0,w.formatIndianCurrency)(a)):"No payments";default:return""}},handleSubmit=async()=>{if(!B.material||0===B.material.length){alert("Please select at least one material");return}if(!B.partyName.trim()){alert("Please enter a party name");return}if(!B.siteName.trim()){alert("Please enter a site name");return}if(0>=Number(B.weight)){alert("Please enter a valid weight");return}if(0>=Number(B.rate)){alert("Please enter a valid rate");return}L(!0);try{let e;let a=Number(B.weight)*Number(B.rate),r=Number(B.originalWeight)*Number(B.originalRate),n=a-(r+Number(B.additionalCost)),i=(B.partialPayments||[]).filter(e=>e&&e.id).map(e=>{let t="number"==typeof e.amount?e.amount:Number(String(e.amount).replace(/,/g,""))||0,a=e.date;if(a&&"string"==typeof a){if(!a.includes("T"))try{a=new Date(a+"T00:00:00").toISOString()}catch(e){a=new Date().toISOString()}}else a=new Date().toISOString();let r=e.createdAt;if(r&&"string"==typeof r&&!r.includes("T"))try{r=new Date(r+"T00:00:00").toISOString()}catch(e){r=a}r&&"string"==typeof r||(r=a);let n={id:String(e.id),amount:t,date:a,createdAt:r,...e.note&&e.note.trim()&&{note:e.note.trim()},...e.ledgerEntryId&&{ledgerEntryId:String(e.ledgerEntryId)}};return n}).filter(e=>e.amount>0&&e.id),l=B.date.includes("T")?B.date:"".concat(B.date,"T00:00:00.000Z");if(Array.isArray(B.material)){if(0===B.material.length)throw Error("Material cannot be empty");e=B.material}else if(B.material)e=[B.material];else throw Error("Material cannot be empty");let s={date:l,partyName:B.partyName.trim(),siteName:B.siteName.trim(),material:e,weight:Number(B.weight)||0,rate:Number(B.rate)||0,total:a,truckOwner:B.truckOwner.trim(),truckNo:B.truckNo.trim(),supplier:B.supplier.trim(),originalWeight:Number(B.originalWeight)||0,originalRate:Number(B.originalRate)||0,originalTotal:r,additionalCost:Number(B.additionalCost)||0,profit:n,...i.length>0&&{partialPayments:i},...(null==t?void 0:t.invoiced)!==void 0&&{invoiced:t.invoiced},...(null==t?void 0:t.invoiceId)&&{invoiceId:t.invoiceId},...(null==t?void 0:t.archived)!==void 0&&{archived:t.archived}};await O(s),handleClose()}catch(e){console.error("Error saving order:",e),alert((null==e?void 0:e.message)||"Error saving order. Please try again."),L(!1)}},Q=(0,r.jsxs)("div",{className:"fixed inset-0 bg-white z-[99999] flex flex-col overflow-hidden ".concat(z?"native-modal-exit":F?"native-modal-enter":"opacity-0"),style:{WebkitTapHighlightColor:"transparent",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:99999,height:"100dvh",paddingTop:"env(safe-area-inset-top, 0px)",paddingBottom:"env(safe-area-inset-bottom, 0px)",paddingLeft:"env(safe-area-inset-left, 0px)",paddingRight:"env(safe-area-inset-right, 0px)"},children:[(0,r.jsxs)("div",{className:"flex-shrink-0 flex items-center justify-between p-4 border-b border-gray-200 bg-white",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[Z>0&&(0,r.jsx)("button",{onClick:()=>{Z>0&&R(Z-1)},className:"p-2 active:bg-gray-100 active:scale-[0.95] rounded-lg transition-transform duration-100",style:{WebkitTapHighlightColor:"transparent"},children:(0,r.jsx)(f.Z,{size:20,className:"text-gray-600"})}),(0,r.jsxs)("div",{children:[!(A&&"review"===E[Z])&&(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["Step ",Z+1," of ",E.length]}),(0,r.jsx)("h2",{className:"text-lg font-bold text-gray-900",children:getStepLabel(E[Z])})]})]}),(0,r.jsx)("button",{onClick:handleClose,className:"p-2 active:bg-gray-100 active:scale-95 rounded-lg transition-all duration-150",style:{WebkitTapHighlightColor:"transparent"},children:(0,r.jsx)(b.Z,{size:20,className:"text-gray-500"})})]}),(0,r.jsx)("div",{className:"flex-shrink-0 px-4 py-2 bg-gray-50 border-b border-gray-200",children:(0,r.jsx)("div",{className:"flex gap-1",children:E.map((e,t)=>{let a=isStepComplete(e),n=t===Z;return(0,r.jsx)("button",{onClick:()=>handleStepClick(t),className:"flex-1 h-1.5 rounded-full transition-all duration-200 ease-out ".concat(a?"bg-green-500":n?"bg-primary-600":"bg-gray-300"),style:{WebkitTapHighlightColor:"transparent",transform:n?"scaleY(1.2)":"scaleY(1)"},title:getStepLabel(e)},e)})})}),"review"!==E[Z]&&(()=>{let e=E.filter(e=>"review"!==e),t=e.filter((e,t)=>{let a=getStepValue(e);return"Not set"!==a&&"₹0"!==a&&""!==a&&"No payments"!==a});return 0===t.length?null:(0,r.jsxs)("div",{className:"flex-shrink-0 px-4 pt-3 pb-2 border-t border-gray-100 bg-gradient-to-br from-gray-50 to-gray-100/50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsxs)("div",{className:"text-xs font-semibold text-gray-700 flex items-center gap-1.5",children:[(0,r.jsx)(h.Z,{size:14,className:"text-green-600"}),"Filled Details"]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[t.length," / ",e.length," completed"]})]}),(0,r.jsx)("div",{className:"grid grid-cols-3 gap-1.5 max-h-32 overflow-y-auto",style:{WebkitOverflowScrolling:"touch"},children:e.map((e,t)=>{let a=getStepValue(e);if("Not set"===a||"₹0"===a||""===a||"No payments"===a)return null;let n=t===Z,i=getStepIcon(e);return(0,r.jsxs)("button",{onClick:()=>handleStepClick(t),className:"px-1.5 py-1 bg-white border rounded text-[10px] text-left active:bg-gray-50 active:scale-[0.98] transition-all duration-150 flex items-center gap-1 shadow-sm ".concat(n?"border-primary-400 bg-primary-50/50":"border-gray-200"),style:{WebkitTapHighlightColor:"transparent"},children:[(0,r.jsx)(i,{size:10,className:"flex-shrink-0 ".concat(n?"text-primary-600":"text-gray-400")}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("div",{className:"font-medium text-gray-700 truncate",style:{fontSize:"9px"},children:getStepLabel(e)}),(0,r.jsx)("div",{className:"truncate ".concat(n?"text-primary-700 font-semibold":"text-gray-600"),style:{fontSize:"10px"},children:a})]})]},e)})})]})})(),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 pb-32",style:{WebkitOverflowScrolling:"touch"},children:(0,r.jsx)("div",{className:"max-w-2xl mx-auto w-full",children:(()=>{let e=E[Z];switch(e){case"date":return(0,r.jsx)(k.Z,{value:B.date,onChange:e=>{V({...B,date:e}),setTimeout(()=>handleAfterEdit(),100)},onClose:()=>{},label:"Select Date",inline:!0});case"partyName":return(0,r.jsx)(S.Z,{options:q,value:B.partyName,onChange:e=>{V({...B,partyName:e}),setTimeout(()=>handleAfterEdit(),100)},onClose:()=>{},label:"Select Party Name",allowCustom:!0,onCustomAdd:e=>{K([...q,e])},inline:!0});case"siteName":return(0,r.jsx)(S.Z,{options:U,value:B.siteName,onChange:e=>{V({...B,siteName:e}),setTimeout(()=>handleAfterEdit(),100)},onClose:()=>{},label:"Select Site Name",allowCustom:!0,onCustomAdd:e=>{X([...U,e])},inline:!0});case"material":return(0,r.jsx)(S.Z,{options:[...T],value:"",onChange:()=>{},onClose:()=>{B.material.length>0&&setTimeout(()=>handleAfterEdit(),100)},label:"Select Material",multiSelect:!0,selectedValues:B.material,onMultiChange:e=>{V({...B,material:e})},inline:!0});case"weight":return(0,r.jsx)(C.Z,{value:B.weight,onChange:e=>{J.current=e;let t={...B,weight:e};!A&&e>0&&(t.originalWeight=e),V(t)},onClose:()=>{let e=J.current;e>0&&setTimeout(()=>handleAfterEdit(),100),J.current=null},label:"Enter Weight (tons)",inline:!0,hideDoneButton:!0});case"rate":return(0,r.jsx)(C.Z,{value:B.rate,onChange:e=>{J.current=e,V({...B,rate:e})},onClose:()=>{let e=J.current;e>0&&setTimeout(()=>handleAfterEdit(),100),J.current=null},label:"Enter Rate",inline:!0,hideDoneButton:!0,showCurrency:!0});case"truckOwner":return(0,r.jsx)(S.Z,{options:_,value:B.truckOwner,onChange:e=>{V({...B,truckOwner:e}),setTimeout(()=>handleAfterEdit(),100)},onClose:()=>{},label:"Select Truck Owner",allowCustom:!0,onCustomAdd:e=>{Y([..._,e])},inline:!0});case"truckNo":return(0,r.jsxs)("div",{className:"w-full",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Truck Number"}),(0,r.jsx)("textarea",{value:B.truckNo,onChange:e=>{V({...B,truckNo:e.target.value})},placeholder:"Enter truck registration number",className:"w-full px-3 py-2.5 border border-gray-300 rounded-lg text-sm text-gray-900 bg-white focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none",rows:2,style:{WebkitTapHighlightColor:"transparent",fontFamily:"inherit"},autoFocus:!0})]});case"supplier":return(0,r.jsx)(S.Z,{options:$,value:B.supplier,onChange:e=>{V({...B,supplier:e}),setTimeout(()=>handleAfterEdit(),100)},onClose:()=>{},label:"Select Supplier",allowCustom:!0,onCustomAdd:e=>{G([...$,e])},inline:!0});case"originalWeight":return(0,r.jsx)(C.Z,{value:B.originalWeight,onChange:e=>{J.current=e,V({...B,originalWeight:e})},onClose:()=>{let e=J.current;e>0&&setTimeout(()=>handleAfterEdit(),100),J.current=null},label:"Enter Original Weight (tons)",inline:!0,hideDoneButton:!0});case"originalRate":return(0,r.jsx)(C.Z,{value:B.originalRate,onChange:e=>{J.current=e,V({...B,originalRate:e})},onClose:()=>{let e=J.current;e>0&&setTimeout(()=>handleAfterEdit(),100),J.current=null},label:"Enter Original Rate",inline:!0,hideDoneButton:!0,showCurrency:!0});case"additionalCost":return(0,r.jsx)(C.Z,{value:B.additionalCost,onChange:e=>{V({...B,additionalCost:e})},onClose:()=>{setTimeout(()=>handleAfterEdit(),100)},label:"Enter Additional Cost",inline:!0,hideDoneButton:!0,showCurrency:!0});case"payment":return renderPaymentStep();case"review":return renderReviewStep();default:return null}})()})}),"review"!==E[Z]&&(0,r.jsx)("div",{className:"flex-shrink-0 p-4 border-t border-gray-200",children:(0,r.jsxs)("button",{onClick:handleNext,disabled:!canProceed(),className:"w-full h-12 bg-primary-600 text-white rounded-xl font-semibold active:bg-primary-700 transition-transform duration-100 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 active:scale-[0.98] shadow-lg shadow-primary-600/30",style:{WebkitTapHighlightColor:"transparent"},children:["Continue",(0,r.jsx)(N.Z,{size:20,className:"transition-transform duration-200 group-hover:translate-x-1"})]})}),"review"===E[Z]&&(0,r.jsx)("div",{className:"flex-shrink-0 p-4 border-t border-gray-200",children:(0,r.jsxs)("button",{onClick:handleSubmit,disabled:H||!canProceed(),className:"w-full h-12 bg-green-600 text-white rounded-xl font-semibold active:bg-green-700 transition-transform duration-100 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 active:scale-[0.98] shadow-lg shadow-green-600/30",style:{WebkitTapHighlightColor:"transparent"},children:[H?A?"Saving changes...":"Saving...":A?"Save Changes":"Confirm & Save",!H&&(0,r.jsx)(N.Z,{size:20,className:"transition-transform duration-200 group-hover:translate-x-1"})]})})]});return(0,i.createPortal)(Q,document.body)}function OrderForm(e){let{order:t,onClose:a,onSave:n}=e;return(0,r.jsx)(OrderFormWizard,{order:t,onClose:a,onSave:n})}},68286:function(e,t,a){a.d(t,{h:function(){return r.nativePopup}});var r=a(88923)}}]);